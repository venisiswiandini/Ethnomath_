<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethnomath - Game Kesebangunan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Poppins', sans-serif; 
            position: relative;
            overflow-x: hidden;
        }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 25%, #45B7D1 50%, #96CEB4 75%, #FFEAA7 100%);
            position: relative;
            min-height: 100vh;
        }
        
        .gradient-bg::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%2387CEEB;stop-opacity:1" /><stop offset="50%" style="stop-color:%23B0E0E6;stop-opacity:1" /><stop offset="100%" style="stop-color:%23E0F6FF;stop-opacity:1" /></linearGradient><linearGradient id="riverGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:%234682B4;stop-opacity:1" /><stop offset="50%" style="stop-color:%235F9EA0;stop-opacity:1" /><stop offset="100%" style="stop-color:%234682B4;stop-opacity:1" /></linearGradient><linearGradient id="roofGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23D2691E;stop-opacity:1" /><stop offset="100%" style="stop-color:%23A0522D;stop-opacity:1" /></linearGradient><linearGradient id="wallGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23F4A460;stop-opacity:1" /><stop offset="100%" style="stop-color:%23DEB887;stop-opacity:1" /></linearGradient><linearGradient id="bridgeGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23708090;stop-opacity:1" /><stop offset="100%" style="stop-color:%23556B2F;stop-opacity:1" /></linearGradient></defs><rect width="1200" height="800" fill="url(%23skyGrad)"/><ellipse cx="150" cy="80" rx="70" ry="30" fill="white" opacity="0.9"/><ellipse cx="400" cy="60" rx="90" ry="35" fill="white" opacity="0.8"/><ellipse cx="800" cy="90" rx="60" ry="25" fill="white" opacity="0.85"/><ellipse cx="1000" cy="70" rx="80" ry="30" fill="white" opacity="0.8"/><rect x="0" y="650" width="1200" height="150" fill="url(%23riverGrad)" opacity="0.8"/><path d="M0 650 Q300 640 600 650 Q900 660 1200 650 L1200 800 L0 800 Z" fill="url(%23riverGrad)" opacity="0.6"/><rect x="200" y="620" width="800" height="8" fill="url(%23bridgeGrad)" rx="4"/><rect x="180" y="615" width="20" height="40" fill="url(%23bridgeGrad)"/><rect x="1000" y="615" width="20" height="40" fill="url(%23bridgeGrad)"/><rect x="400" y="610" width="15" height="50" fill="url(%23bridgeGrad)"/><rect x="600" y="610" width="15" height="50" fill="url(%23bridgeGrad)"/><rect x="800" y="610" width="15" height="50" fill="url(%23bridgeGrad)"/><path d="M150 400 L350 380 L380 320 L360 300 L340 290 L160 290 L140 300 L120 320 Z" fill="url(%23roofGrad)"/><path d="M160 380 L340 380 L340 500 L160 500 Z" fill="url(%23wallGrad)"/><rect x="170" y="400" width="12" height="100" fill="%23654321"/><rect x="200" y="400" width="12" height="100" fill="%23654321"/><rect x="230" y="400" width="12" height="100" fill="%23654321"/><rect x="300" y="400" width="12" height="100" fill="%23654321"/><rect x="320" y="400" width="12" height="100" fill="%23654321"/><rect x="190" y="420" width="60" height="80" fill="%23A0522D" stroke="%23654321" stroke-width="2"/><rect x="270" y="430" width="50" height="70" fill="%23A0522D" stroke="%23654321" stroke-width="2"/><path d="M600 420 L800 400 L830 340 L810 320 L790 310 L610 310 L590 320 L570 340 Z" fill="url(%23roofGrad)"/><path d="M610 400 L790 400 L790 520 L610 520 Z" fill="url(%23wallGrad)"/><rect x="620" y="420" width="12" height="100" fill="%23654321"/><rect x="650" y="420" width="12" height="100" fill="%23654321"/><rect x="680" y="420" width="12" height="100" fill="%23654321"/><rect x="750" y="420" width="12" height="100" fill="%23654321"/><rect x="770" y="420" width="12" height="100" fill="%23654321"/><rect x="640" y="440" width="70" height="80" fill="%23A0522D" stroke="%23654321" stroke-width="2"/><rect x="720" y="450" width="50" height="70" fill="%23A0522D" stroke="%23654321" stroke-width="2"/><ellipse cx="100" cy="550" rx="40" ry="60" fill="%2332CD32"/><ellipse cx="120" cy="540" rx="35" ry="55" fill="%2328A745"/><ellipse cx="80" cy="560" rx="30" ry="50" fill="%2334CE57"/><ellipse cx="500" cy="570" rx="45" ry="65" fill="%2332CD32"/><ellipse cx="520" cy="560" rx="40" ry="60" fill="%2328A745"/><ellipse cx="480" cy="580" rx="35" ry="55" fill="%2334CE57"/><ellipse cx="900" cy="540" rx="50" ry="70" fill="%2332CD32"/><ellipse cx="920" cy="530" rx="45" ry="65" fill="%2328A745"/><ellipse cx="880" cy="550" rx="40" ry="60" fill="%2334CE57"/><ellipse cx="1100" cy="560" rx="40" ry="60" fill="%2332CD32"/><ellipse cx="1120" cy="550" rx="35" ry="55" fill="%2328A745"/><path d="M400 350 Q450 330 500 350 Q550 370 600 350 Q650 330 700 350" stroke="%23FFD700" stroke-width="3" fill="none" opacity="0.9"/><circle cx="420" cy="360" r="6" fill="%23FFD700" opacity="0.8"/><circle cx="480" cy="365" r="5" fill="%23FFD700" opacity="0.8"/><circle cx="580" cy="355" r="7" fill="%23FFD700" opacity="0.8"/><circle cx="680" cy="362" r="5" fill="%23FFD700" opacity="0.8"/><rect x="50" y="600" width="100" height="50" rx="25" fill="%2332CD32" opacity="0.7"/><rect x="300" y="620" width="80" height="40" rx="20" fill="%2328A745" opacity="0.7"/><rect x="1000" y="610" width="120" height="45" rx="22" fill="%2334CE57" opacity="0.7"/></svg>');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            opacity: 0.4;
            z-index: -2;
            pointer-events: none;
        }
        
        .gradient-bg::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: linear-gradient(to top, 
                rgba(139, 69, 19, 0.3) 0%, 
                rgba(160, 82, 45, 0.2) 30%, 
                rgba(210, 180, 140, 0.1) 60%, 
                transparent 100%);
            z-index: -1;
            pointer-events: none;
        }
        .card-shadow { 
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.3), 0 5px 15px rgba(78, 205, 196, 0.2); 
            border: 3px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 25px;
        }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Basketball Animation Styles */
        .basketball-container {
            position: relative;
            width: 100%;
            height: 350px;
            margin: 20px 0;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
        }
        
        .basketball-court {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #87CEEB 0%, 
                #B0E0E6 40%, 
                #98FB98 70%, 
                #228B22 85%, 
                #006400 100%);
            perspective: 1000px;
        }
        
        .court-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(45deg, #8B4513 25%, #A0522D 25%, #A0522D 50%, #8B4513 50%, #8B4513 75%, #A0522D 75%);
            background-size: 20px 20px;
            opacity: 0.8;
        }
        
        .court-lines {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            border-top: 3px solid #fff;
        }
        
        .court-lines::before {
            content: '';
            position: absolute;
            bottom: 50%;
            left: 20%;
            width: 60%;
            height: 2px;
            background: #fff;
            border-radius: 1px;
        }
        
        .basketball-hoop {
            position: absolute;
            right: 60px;
            top: 60px;
            width: 100px;
            height: 80px;
            transform: perspective(500px) rotateY(-15deg);
        }
        
        .hoop-pole {
            position: absolute;
            right: 30px;
            top: 40px;
            width: 6px;
            height: 60px;
            background: linear-gradient(to right, #666, #999, #666);
            border-radius: 3px;
        }
        
        .hoop-backboard {
            width: 70px;
            height: 50px;
            background: linear-gradient(135deg, #f8f8f8, #e0e0e0, #f8f8f8);
            border: 4px solid #333;
            border-radius: 8px;
            position: absolute;
            right: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .backboard-square {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 20px;
            border: 2px solid #ff0000;
            border-radius: 2px;
        }
        
        .hoop-rim {
            position: absolute;
            bottom: -12px;
            right: 8px;
            width: 55px;
            height: 12px;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .rim-front {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(to bottom, #ff8800, #cc5500);
            border-radius: 50px 50px 0 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .rim-back {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to bottom, #cc5500, #994400);
            border-radius: 0 0 50px 50px;
        }
        
        .hoop-net {
            position: absolute;
            bottom: -35px;
            right: 13px;
            width: 45px;
            height: 30px;
        }
        
        .net-strand {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, #fff, #f0f0f0, #fff);
            border-radius: 1px;
            animation: netSway 3s ease-in-out infinite;
        }
        
        @keyframes netSway {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(2deg); }
        }
        
        @keyframes netSwaySuccess {
            0% { transform: rotate(0deg); }
            20% { transform: rotate(8deg) scale(1.1); }
            40% { transform: rotate(-6deg) scale(1.05); }
            60% { transform: rotate(4deg) scale(1.02); }
            80% { transform: rotate(-2deg) scale(1.01); }
            100% { transform: rotate(0deg) scale(1); }
        }
        
        .player {
            position: absolute;
            left: 80px;
            bottom: 40px;
            width: 70px;
            height: 100px;
            transition: all 0.5s ease;
            transform-origin: bottom center;
        }
        
        .player-shadow {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 8px;
            background: radial-gradient(ellipse, rgba(0,0,0,0.3), transparent);
            border-radius: 50%;
        }
        
        .player-legs {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 35px;
        }
        
        .player-leg {
            position: absolute;
            bottom: 0;
            width: 12px;
            height: 35px;
            background: linear-gradient(to right, #8B4513, #A0522D);
            border-radius: 6px;
        }
        
        .player-leg.left {
            left: 8px;
        }
        
        .player-leg.right {
            right: 8px;
        }
        
        .player-body {
            width: 35px;
            height: 45px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border-radius: 18px 18px 8px 8px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .jersey-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .player-head {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #f4c2a1, #d4a574);
            border-radius: 50%;
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .player-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 15px;
        }
        
        .eye {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #333;
            border-radius: 50%;
            top: 2px;
        }
        
        .eye.left {
            left: 4px;
        }
        
        .eye.right {
            right: 4px;
        }
        
        .mouth {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 3px;
            border: 1px solid #333;
            border-top: none;
            border-radius: 0 0 6px 6px;
        }
        
        .player-hair {
            position: absolute;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 15px;
            background: #2d1810;
            border-radius: 50% 50% 0 0;
        }
        
        .player-arms {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
        }
        
        .player-arm {
            width: 18px;
            height: 35px;
            background: linear-gradient(to right, #f4c2a1, #d4a574);
            border-radius: 12px;
            position: absolute;
            transition: all 0.3s ease;
            transform-origin: top center;
        }
        
        .player-arm.left {
            left: 0;
        }
        
        .player-arm.right {
            right: 0;
        }
        
        .hand {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #f4c2a1, #d4a574);
            border-radius: 50%;
        }
        
        .basketball {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #ff8800, #cc5500);
            border-radius: 50%;
            left: 90px;
            bottom: 100px;
            transition: none;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .ball-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .ball-line {
            position: absolute;
            background: #333;
            border-radius: 1px;
        }
        
        .ball-line.horizontal {
            top: 50%;
            left: 10%;
            width: 80%;
            height: 2px;
            transform: translateY(-50%);
        }
        
        .ball-line.vertical {
            left: 50%;
            top: 10%;
            width: 2px;
            height: 80%;
            transform: translateX(-50%);
        }
        
        .ball-line.curve1 {
            top: 20%;
            left: 20%;
            width: 60%;
            height: 2px;
            border-radius: 50%;
            transform: rotate(45deg);
        }
        
        .ball-line.curve2 {
            top: 20%;
            left: 20%;
            width: 60%;
            height: 2px;
            border-radius: 50%;
            transform: rotate(-45deg);
        }
        
        .ball-shadow {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 8px;
            background: radial-gradient(ellipse, rgba(0,0,0,0.4), transparent);
            border-radius: 50%;
            transition: none;
        }
        
        .score-effect {
            position: absolute;
            top: 50px;
            right: 100px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }
        
        .score-text {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }
        
        .score-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .star {
            font-size: 16px;
            animation: starTwinkle 0.6s ease-in-out infinite alternate;
        }
        
        .star:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .star:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes starTwinkle {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.2) rotate(180deg); }
        }
        
        /* Animation Classes */
        .shooting {
            transform: rotate(-20deg);
        }
        
        .shooting .player-arm.right {
            transform: rotate(-45deg);
        }
        
        .shooting .player-arm.left {
            transform: rotate(-30deg);
        }
        

        
        .celebration {
            animation: celebrate 1s ease-in-out;
        }
        
        .disappointment {
            animation: disappoint 1s ease-in-out;
        }
        
        @keyframes celebrate {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-10px) rotate(5deg); }
            75% { transform: translateY(-5px) rotate(-5deg); }
        }
        
        @keyframes disappoint {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px) rotate(2deg); }
        }
        
        /* Miss Animation Effects */
        .miss-effect {
            position: absolute;
            top: 80px;
            right: 120px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
            z-index: 15;
        }
        
        .miss-text {
            font-size: 20px;
            font-weight: bold;
            color: #ff4444;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
            animation: shake 0.5s ease-in-out;
        }
        
        .miss-icons {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .miss-icon {
            font-size: 16px;
            animation: bounce 0.6s ease-in-out infinite alternate;
        }
        
        .miss-icon:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .miss-icon:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes bounce {
            0% { transform: translateY(0) scale(1); }
            100% { transform: translateY(-10px) scale(1.2); }
        }
        
        /* Rim shake animation for misses */
        .rim-shake {
            animation: rimShake 0.8s ease-in-out;
        }
        
        @keyframes rimShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }
        
        /* Ball bounce effects */
        .ball-bounce-1 {
            animation: ballBounce1 0.6s ease-out;
        }
        
        .ball-bounce-2 {
            animation: ballBounce2 0.4s ease-out;
        }
        
        .ball-bounce-3 {
            animation: ballBounce3 0.3s ease-out;
        }
        
        @keyframes ballBounce1 {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(0.95); }
        }
        
        @keyframes ballBounce2 {
            0% { transform: rotate(0deg) scale(0.95); }
            50% { transform: rotate(90deg) scale(1.05); }
            100% { transform: rotate(180deg) scale(0.9); }
        }
        
        @keyframes ballBounce3 {
            0% { transform: rotate(0deg) scale(0.9); }
            50% { transform: rotate(45deg) scale(1); }
            100% { transform: rotate(90deg) scale(0.85); }
        }
        
        /* Success celebration effects */
        .success-celebration {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            z-index: 20;
        }
        
        .celebration-text {
            font-size: 28px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: celebrationPulse 1s ease-in-out;
        }
        
        @keyframes celebrationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Audio controls */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .audio-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(218, 165, 32, 0.5);
            background: linear-gradient(135deg, #D2691E 0%, #8B4513 100%);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
        }
        
        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.4);
            background: linear-gradient(135deg, #F4A460 0%, #D2691E 100%);
        }
        
        .audio-btn.muted {
            background: linear-gradient(135deg, #CD853F 0%, #A0522D 100%);
            border-color: rgba(160, 82, 45, 0.5);
        }

        /* Reward Animation Styles */
        .reward-sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
        }
        
        .reward-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .reward-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Audio Controls -->
    <div class="audio-controls">
        <button id="musicToggle" class="audio-btn" onclick="toggleMusic()" title="Toggle Background Music">
            üéµ
        </button>
        <button id="volumeToggle" class="audio-btn" onclick="toggleVolume()" title="Toggle Volume">
            üîä
        </button>
    </div>
    
    <!-- Host Panel Button (Bottom Right Corner) -->
    <div class="fixed bottom-4 right-4 z-50">
        <button onclick="showHostLogin()" class="w-12 h-12 bg-gradient-to-r from-orange-700 to-red-800 hover:from-orange-800 hover:to-red-900 text-white rounded-full font-medium transition-all duration-300 shadow-lg border-2 border-orange-400 hover:scale-110" title="Panel Host">
            üë®‚Äçüíº
        </button>
    </div>
    
    <!-- Background Music -->
    <audio id="backgroundMusic" loop autoplay>
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
        <!-- Fallback to a more accessible background music -->
    </audio>
    
    <!-- YouTube Background Music (Hidden) -->
    <div id="youtubePlayer" style="display: none;"></div>
    
    <!-- Sound Effects -->
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
    </audio>
    
    <audio id="missSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm1QIBAAAAABAAEARKwAAIhYAQACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
    </audio>
    <!-- Opening Screen -->
    <div id="openingScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <div class="mb-6">
                <div class="w-24 h-24 bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 rounded-full mx-auto mb-4 flex items-center justify-center border-4 border-white shadow-2xl animate-pulse">
                    <span class="text-white text-3xl font-bold">üìê</span>
                </div>
                <h1 class="text-4xl font-bold text-white mb-2 drop-shadow-lg">Ethnomath</h1>
                <p class="text-white text-lg mb-4 drop-shadow-md">Game Kuis Kesebangunan</p>
                <div class="bg-gradient-to-r from-blue-400 to-purple-500 rounded-xl p-4 mb-6 border-2 border-white shadow-lg">
                    <p class="text-sm text-white font-medium">Dibuat oleh:</p>
                    <p class="text-xl font-bold text-yellow-200">Veni Siswiandini</p>
                </div>
            </div>
            <div class="space-y-3">
                <button onclick="showMaterial()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-4 px-6 rounded-2xl font-bold transition-all duration-300 shadow-xl border-3 border-white transform hover:scale-105 hover:shadow-2xl">
                    üìö Lihat Materi
                </button>
                <button onclick="showPlayerJoin()" class="w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white py-4 px-6 rounded-2xl font-bold transition-all duration-300 shadow-xl border-3 border-white transform hover:scale-105 hover:shadow-2xl">
                    üéÆ Mulai Bermain
                </button>

            </div>
        </div>
    </div>

    <!-- Material Screen -->
    <div id="materialScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-3xl p-8 card-shadow">
                <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                    ‚Üê Kembali
                </button>
                <h2 class="text-4xl font-bold text-center mb-8 text-white drop-shadow-lg">üìê Materi Kesebangunan</h2>
                
                <div class="grid md:grid-cols-1 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-pink-100 to-purple-100 rounded-2xl p-6 border-3 border-white shadow-xl">
                        <h3 class="text-2xl font-bold mb-4 text-purple-800">üìê Definisi Kesebangunan</h3>
                        <div class="bg-gradient-to-r from-white to-blue-50 rounded-xl p-4 mb-4 border-2 border-blue-200 shadow-lg">
                            <p class="text-gray-800 mb-3 text-lg"><strong>Kesebangunan</strong> adalah hubungan dua bangun yang memiliki bentuk sama tetapi ukuran belum tentu sama.</p>
                            <p class="font-bold text-purple-700 mb-2 text-lg">Dua bangun dikatakan sebangun jika:</p>
                            <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4 text-lg">
                                <li><strong>Bentuknya sama</strong> (sudut-sudut yang bersesuaian sama besar)</li>
                                <li><strong>Perbandingan panjang sisi-sisi yang bersesuaian sama</strong></li>
                            </ul>
                        </div>
                        
                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl p-4 mb-4 border-2 border-orange-300 shadow-lg">
                            <p class="font-bold text-orange-800 mb-2 text-lg">üî¢ Rumus Perbandingan Sisi:</p>
                            <div class="text-center bg-white rounded-xl p-4 font-mono text-xl border-2 border-orange-200 shadow-md">
                                <span class="text-red-600 font-bold">sisi 1</span>/<span class="text-blue-600 font-bold">sisi 1'</span> = <span class="text-red-600 font-bold">sisi 2</span>/<span class="text-blue-600 font-bold">sisi 2'</span> = ...
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-100 to-teal-100 rounded-xl p-4 border-2 border-green-300 shadow-lg">
                            <p class="font-bold text-green-800 mb-2 text-lg">üìù Simbol Kesebangunan:</p>
                            <div class="text-center bg-white rounded-xl p-4 border-2 border-green-200 shadow-md">
                                <span class="text-2xl font-mono font-bold text-purple-600">‚àÜABC ~ ‚àÜDEF</span>
                                <p class="text-lg text-gray-700 mt-2 font-medium">artinya segitiga ABC sebangun dengan segitiga DEF</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-br from-cyan-100 to-blue-100 rounded-2xl p-6 border-3 border-white shadow-xl">
                        <h3 class="text-2xl font-bold mb-4 text-blue-800">üí° Contoh Soal Singkat</h3>
                        <div class="bg-gradient-to-r from-white to-cyan-50 rounded-xl p-4 space-y-3 border-2 border-cyan-200 shadow-lg">
                            <div class="bg-gradient-to-r from-green-100 to-emerald-100 rounded-xl p-3 border-2 border-green-300 shadow-md">
                                <p class="text-lg font-bold text-green-800">Soal:</p>
                                <p class="text-gray-800 text-lg">‚àÜPQR sebangun dengan ‚àÜXYZ. Panjang PQ = 4 cm, QR = 6 cm, dan XY = 6 cm. Tentukan panjang YZ.</p>
                            </div>
                            
                            <div class="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl p-3 border-2 border-yellow-300 shadow-md">
                                <p class="text-lg font-bold text-orange-800">Penyelesaian:</p>
                                <div class="font-mono text-lg space-y-1 text-gray-800">
                                    <p>PQ/XY = QR/YZ</p>
                                    <p>4/6 = 6/YZ</p>
                                    <p>YZ = (6 √ó 6)/4</p>
                                    <p class="font-bold text-red-600 text-xl">YZ = 9 cm</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-100 to-teal-100 rounded-2xl p-6 border-3 border-white shadow-xl">
                        <h3 class="text-2xl font-bold mb-4 text-teal-800">Contoh Kesebangunan</h3>
                        <div class="bg-gradient-to-r from-white to-green-50 rounded-xl p-4 text-center border-2 border-green-200 shadow-lg">
                            <div class="flex justify-center items-center space-x-4 mb-4">
                                <div class="w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 transform rotate-45 shadow-lg"></div>
                                <span class="text-4xl text-pink-500 font-bold">~</span>
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-purple-500 transform rotate-45 shadow-lg"></div>
                            </div>
                            <p class="text-lg text-gray-800 font-medium">Kedua persegi ini sebangun karena memiliki bentuk sama dengan perbandingan sisi 3:2</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl p-6 border-3 border-white shadow-xl">
                        <h3 class="text-2xl font-bold mb-4 text-purple-800">Rumus Perbandingan</h3>
                        <div class="bg-gradient-to-r from-white to-purple-50 rounded-xl p-4 border-2 border-purple-200 shadow-lg">
                            <p class="font-bold text-purple-700 mb-2 text-lg">Jika segitiga ABC ~ segitiga DEF:</p>
                            <p class="text-center text-xl font-mono bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-xl border-2 border-yellow-300 shadow-md font-bold text-purple-800">AB/DE = BC/EF = AC/DF = k</p>
                            <p class="text-lg text-gray-700 mt-2 font-medium">k = faktor skala kesebangunan</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-orange-100 to-red-100 rounded-2xl p-6 border-3 border-white shadow-xl">
                        <h3 class="text-2xl font-bold mb-4 text-red-800">Tips Mengerjakan Soal</h3>
                        <ul class="list-disc list-inside text-gray-800 space-y-3 text-lg font-medium">
                            <li>Identifikasi sisi-sisi yang bersesuaian</li>
                            <li>Hitung perbandingan sisi</li>
                            <li>Periksa apakah perbandingannya sama</li>
                            <li>Gunakan sifat sudut yang sama</li>
                        </ul>
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="showPlayerJoin()" class="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 hover:from-pink-600 hover:via-purple-600 hover:to-indigo-600 text-white py-4 px-10 rounded-2xl font-bold text-xl transition-all duration-300 pulse-animation shadow-2xl border-3 border-white transform hover:scale-110">
                        Siap Bermain! üéÆ‚ú®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Join Screen -->
    <div id="playerJoinScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                ‚Üê Kembali
            </button>
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Bergabung ke Game</h2>
            <div class="mb-6">
                <input type="text" id="playerName" placeholder="Masukkan nama Anda" 
                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-center">
            </div>
            <div class="mb-6 bg-gray-100 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-2">Pemain Online:</p>
                <p class="text-2xl font-bold text-blue-600" id="playerCount">0/40</p>
            </div>
            <button onclick="joinGame()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                üöÄ Bergabung
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <!-- Game Header -->
            <div class="bg-white rounded-xl p-4 mb-6 card-shadow">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="font-bold text-gray-800">Soal <span id="currentQuestion">1</span>/5</h3>
                        <p class="text-sm text-gray-600">Pemain: <span id="gamePlayerName"></span></p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600" id="timer">10:00</div>
                        <p class="text-sm text-gray-600">Sisa Waktu</p>
                    </div>
                </div>
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500 ease-out" style="width: 20%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500">
                    <span>Progress</span>
                    <span id="progressText">1 dari 5 soal</span>
                </div>
            </div>

            <!-- Question Card -->
            <div class="bg-white rounded-xl p-8 card-shadow">
                <!-- Question Header with Icon -->
                <div class="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 rounded-2xl p-8 mb-6 text-white shadow-2xl border-3 border-white">
                    <div class="flex items-center justify-center mb-6">
                        <div class="w-20 h-20 bg-white bg-opacity-30 rounded-full flex items-center justify-center shadow-xl animate-pulse">
                            <span class="text-4xl" id="questionIcon">üìê</span>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-center mb-4 drop-shadow-lg" id="questionText"></h2>
                </div>

                <!-- Question Image/Visual -->
                <div id="questionImageContainer" class="mb-6 text-center bg-gray-50 rounded-xl p-6">
                    <div id="questionImage" class="text-6xl mb-4"></div>
                    <div id="questionDiagram" class="hidden"></div>
                </div>
                
                <div class="space-y-4" id="answerOptions">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Basketball Animation Area - Moved below answer options -->
                <div id="basketballAnimation" class="basketball-container hidden mt-8">
                    <div class="basketball-court">
                        <div class="court-floor"></div>
                        <div class="court-lines"></div>
                        <div class="basketball-hoop">
                            <div class="hoop-pole"></div>
                            <div class="hoop-backboard">
                                <div class="backboard-square"></div>
                            </div>
                            <div class="hoop-rim">
                                <div class="rim-front"></div>
                                <div class="rim-back"></div>
                            </div>
                            <div class="hoop-net">
                                <div class="net-strand" style="left: 5px;"></div>
                                <div class="net-strand" style="left: 15px;"></div>
                                <div class="net-strand" style="left: 25px;"></div>
                                <div class="net-strand" style="left: 35px;"></div>
                            </div>
                        </div>
                        <div class="player" id="basketballPlayer">
                            <div class="player-shadow"></div>
                            <div class="player-legs">
                                <div class="player-leg left"></div>
                                <div class="player-leg right"></div>
                            </div>
                            <div class="player-body">
                                <div class="jersey-number">7</div>
                            </div>
                            <div class="player-head">
                                <div class="player-face">
                                    <div class="eye left"></div>
                                    <div class="eye right"></div>
                                    <div class="mouth"></div>
                                </div>
                                <div class="player-hair"></div>
                            </div>
                            <div class="player-arms">
                                <div class="player-arm left">
                                    <div class="hand"></div>
                                </div>
                                <div class="player-arm right">
                                    <div class="hand"></div>
                                </div>
                            </div>
                        </div>
                        <div class="basketball" id="basketball">
                            <div class="ball-lines">
                                <div class="ball-line horizontal"></div>
                                <div class="ball-line vertical"></div>
                                <div class="ball-line curve1"></div>
                                <div class="ball-line curve2"></div>
                            </div>
                            <div class="ball-shadow"></div>
                        </div>
                        <div class="score-effect" id="scoreEffect">
                            <div class="score-text">+20</div>
                            <div class="score-stars">
                                <div class="star">‚≠ê</div>
                                <div class="star">‚≠ê</div>
                                <div class="star">‚≠ê</div>
                            </div>
                        </div>
                        <div class="miss-effect" id="missEffect">
                            <div class="miss-text">MISS!</div>
                            <div class="miss-icons">
                                <div class="miss-icon">üòû</div>
                                <div class="miss-icon">üíî</div>
                                <div class="miss-icon">üòî</div>
                            </div>
                        </div>
                        <div class="success-celebration" id="successCelebration">
                            <div class="celebration-text">üéâ PERFECT SHOT! üéâ</div>
                        </div>
                    </div>
                </div>
                
                <!-- Auto-advance message (shown after answering) -->
                <div id="autoAdvanceMessage" class="mt-8 text-center hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <div class="flex items-center justify-center space-x-2 text-blue-700">
                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-700"></div>
                            <span class="font-medium">Memuat soal berikutnya...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-3xl p-8 card-shadow">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">üèÜ Leaderboard</h2>
                
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-6 text-center text-white mb-6">
                        <h3 class="text-xl font-bold mb-2">Selamat!</h3>
                        <p>Game telah selesai. Berikut adalah hasil akhir:</p>
                    </div>
                </div>

                <div id="leaderboardList" class="space-y-3 mb-8">
                    <!-- Leaderboard will be populated here -->
                </div>

                <div class="text-center space-y-4">
                    <button onclick="resetGame()" class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-8 rounded-xl font-medium transition-colors">
                        üîÑ Main Lagi
                    </button>
                    <button onclick="showOpening()" class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-8 rounded-xl font-medium transition-colors">
                        üè† Kembali ke Menu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Host Login Screen -->
    <div id="hostLoginScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                ‚Üê Kembali
            </button>
            <h2 class="text-2xl font-bold mb-6 text-gray-800">üîê Login Host</h2>
            <div class="mb-6">
                <input type="password" id="hostPassword" placeholder="Masukkan password host" 
                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-center">
            </div>
            <button onclick="loginHost()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                üö™ Masuk
            </button>
            <p class="text-xs text-gray-500 mt-4">Password: admin123</p>
        </div>
    </div>

    <!-- Host Panel Screen -->
    <div id="hostPanelScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-xl p-6 mb-6 card-shadow">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">üë®‚Äçüíº Panel Host</h2>
                    <div class="flex space-x-4">
                        <button onclick="startGameAsHost()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium">
                            ‚ñ∂Ô∏è Mulai Game
                        </button>
                        <button onclick="showOpening()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                            üö™ Keluar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Host Menu Tabs -->
            <div class="bg-white rounded-xl p-6 mb-6 card-shadow">
                <div class="flex space-x-4 border-b border-gray-200">
                    <button id="statsTab" class="px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600">
                        üìä Statistik Live
                    </button>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="hostStatsTab" class="grid lg:grid-cols-2 gap-6">
                <!-- Live Stats -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üìä Statistik Live</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600" id="hostPlayerCount">0</p>
                            <p class="text-sm text-gray-600">Pemain Online</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-green-600" id="hostGameTime">10:00</p>
                            <p class="text-sm text-gray-600">Sisa Waktu</p>
                        </div>
                    </div>
                    <div style="height: 300px;">
                        <canvas id="liveScoreChart"></canvas>
                    </div>
                </div>

                <!-- Player List -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üë• Daftar Pemain</h3>
                    <div id="hostPlayerList" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Player list will be populated here -->
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentScreen: 'opening',
            players: [],
            currentPlayer: null,
            currentQuestionIndex: 0,
            gameStartTime: null,
            gameTimer: null,
            hostChart: null,
            musicEnabled: true,
            soundEnabled: true,
            backgroundMusic: null
        };

        // YouTube Player Variables
        let youtubePlayer = null;
        let isYouTubeReady = false;
        
        // YouTube API Ready Callback
        function onYouTubeIframeAPIReady() {
            youtubePlayer = new YT.Player('youtubePlayer', {
                height: '1',
                width: '1',
                videoId: 'jfKfPfyJRdk', // Relaxing Indonesian Traditional Music
                playerVars: {
                    'autoplay': 0,
                    'controls': 0,
                    'disablekb': 1,
                    'fs': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'showinfo': 0,
                    'loop': 1,
                    'playlist': 'jfKfPfyJRdk'
                },
                events: {
                    'onReady': function(event) {
                        isYouTubeReady = true;
                        event.target.setVolume(15); // Set low volume
                        if (gameState.musicEnabled && gameState.currentScreen === 'game') {
                            event.target.playVideo();
                        }
                    },
                    'onStateChange': function(event) {
                        if (event.data === YT.PlayerState.ENDED) {
                            event.target.playVideo(); // Loop the video
                        }
                    }
                }
            });
        }

        // Audio Management
        function initAudio() {
            gameState.backgroundMusic = document.getElementById('backgroundMusic');
            
            // Create a more energetic background music using Web Audio API as fallback
            if (typeof(AudioContext) !== "undefined" || typeof(webkitAudioContext) !== "undefined") {
                createBackgroundMusic();
            }
        }

        function createBackgroundMusic() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                let isPlaying = false;
                
                function playTone(frequency, duration, volume = 0.08, type = 'sine') {
                    if (!gameState.musicEnabled || !gameState.soundEnabled) return;
                    
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = type;
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }
                
                function playChord(frequencies, duration, volume = 0.04) {
                    frequencies.forEach(freq => {
                        playTone(freq, duration, volume, 'triangle');
                    });
                }
                
                function playBackgroundLoop() {
                    if (!gameState.musicEnabled || gameState.currentScreen !== 'game') return;
                    
                    // Upbeat and cheerful melody inspired by traditional Indonesian music
                    const melody = [
                        // Main melody - cheerful and energetic
                        {freq: 659.25, dur: 0.4, vol: 0.06}, // E5
                        {freq: 783.99, dur: 0.4, vol: 0.06}, // G5
                        {freq: 880.00, dur: 0.4, vol: 0.06}, // A5
                        {freq: 783.99, dur: 0.4, vol: 0.06}, // G5
                        {freq: 659.25, dur: 0.6, vol: 0.06}, // E5
                        {freq: 587.33, dur: 0.4, vol: 0.06}, // D5
                        {freq: 659.25, dur: 0.4, vol: 0.06}, // E5
                        {freq: 523.25, dur: 0.8, vol: 0.06}, // C5
                        
                        // Second phrase - more uplifting
                        {freq: 783.99, dur: 0.4, vol: 0.06}, // G5
                        {freq: 880.00, dur: 0.4, vol: 0.06}, // A5
                        {freq: 987.77, dur: 0.4, vol: 0.06}, // B5
                        {freq: 1046.50, dur: 0.6, vol: 0.06}, // C6
                        {freq: 987.77, dur: 0.4, vol: 0.06}, // B5
                        {freq: 880.00, dur: 0.4, vol: 0.06}, // A5
                        {freq: 783.99, dur: 0.6, vol: 0.06}, // G5
                        {freq: 659.25, dur: 0.8, vol: 0.06}, // E5
                    ];
                    
                    // Bass line for rhythm
                    const bassLine = [
                        {freq: 261.63, dur: 0.8}, // C4
                        {freq: 293.66, dur: 0.8}, // D4
                        {freq: 329.63, dur: 0.8}, // E4
                        {freq: 293.66, dur: 0.8}, // D4
                        {freq: 261.63, dur: 0.8}, // C4
                        {freq: 246.94, dur: 0.8}, // B3
                        {freq: 261.63, dur: 0.8}, // C4
                        {freq: 196.00, dur: 0.8}, // G3
                    ];
                    
                    let noteIndex = 0;
                    let bassIndex = 0;
                    
                    function playNextNote() {
                        if (!gameState.musicEnabled || gameState.currentScreen !== 'game') return;
                        
                        const note = melody[noteIndex];
                        const bass = bassLine[bassIndex];
                        
                        // Play melody
                        playTone(note.freq, note.dur, note.vol || 0.06, 'triangle');
                        
                        // Play bass every other note for rhythm
                        if (noteIndex % 2 === 0) {
                            playTone(bass.freq, bass.dur, 0.03, 'sine');
                            bassIndex = (bassIndex + 1) % bassLine.length;
                        }
                        
                        // Add some percussion-like sounds for rhythm
                        if (noteIndex % 4 === 0) {
                            setTimeout(() => {
                                playTone(1000, 0.1, 0.02, 'square'); // High hat
                            }, note.dur * 500);
                        }
                        
                        noteIndex = (noteIndex + 1) % melody.length;
                        setTimeout(playNextNote, note.dur * 1000);
                    }
                    
                    playNextNote();
                }
                
                gameState.playBackgroundMusic = playBackgroundLoop;
                
            } catch (error) {
                console.log('Web Audio API not supported, using fallback');
            }
        }

        function toggleMusic() {
            gameState.musicEnabled = !gameState.musicEnabled;
            const btn = document.getElementById('musicToggle');
            
            if (gameState.musicEnabled) {
                btn.textContent = 'üéµ';
                btn.classList.remove('muted');
                if (gameState.currentScreen === 'game') {
                    if (isYouTubeReady && youtubePlayer) {
                        youtubePlayer.playVideo();
                    } else if (gameState.playBackgroundMusic) {
                        gameState.playBackgroundMusic();
                    }
                }
            } else {
                btn.textContent = 'üîá';
                btn.classList.add('muted');
                if (isYouTubeReady && youtubePlayer) {
                    youtubePlayer.pauseVideo();
                }
            }
        }

        function toggleVolume() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const btn = document.getElementById('volumeToggle');
            
            if (gameState.soundEnabled) {
                btn.textContent = 'üîä';
                btn.classList.remove('muted');
            } else {
                btn.textContent = 'üîá';
                btn.classList.add('muted');
            }
        }

        function playSuccessSound() {
            if (!gameState.soundEnabled) return;
            
            try {
                // Create success sound effect
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Play ascending notes for success
                const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                    }, index * 100);
                });
            } catch (error) {
                console.log('Could not play success sound');
            }
        }

        function playMissSound() {
            if (!gameState.soundEnabled) return;
            
            try {
                // Create miss sound effect
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Play descending notes for miss
                const frequencies = [400, 350, 300, 250]; // Descending sad notes
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                        oscillator.type = 'sawtooth';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.4);
                    }, index * 150);
                });
            } catch (error) {
                console.log('Could not play miss sound');
            }
        }

        // Questions Data
        const questions = [
            {
                question: "Dua segitiga dikatakan sebangun jika...",
                icon: "üìê",
                image: "üìê",
                diagram: `
                    <div class="flex justify-center items-center space-x-8">
                        <div class="text-center">
                            <div style="width: 0; height: 0; border-left: 40px solid transparent; border-right: 40px solid transparent; border-bottom: 60px solid #3b82f6; margin: 0 auto;"></div>
                            <p class="mt-2 text-sm font-medium">Segitiga ABC</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div style="width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 45px solid #10b981; margin: 0 auto;"></div>
                            <p class="mt-2 text-sm font-medium">Segitiga DEF</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Memiliki luas yang sama",
                    b: "Sudut-sudut bersesuaian sama besar dan perbandingan sisi bersesuaian sama"
                },
                correct: "b"
            },
            {
                question: "Perhatikan gambar berikut! Jika kedua segitiga sebangun, tentukan nilai x:",
                icon: "üìè",
                image: "https://lh3.googleusercontent.com/d/1twkoCo04vePhKNFXn33SKaHj_-8D5iaf",
                diagram: `
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-2xl border-3 border-white shadow-xl">
                        <div class="bg-white rounded-xl p-4 shadow-lg">
                            <img src="https://lh3.googleusercontent.com/d/1twkoCo04vePhKNFXn33SKaHj_-8D5iaf" 
                                 alt="Diagram segitiga sebangun" 
                                 class="max-w-full h-auto mx-auto rounded-xl shadow-lg max-h-64 object-contain"
                                 onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                                 style="opacity: 0; transition: opacity 0.5s ease;">
                            <div class="text-center p-8 bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl border-2 border-yellow-300">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-purple-600 mx-auto mb-4"></div>
                                <p class="text-gray-700 font-medium">Memuat gambar soal...</p>
                                <div class="hidden">
                                    <div class="text-8xl mb-4">üìê</div>
                                    <p class="text-gray-700 font-bold text-lg">Diagram Segitiga Sebangun</p>
                                    <p class="text-gray-600 mt-2">Dua segitiga dengan sisi-sisi yang diketahui untuk mencari nilai x</p>
                                </div>
                            </div>
                        </div>
                        <p class="text-center mt-4 text-purple-700 font-medium">üí° Gunakan perbandingan sisi yang bersesuaian!</p>
                    </div>
                `,
                options: {
                    a: "x = 6 cm",
                    b: "x = 8 cm"
                },
                correct: "a"
            },
            {
                question: "Persegi dengan sisi 6 cm sebangun dengan persegi yang memiliki sisi...",
                icon: "‚¨ú",
                image: "‚¨ú",
                diagram: `
                    <div class="flex justify-center items-center space-x-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-400 border-2 border-blue-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">6 cm √ó 6 cm</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div class="w-12 h-12 bg-green-400 border-2 border-green-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">? cm √ó ? cm</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div class="w-20 h-20 bg-purple-400 border-2 border-purple-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">? cm √ó ? cm</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Hanya 12 cm",
                    b: "Semua ukuran sisi (3 cm, 9 cm, 12 cm, dll)"
                },
                correct: "b"
            },
            {
                question: "Faktor skala kesebangunan antara dua bangun yang sebangun adalah 1:4. Jika luas bangun pertama 9 cm¬≤, maka luas bangun kedua adalah...",
                icon: "üìä",
                image: "üìä",
                diagram: `
                    <div class="flex justify-center items-center space-x-8">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-red-400 border-2 border-red-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">Bangun 1</p>
                            <p class="text-xs text-gray-600">Luas = 9 cm¬≤</p>
                            <p class="text-xs text-blue-600">Skala = 1</p>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl text-blue-500">:</div>
                            <p class="text-sm font-medium">1 : 4</p>
                        </div>
                        <div class="text-center">
                            <div class="w-24 h-24 bg-red-400 border-2 border-red-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">Bangun 2</p>
                            <p class="text-xs text-gray-600">Luas = ? cm¬≤</p>
                            <p class="text-xs text-blue-600">Skala = 4</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "36 cm¬≤",
                    b: "144 cm¬≤"
                },
                correct: "b"
            },
            {
                question: "Manakah pasangan bangun yang PASTI sebangun?",
                icon: "üîç",
                image: "üîç",
                diagram: `
                    <div class="grid grid-cols-2 gap-6">
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div style="width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 30px solid #ef4444;"></div>
                                <div style="width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #ef4444;"></div>
                            </div>
                            <p class="text-sm font-medium">Dua Segitiga Siku-siku</p>
                            <p class="text-xs text-red-600">Belum tentu sebangun</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div class="w-8 h-8 bg-green-500 rounded-full"></div>
                                <div class="w-6 h-6 bg-green-500 rounded-full"></div>
                            </div>
                            <p class="text-sm font-medium">Dua Lingkaran</p>
                            <p class="text-xs text-green-600">Pasti sebangun</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Dua segitiga siku-siku",
                    b: "Dua lingkaran dengan jari-jari berbeda"
                },
                correct: "b"
            }
        ];

        // Screen Navigation Functions
        function showOpening() {
            hideAllScreens();
            document.getElementById('openingScreen').classList.remove('hidden');
            gameState.currentScreen = 'opening';
        }

        function showMaterial() {
            hideAllScreens();
            document.getElementById('materialScreen').classList.remove('hidden');
            gameState.currentScreen = 'material';
        }

        function showPlayerJoin() {
            hideAllScreens();
            document.getElementById('playerJoinScreen').classList.remove('hidden');
            gameState.currentScreen = 'playerJoin';
            updatePlayerCount();
        }

        function showHostLogin() {
            hideAllScreens();
            document.getElementById('hostLoginScreen').classList.remove('hidden');
            gameState.currentScreen = 'hostLogin';
        }

        function hideAllScreens() {
            const screens = ['openingScreen', 'materialScreen', 'playerJoinScreen', 'gameScreen', 'leaderboardScreen', 'hostLoginScreen', 'hostPanelScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Player Management
        function updatePlayerCount() {
            const count = gameState.players.length;
            document.getElementById('playerCount').textContent = `${count}/40`;
            if (document.getElementById('hostPlayerCount')) {
                document.getElementById('hostPlayerCount').textContent = count;
            }
            updateHostPlayerList();
        }

        function joinGame() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Silakan masukkan nama Anda!');
                return;
            }

            if (gameState.players.length >= 40) {
                alert('Maaf, game sudah penuh (maksimal 40 pemain)');
                return;
            }

            if (gameState.players.find(p => p.name === name)) {
                alert('Nama sudah digunakan, silakan pilih nama lain!');
                return;
            }

            const player = {
                id: Date.now(),
                name: name,
                score: 0,
                answers: [],
                joinTime: new Date()
            };

            gameState.players.push(player);
            gameState.currentPlayer = player;
            
            startGame();
        }

        // Game Logic
        function startGame() {
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            gameState.currentScreen = 'game';
            
            document.getElementById('gamePlayerName').textContent = gameState.currentPlayer.name;
            gameState.currentQuestionIndex = 0;
            gameState.gameStartTime = Date.now();
            
            startGameTimer();
            showQuestion();
            updatePlayerCount();
            
            // Start background music
            if (gameState.musicEnabled) {
                setTimeout(() => {
                    if (isYouTubeReady && youtubePlayer) {
                        youtubePlayer.playVideo();
                    } else if (gameState.playBackgroundMusic) {
                        gameState.playBackgroundMusic();
                    }
                }, 1000);
            }
        }

        function startGameTimer() {
            const duration = 10 * 60 * 1000; // 10 minutes
            
            gameState.gameTimer = setInterval(() => {
                const elapsed = Date.now() - gameState.gameStartTime;
                const remaining = Math.max(0, duration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer').textContent = timeString;
                
                if (document.getElementById('hostGameTime')) {
                    document.getElementById('hostGameTime').textContent = timeString;
                }
                
                if (remaining === 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateProgressBar() {
            const current = gameState.currentQuestionIndex + 1;
            const total = questions.length;
            const percentage = (current / total) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${current} dari ${total} soal`;
        }

        function showQuestion() {
            const question = questions[gameState.currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionIcon').textContent = question.icon || question.image;
            
            // Update progress bar
            updateProgressBar();
            
            // Handle question image/diagram
            const imageContainer = document.getElementById('questionImageContainer');
            const questionImage = document.getElementById('questionImage');
            const questionDiagram = document.getElementById('questionDiagram');
            
            if (question.diagram) {
                questionImage.style.display = 'none';
                questionDiagram.style.display = 'block';
                questionDiagram.innerHTML = question.diagram;
            } else if (question.image && (question.image.startsWith('http') || question.image.startsWith('data:'))) {
                // Display uploaded image or URL image
                questionImage.style.display = 'none';
                questionDiagram.style.display = 'block';
                questionDiagram.innerHTML = `
                    <div class="bg-white p-4 rounded-lg border-2 border-gray-200">
                        <div class="relative">
                            <img src="${question.image}" 
                                 alt="Gambar soal" 
                                 class="max-w-full h-auto mx-auto rounded-lg shadow-md max-h-64 object-contain"
                                 onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                                 style="opacity: 0; transition: opacity 0.3s ease;">
                            <div class="text-center p-8 bg-gray-100 rounded-lg">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">Memuat gambar...</p>
                                <div class="hidden">
                                    <div class="text-6xl mb-4">${question.icon || 'üìê'}</div>
                                    <p class="text-gray-600">Gambar tidak dapat dimuat</p>
                                    <p class="text-sm text-gray-500 mt-2">Menggunakan icon sebagai pengganti</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add timeout fallback for slow loading images
                setTimeout(() => {
                    const img = questionDiagram.querySelector('img');
                    const fallback = questionDiagram.querySelector('.hidden');
                    const loading = questionDiagram.querySelector('.animate-spin').parentElement;
                    
                    if (img && img.style.opacity === '0') {
                        img.style.display = 'none';
                        loading.style.display = 'none';
                        fallback.classList.remove('hidden');
                        fallback.style.display = 'block';
                    }
                }, 8000); // 8 second timeout
                
            } else {
                // Display emoji/icon
                questionImage.style.display = 'block';
                questionDiagram.style.display = 'none';
                questionImage.textContent = question.image || question.icon || 'üìê';
            }
            
            // Hide basketball animation
            document.getElementById('basketballAnimation').classList.add('hidden');
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            Object.entries(question.options).forEach(([key, value]) => {
                const button = document.createElement('button');
                button.className = 'w-full p-6 text-left border-3 border-white rounded-2xl hover:border-pink-400 hover:bg-gradient-to-r hover:from-pink-50 hover:to-purple-50 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl bg-gradient-to-r from-white to-blue-50 shadow-xl';
                button.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-14 h-14 bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-xl animate-pulse">
                            ${key.toUpperCase()}
                        </div>
                        <div class="flex-1 text-gray-800 font-bold text-xl">${value}</div>
                        <div class="text-3xl opacity-70">üéØ</div>
                    </div>
                `;
                button.onclick = () => selectAnswer(key, button);
                button.disabled = false;
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('nextButton').disabled = true;
        }

        function selectAnswer(answer, buttonElement) {
            // Disable all buttons to prevent multiple selections
            document.querySelectorAll('#answerOptions button').forEach(btn => {
                btn.disabled = true;
            });
            
            // Mark selected answer
            const question = questions[gameState.currentQuestionIndex];
            const isCorrect = answer === question.correct;
            
            // Remove previous selections and show immediate feedback
            document.querySelectorAll('#answerOptions button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                btn.classList.add('border-gray-300', 'opacity-60');
            });
            
            // Highlight selected answer
            if (isCorrect) {
                buttonElement.classList.remove('opacity-60');
                buttonElement.classList.add('border-green-500', 'bg-green-50', 'shadow-lg', 'transform', 'scale-105');
                buttonElement.innerHTML = buttonElement.innerHTML.replace('üîµ', '‚úÖ');
            } else {
                buttonElement.classList.remove('opacity-60');
                buttonElement.classList.add('border-red-500', 'bg-red-50', 'shadow-lg');
                buttonElement.innerHTML = buttonElement.innerHTML.replace('üîµ', '‚ùå');
                
                // Show correct answer
                document.querySelectorAll('#answerOptions button').forEach(btn => {
                    const optionKey = btn.textContent.trim().charAt(0).toLowerCase();
                    if (optionKey === question.correct) {
                        btn.classList.remove('opacity-60');
                        btn.classList.add('border-green-500', 'bg-green-50', 'shadow-lg', 'transform', 'scale-105');
                        btn.innerHTML = btn.innerHTML.replace('üîµ', '‚úÖ');
                    }
                });
            }
            
            // Update score and save answer
            if (isCorrect) {
                gameState.currentPlayer.score += 20;
            }
            
            gameState.currentPlayer.answers.push({
                questionIndex: gameState.currentQuestionIndex,
                answer: answer,
                correct: isCorrect
            });
            
            // Show basketball animation
            playBasketballAnimation(isCorrect, () => {
                // Show auto-advance message
                document.getElementById('autoAdvanceMessage').classList.remove('hidden');
                
                // Auto-advance to next question after 2 seconds
                setTimeout(() => {
                    document.getElementById('autoAdvanceMessage').classList.add('hidden');
                    nextQuestion();
                }, 2000);
                
                updateHostChart();
            });
        }

        function playBasketballAnimation(isCorrect, callback) {
            const animationContainer = document.getElementById('basketballAnimation');
            const player = document.getElementById('basketballPlayer');
            const basketball = document.getElementById('basketball');
            const ballShadow = basketball.querySelector('.ball-shadow');
            const scoreEffect = document.getElementById('scoreEffect');
            const missEffect = document.getElementById('missEffect');
            const successCelebration = document.getElementById('successCelebration');
            const hoopRim = document.querySelector('.hoop-rim');
            
            // Show animation container
            animationContainer.classList.remove('hidden');
            
            // Reset positions and states
            player.classList.remove('shooting', 'celebration', 'disappointment');
            scoreEffect.style.opacity = '0';
            scoreEffect.style.transform = 'translateY(20px)';
            missEffect.style.opacity = '0';
            missEffect.style.transform = 'translateY(20px)';
            successCelebration.style.opacity = '0';
            successCelebration.style.transform = 'translateY(20px)';
            
            // Reset ball position and remove bounce classes
            basketball.style.left = '90px';
            basketball.style.bottom = '100px';
            basketball.style.right = 'auto';
            basketball.style.transform = 'rotate(0deg) scale(1)';
            basketball.classList.remove('ball-bounce-1', 'ball-bounce-2', 'ball-bounce-3');
            
            // Reset rim shake
            if (hoopRim) {
                hoopRim.classList.remove('rim-shake');
            }
            
            // Start shooting animation
            setTimeout(() => {
                player.classList.add('shooting');
                
                // Realistic ball trajectory animation
                setTimeout(() => {
                    animateBasketballThrow(basketball, ballShadow, isCorrect, () => {
                        if (isCorrect) {
                            // Success effects
                            playSuccessSound();
                            
                            setTimeout(() => {
                                scoreEffect.style.opacity = '1';
                                scoreEffect.style.transform = 'translateY(0)';
                                successCelebration.style.opacity = '1';
                                successCelebration.style.transform = 'translateY(0)';
                            }, 200);
                        } else {
                            // Miss effects
                            playMissSound();
                            
                            // Shake the rim
                            if (hoopRim) {
                                hoopRim.classList.add('rim-shake');
                            }
                            
                            // Show miss effect
                            setTimeout(() => {
                                missEffect.style.opacity = '1';
                                missEffect.style.transform = 'translateY(0)';
                            }, 300);
                            
                            // Add bounce animations to the ball
                            setTimeout(() => {
                                basketball.classList.add('ball-bounce-1');
                            }, 100);
                            setTimeout(() => {
                                basketball.classList.remove('ball-bounce-1');
                                basketball.classList.add('ball-bounce-2');
                            }, 700);
                            setTimeout(() => {
                                basketball.classList.remove('ball-bounce-2');
                                basketball.classList.add('ball-bounce-3');
                            }, 1100);
                        }
                        
                        // Player reaction
                        setTimeout(() => {
                            player.classList.remove('shooting');
                            if (isCorrect) {
                                player.classList.add('celebration');
                            } else {
                                player.classList.add('disappointment');
                            }
                        }, 300);
                        
                        // Hide animation and call callback
                        setTimeout(() => {
                            animationContainer.classList.add('hidden');
                            callback();
                        }, 2500);
                    });
                }, 400);
                
            }, 600);
        }

        function animateBasketballThrow(ball, shadow, isCorrect, onComplete) {
            const startX = 90;
            const startY = 100;
            const hoopCenterX = 340; // Center of the hoop
            const hoopCenterY = 125; // Center of the hoop
            const rimY = 115; // Rim level
            const peakY = 220; // Height of the arc
            
            let progress = 0;
            const duration = 1200; // Animation duration in ms
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                progress = Math.min(elapsed / duration, 1);
                
                let x, y;
                
                if (isCorrect) {
                    // Perfect shot - ball goes directly into hoop center
                    x = startX + (hoopCenterX - startX) * progress;
                    
                    // Perfect parabolic arc that peaks and comes down into the hoop
                    const t = progress;
                    y = startY + 4 * (peakY - startY) * t * (1 - t) + (hoopCenterY - startY) * t;
                    
                    // Adjust trajectory in final phase to ensure it goes into hoop
                    if (progress > 0.8) {
                        const finalPhase = (progress - 0.8) / 0.2;
                        x = hoopCenterX - 5 + finalPhase * 5; // Slight adjustment to center
                        y = rimY + 10 - finalPhase * 15; // Goes down into hoop
                    }
                } else {
                    // Missed shot - ball hits rim and bounces
                    const missX = hoopCenterX + 25; // Hits front rim
                    const missY = rimY + 5;
                    
                    x = startX + (missX - startX) * progress;
                    
                    const t = progress;
                    y = startY + 4 * (peakY - startY) * t * (1 - t) + (missY - startY) * t;
                }
                
                // Ball rotation based on distance traveled
                const rotation = progress * (isCorrect ? 720 : 540);
                
                // Ball scaling for depth perception
                const scale = 1 - 0.2 * Math.sin(Math.PI * progress);
                
                // Apply transformations
                ball.style.left = x + 'px';
                ball.style.bottom = y + 'px';
                ball.style.transform = `rotate(${rotation}deg) scale(${scale})`;
                
                // Shadow animation - moves horizontally and changes size
                if (shadow) {
                    const shadowSize = 25 - 8 * Math.sin(Math.PI * progress);
                    const shadowOpacity = 0.4 - 0.15 * Math.sin(Math.PI * progress);
                    
                    shadow.style.left = '50%';
                    shadow.style.transform = 'translateX(-50%)';
                    shadow.style.width = shadowSize + 'px';
                    shadow.style.background = `radial-gradient(ellipse, rgba(0,0,0,${shadowOpacity}), transparent)`;
                }
                
                // Continue animation or finish
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Final position adjustments
                    if (isCorrect) {
                        // Ball goes through hoop and falls down inside
                        setTimeout(() => {
                            ball.style.left = hoopCenterX + 'px';
                            ball.style.bottom = (hoopCenterY - 20) + 'px';
                            ball.style.transform = `rotate(${rotation + 180}deg) scale(0.7)`;
                        }, 100);
                        setTimeout(() => {
                            ball.style.left = (hoopCenterX - 2) + 'px';
                            ball.style.bottom = (hoopCenterY - 35) + 'px';
                            ball.style.transform = `rotate(${rotation + 270}deg) scale(0.6)`;
                        }, 250);
                        setTimeout(() => {
                            ball.style.left = (hoopCenterX + 1) + 'px';
                            ball.style.bottom = (hoopCenterY - 45) + 'px';
                            ball.style.transform = `rotate(${rotation + 360}deg) scale(0.5)`;
                        }, 400);
                        
                        // Make net sway animation more pronounced for successful shots
                        const netStrands = document.querySelectorAll('.net-strand');
                        netStrands.forEach((strand, index) => {
                            strand.style.animation = 'netSwaySuccess 1s ease-out';
                            strand.style.animationDelay = (index * 0.1) + 's';
                        });
                        
                    } else {
                        // Ball bounces off rim realistically
                        setTimeout(() => {
                            ball.style.left = (hoopCenterX - 20) + 'px';
                            ball.style.bottom = '95px';
                            ball.style.transform = `rotate(${rotation + 180}deg) scale(0.9)`;
                        }, 100);
                        setTimeout(() => {
                            ball.style.left = (hoopCenterX - 45) + 'px';
                            ball.style.bottom = '65px';
                            ball.style.transform = `rotate(${rotation + 270}deg) scale(1)`;
                        }, 300);
                        setTimeout(() => {
                            ball.style.left = (hoopCenterX - 60) + 'px';
                            ball.style.bottom = '45px';
                            ball.style.transform = `rotate(${rotation + 360}deg) scale(1.1)`;
                        }, 500);
                    }
                    
                    onComplete();
                }
            }
            
            animate();
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex >= questions.length) {
                endGame();
            } else {
                showQuestion();
            }
        }

        function endGame() {
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
            }
            
            hideAllScreens();
            document.getElementById('leaderboardScreen').classList.remove('hidden');
            gameState.currentScreen = 'leaderboard';
            
            showLeaderboard();
        }

        function getRewardMessage(score) {
            if (score >= 90) {
                return {
                    title: "üåü LUAR BIASA! üåü",
                    message: "Kamu adalah Master Kesebangunan! Pemahaman matematikamu sangat menakjubkan!",
                    reward: "üèÜ Gelar: Ahli Matematika Pontianak",
                    color: "from-purple-500 via-pink-500 to-red-500",
                    icon: "üéØ",
                    animation: "animate-bounce"
                };
            } else if (score >= 80) {
                return {
                    title: "‚≠ê HEBAT SEKALI! ‚≠ê",
                    message: "Prestasi yang membanggakan! Kamu benar-benar memahami konsep kesebangunan!",
                    reward: "ü•á Gelar: Juara Matematika",
                    color: "from-yellow-400 via-orange-500 to-red-500",
                    icon: "üî•",
                    animation: "animate-pulse"
                };
            } else if (score >= 60) {
                return {
                    title: "üëè BAGUS BANGET! üëè",
                    message: "Kerja keras kamu membuahkan hasil! Terus tingkatkan lagi ya!",
                    reward: "ü•à Gelar: Pelajar Berprestasi",
                    color: "from-blue-500 via-purple-500 to-pink-500",
                    icon: "üí™",
                    animation: "animate-pulse"
                };
            } else if (score >= 40) {
                return {
                    title: "üòä TERUS SEMANGAT! üòä",
                    message: "Kamu sudah di jalan yang benar! Sedikit lagi pasti bisa lebih baik!",
                    reward: "ü•â Gelar: Pejuang Matematika",
                    color: "from-green-400 via-blue-500 to-purple-500",
                    icon: "üå±",
                    animation: "animate-bounce"
                };
            } else {
                return {
                    title: "üí™ JANGAN MENYERAH! üí™",
                    message: "Setiap ahli pernah menjadi pemula. Ayo coba lagi dan pasti bisa!",
                    reward: "üåü Gelar: Pemberani Belajar",
                    color: "from-pink-400 via-red-500 to-yellow-500",
                    icon: "üöÄ",
                    animation: "animate-bounce"
                };
            }
        }

        function showLeaderboard() {
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            const leaderboardList = document.getElementById('leaderboardList');
            
            leaderboardList.innerHTML = '';
            
            // Show personal reward message for current player
            if (gameState.currentPlayer) {
                const playerScore = gameState.currentPlayer.score;
                const reward = getRewardMessage(playerScore);
                
                const rewardDiv = document.createElement('div');
                rewardDiv.className = `mb-8 p-6 rounded-2xl bg-gradient-to-r ${reward.color} text-white text-center transform ${reward.animation} shadow-2xl border-4 border-white reward-glow`;
                rewardDiv.innerHTML = `
                    <div class="text-6xl mb-4 reward-sparkle">${reward.icon}</div>
                    <h3 class="text-2xl font-bold mb-3">${reward.title}</h3>
                    <p class="text-lg mb-4 leading-relaxed">${reward.message}</p>
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 mb-4 reward-float">
                        <p class="text-xl font-bold">${reward.reward}</p>
                    </div>
                    <div class="flex justify-center items-center space-x-4 text-2xl">
                        <span class="animate-spin reward-sparkle">‚≠ê</span>
                        <span class="text-3xl font-bold">${playerScore} POIN</span>
                        <span class="animate-spin reward-sparkle">‚≠ê</span>
                    </div>
                    <div class="mt-4 flex justify-center space-x-2">
                        ${Array.from({length: Math.min(5, Math.floor(playerScore/20))}, () => 'üåü').join('')}
                        ${Array.from({length: Math.max(0, 5 - Math.floor(playerScore/20))}, () => '‚≠ê').join('')}
                    </div>
                `;
                leaderboardList.appendChild(rewardDiv);
            }
            
            // Add motivational quote section
            const quotes = [
                "\"Matematika adalah bahasa yang digunakan Tuhan untuk menulis alam semesta\" - Galileo",
                "\"Dalam matematika, kamu tidak memahami sesuatu. Kamu hanya terbiasa dengannya\" - John von Neumann",
                "\"Matematika adalah musik akal\" - James Joseph Sylvester",
                "\"Kesuksesan adalah hasil dari persiapan, kerja keras, dan belajar dari kegagalan\" - Colin Powell"
            ];
            
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            const quoteDiv = document.createElement('div');
            quoteDiv.className = 'mb-6 p-4 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl border-2 border-indigo-200 reward-float';
            quoteDiv.innerHTML = `
                <div class="text-center">
                    <div class="text-3xl mb-2 reward-sparkle">üí≠</div>
                    <p class="text-gray-700 italic font-medium">${randomQuote}</p>
                </div>
            `;
            leaderboardList.appendChild(quoteDiv);
            
            // Show leaderboard title
            const titleDiv = document.createElement('div');
            titleDiv.className = 'mb-4 text-center';
            titleDiv.innerHTML = `
                <h3 class="text-2xl font-bold text-gray-800 mb-2">üèÜ Papan Peringkat üèÜ</h3>
                <p class="text-gray-600">Hasil semua pemain yang telah menyelesaikan game</p>
            `;
            leaderboardList.appendChild(titleDiv);
            
            sortedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                const playerReward = getRewardMessage(player.score);
                
                div.className = `flex items-center justify-between p-4 rounded-xl mb-3 transform hover:scale-105 transition-all duration-300 shadow-lg ${
                    index === 0 ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white border-4 border-yellow-300 reward-glow' :
                    index === 1 ? 'bg-gradient-to-r from-gray-400 to-gray-500 text-white border-4 border-gray-300' :
                    index === 2 ? 'bg-gradient-to-r from-orange-400 to-orange-600 text-white border-4 border-orange-300' :
                    'bg-gradient-to-r from-blue-100 to-purple-100 border-2 border-blue-200'
                }`;
                
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const isCurrentPlayer = player.id === gameState.currentPlayer?.id;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-3xl ${index < 3 ? 'reward-sparkle' : ''}">${medal}</div>
                            ${index < 3 ? '<div class="text-xs opacity-75">TOP 3</div>' : ''}
                        </div>
                        <div>
                            <p class="font-bold text-lg ${isCurrentPlayer ? 'animate-pulse' : ''}">${player.name} ${isCurrentPlayer ? 'üë§' : ''}</p>
                            <p class="text-sm opacity-75">${player.answers.filter(a => a.correct).length}/5 benar</p>
                            <div class="flex items-center space-x-1 mt-1">
                                ${Array.from({length: Math.min(5, Math.floor(player.score/20))}, () => '‚≠ê').join('')}
                                ${Array.from({length: Math.max(0, 5 - Math.floor(player.score/20))}, () => '‚òÜ').join('')}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold">${player.score}</p>
                        <p class="text-sm opacity-75">poin</p>
                        <div class="text-xs opacity-75">${playerReward.reward.split(': ')[1]}</div>
                    </div>
                `;
                
                leaderboardList.appendChild(div);
            });
            
            // Add encouragement section
            const encouragementDiv = document.createElement('div');
            encouragementDiv.className = 'mt-8 p-6 bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 rounded-2xl text-white text-center reward-float';
            encouragementDiv.innerHTML = `
                <div class="text-4xl mb-3 reward-sparkle">üéâ</div>
                <h3 class="text-xl font-bold mb-2">Selamat untuk Semua Pemain!</h3>
                <p class="mb-4">Kalian semua adalah pemenang karena sudah berani belajar matematika!</p>
                <div class="flex justify-center space-x-4 text-2xl">
                    <span class="reward-sparkle">üåü</span>
                    <span class="reward-sparkle">üéØ</span>
                    <span class="reward-sparkle">üèÜ</span>
                    <span class="reward-sparkle">üí™</span>
                    <span class="reward-sparkle">üöÄ</span>
                </div>
            `;
            leaderboardList.appendChild(encouragementDiv);
        }

        function resetGame() {
            gameState.currentQuestionIndex = 0;
            gameState.currentPlayer.score = 0;
            gameState.currentPlayer.answers = [];
            startGame();
        }

        // Host Functions
        function loginHost() {
            const password = document.getElementById('hostPassword').value;
            if (password === 'admin123') {
                hideAllScreens();
                document.getElementById('hostPanelScreen').classList.remove('hidden');
                gameState.currentScreen = 'hostPanel';
                initHostPanel();
            } else {
                alert('Password salah!');
            }
        }

        function initHostPanel() {
            updatePlayerCount();
            initHostChart();
            updateHostChart();
        }

        function startGameAsHost() {
            if (gameState.players.length === 0) {
                alert('Belum ada pemain yang bergabung!');
                return;
            }
            
            // Start game for all players
            gameState.gameStartTime = Date.now();
            startGameTimer();
            updateHostChart();
        }

        function updateHostPlayerList() {
            const hostPlayerList = document.getElementById('hostPlayerList');
            if (!hostPlayerList) return;
            
            hostPlayerList.innerHTML = '';
            
            if (gameState.players.length === 0) {
                hostPlayerList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üë•</div>
                        <p>Belum ada pemain yang bergabung</p>
                    </div>
                `;
                return;
            }
            
            // Sort players by score (highest first)
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            
            sortedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const correctAnswers = player.answers.filter(a => a.correct).length;
                const totalAnswers = player.answers.length;
                
                div.className = `flex items-center justify-between p-3 rounded-lg transition-all hover:shadow-md ${
                    index === 0 ? 'bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200' :
                    index === 1 ? 'bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200' :
                    index === 2 ? 'bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200' :
                    'bg-gray-50'
                }`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">${rankIcon}</div>
                        <div>
                            <p class="font-medium text-gray-800">${player.name}</p>
                            <p class="text-sm text-gray-600">Bergabung: ${player.joinTime.toLocaleTimeString()}</p>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" 
                                         style="width: ${(totalAnswers / 5) * 100}%"></div>
                                </div>
                                <span class="text-xs text-gray-500">${totalAnswers}/5</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xl font-bold text-blue-600">${player.score}</p>
                        <p class="text-sm text-gray-600">poin</p>
                        <p class="text-xs text-green-600">${correctAnswers} benar</p>
                    </div>
                `;
                hostPlayerList.appendChild(div);
            });
        }

        function initHostChart() {
            const ctx = document.getElementById('liveScoreChart');
            if (!ctx) return;
            
            if (gameState.hostChart) {
                gameState.hostChart.destroy();
            }
            
            gameState.hostChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['üî¥ Rendah (0-20)', 'üü° Cukup (21-40)', 'üîµ Baik (41-60)', 'üü¢ Sangat Baik (61-80)', 'üü£ Sempurna (81-100)'],
                    datasets: [{
                        label: 'Jumlah Pemain',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.9)',
                            'rgba(245, 158, 11, 0.9)',
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(16, 185, 129, 0.9)',
                            'rgba(139, 92, 246, 0.9)'
                        ],
                        borderColor: [
