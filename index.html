<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÄ Ethnomath - Game Kesebangunan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Poppins:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: 
                linear-gradient(rgba(0,0,0,0.2), rgba(255,69,0,0.3)),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="sky" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23FF1493;stop-opacity:1" /><stop offset="30%" style="stop-color:%23FF4500;stop-opacity:1" /><stop offset="60%" style="stop-color:%23FFD700;stop-opacity:1" /><stop offset="100%" style="stop-color:%23FF6347;stop-opacity:1" /></linearGradient></defs><rect width="1200" height="800" fill="url(%23sky)"/><g transform="translate(80,350)"><rect x="0" y="120" width="240" height="180" fill="%23FF4500" stroke="%23FF1493" stroke-width="4" rx="8"/><polygon points="0,120 40,60 120,20 200,60 240,120" fill="%23DC143C" stroke="%23B22222" stroke-width="3"/><rect x="20" y="180" width="50" height="100" fill="%23654321" stroke="%234A4A4A" stroke-width="2"/><rect x="140" y="160" width="80" height="80" fill="%2300BFFF" stroke="%230080FF" stroke-width="3"/><rect x="10" y="100" width="220" height="20" fill="%23FF8C00" stroke="%23FF4500" stroke-width="2"/><rect x="100" y="40" width="40" height="80" fill="%23DC143C" stroke="%23B22222" stroke-width="2"/><rect x="0" y="300" width="240" height="40" fill="%23FF6347" stroke="%23FF4500" stroke-width="2"/><rect x="80" y="200" width="80" height="100" fill="%23FFD700" stroke="%23FF8C00" stroke-width="2"/></g><g transform="translate(380,380)"><rect x="0" y="100" width="200" height="160" fill="%23FF6347" stroke="%23FF4500" stroke-width="4" rx="6"/><polygon points="0,100 30,50 100,15 170,50 200,100" fill="%23FF1493" stroke="%23DC143C" stroke-width="3"/><rect x="15" y="160" width="40" height="90" fill="%23654321" stroke="%234A4A4A" stroke-width="2"/><rect x="120" y="140" width="60" height="60" fill="%2300BFFF" stroke="%230080FF" stroke-width="3"/><rect x="5" y="85" width="190" height="15" fill="%23FF8C00" stroke="%23FF4500" stroke-width="2"/><rect x="85" y="35" width="30" height="65" fill="%23DC143C" stroke="%23B22222" stroke-width="2"/><rect x="0" y="260" width="200" height="30" fill="%23FF6347" stroke="%23FF4500" stroke-width="2"/></g><g transform="translate(680,360)"><rect x="0" y="120" width="260" height="200" fill="%23FFD700" stroke="%23FF8C00" stroke-width="4" rx="10"/><polygon points="0,120 50,50 130,10 210,50 260,120" fill="%23DC143C" stroke="%23B22222" stroke-width="3"/><rect x="25" y="190" width="55" height="110" fill="%23654321" stroke="%234A4A4A" stroke-width="2"/><rect x="150" y="165" width="85" height="85" fill="%2300BFFF" stroke="%230080FF" stroke-width="3"/><rect x="10" y="100" width="240" height="20" fill="%23FF8C00" stroke="%23FF4500" stroke-width="2"/><rect x="110" y="30" width="40" height="90" fill="%23DC143C" stroke="%23B22222" stroke-width="2"/><rect x="0" y="320" width="260" height="50" fill="%23FF6347" stroke="%23FF4500" stroke-width="2"/><rect x="90" y="180" width="100" height="140" fill="%23FFD700" stroke="%23FF8C00" stroke-width="2"/></g><g fill="%2300FF00"><ellipse cx="50" cy="600" rx="30" ry="80"/><ellipse cx="350" cy="580" rx="25" ry="70"/><ellipse cx="650" cy="620" rx="35" ry="90"/><ellipse cx="950" cy="590" rx="28" ry="75"/></g><g fill="%2332CD32"><circle cx="50" cy="520" r="40"/><circle cx="350" cy="510" r="35"/><circle cx="650" cy="530" r="45"/><circle cx="950" cy="515" r="38"/></g></svg>'),
                linear-gradient(45deg, #FF1493 0%, #FF4500 25%, #FFD700 50%, #00BFFF 75%, #32CD32 100%);
            background-size: cover, cover, 400% 400%;
            background-position: center, center, 0% 50%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .game-title {
            font-family: 'Fredoka One', cursive;
            background: linear-gradient(45deg, #FF1493, #FF4500, #FFD700, #00BFFF, #32CD32, #FF6347, #9932CC);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGradient 3s ease infinite;
        }
        
        @keyframes titleGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .basketball-court {
            background: linear-gradient(135deg, #FF4500, #FF1493, #FFD700, #00BFFF);
            position: relative;
            overflow: hidden;
        }
        
        .basketball-court::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        
        .player {
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
        }
        
        .ball {
            transition: all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
        }
        
        .ring {
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.4));
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3) translateY(100px); opacity: 0; }
            50% { transform: scale(1.05) translateY(-10px); }
            70% { transform: scale(0.9) translateY(5px); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            50% { transform: scale(1.3) rotate(0deg); }
            75% { transform: scale(1.2) rotate(10deg); }
        }
        
        @keyframes miss {
            0% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-15px) rotate(-5deg); }
            50% { transform: translateX(15px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-3deg); }
            100% { transform: translateX(0) rotate(0deg); }
        }
        
        @keyframes ballBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }
        
        @keyframes scorePopup {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        
        .bounce-in { animation: bounceIn 0.8s ease-out; }
        .celebrate { animation: celebrate 1s ease-in-out; }
        .miss { animation: miss 0.8s ease-in-out; }
        .ball-bounce { animation: ballBounce 0.6s infinite; }
        .score-popup { animation: scorePopup 0.6s ease-out; }
        .sparkle { animation: sparkle 1s ease-in-out infinite; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255, 20, 147, 0.5);
            box-shadow: 0 25px 45px rgba(255, 69, 0, 0.6);
        }
        
        .neon-button {
            background: linear-gradient(45deg, #FF1493, #FF4500, #FFD700);
            box-shadow: 0 0 25px rgba(255, 20, 147, 0.8);
            transition: all 0.3s ease;
        }
        
        .neon-button:hover {
            box-shadow: 0 0 40px rgba(255, 69, 0, 1);
            transform: translateY(-3px) scale(1.05);
        }
        
        .option-button {
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 20, 147, 0.4);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .option-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(255, 69, 0, 0.4);
            border-color: rgba(255, 20, 147, 0.8);
        }
        
        .correct-answer {
            background: linear-gradient(135deg, #00FF00, #32CD32) !important;
            border-color: #00FF00 !important;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.8) !important;
        }
        
        .wrong-answer {
            background: linear-gradient(135deg, #FF1493, #DC143C) !important;
            border-color: #FF1493 !important;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.8) !important;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-ring {
            animation: pulseRing 2s infinite;
        }
        
        @keyframes pulseRing {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti 3s ease-in-out infinite;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(300px) rotate(720deg); opacity: 0; }
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: floatShapes 20s linear infinite;
        }
        
        @keyframes floatShapes {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        .rainbow-text {
            background: linear-gradient(45deg, #FF1493, #FF4500, #FFD700, #00BFFF, #32CD32, #FF6347, #9932CC, #FF1493);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowShift 3s ease infinite;
        }
        
        @keyframes rainbowShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .card-hover:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .mobile-friendly {
            padding: 1rem;
        }
        
        @media (max-width: 768px) {
            .mobile-friendly {
                padding: 0.5rem;
            }
            
            .text-responsive {
                font-size: clamp(1rem, 4vw, 2rem);
            }
            
            .title-responsive {
                font-size: clamp(2rem, 8vw, 4rem);
            }
            
            .button-responsive {
                padding: 0.75rem 1.5rem;
                font-size: clamp(0.9rem, 3vw, 1.1rem);
            }
        }
    </style>
</head>
<body class="min-h-screen">
    
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape text-6xl" style="left: 10%; animation-delay: 0s;">üåü</div>
        <div class="shape text-5xl" style="left: 20%; animation-delay: 2s;">üé®</div>
        <div class="shape text-4xl" style="left: 30%; animation-delay: 4s;">üéØ</div>
        <div class="shape text-6xl" style="left: 40%; animation-delay: 6s;">üöÄ</div>
        <div class="shape text-5xl" style="left: 50%; animation-delay: 8s;">‚≠ê</div>
        <div class="shape text-4xl" style="left: 60%; animation-delay: 10s;">üé™</div>
        <div class="shape text-6xl" style="left: 70%; animation-delay: 12s;">üé≠</div>
        <div class="shape text-5xl" style="left: 80%; animation-delay: 14s;">üé®</div>
        <div class="shape text-4xl" style="left: 90%; animation-delay: 16s;">üåà</div>
        <div class="shape text-6xl" style="left: 15%; animation-delay: 18s;">üéä</div>
        <div class="shape text-5xl" style="left: 25%; animation-delay: 1s;">üìê</div>
        <div class="shape text-4xl" style="left: 35%; animation-delay: 3s;">üìè</div>
        <div class="shape text-6xl" style="left: 45%; animation-delay: 5s;">üî¢</div>
        <div class="shape text-5xl" style="left: 55%; animation-delay: 7s;">üìä</div>
        <div class="shape text-4xl" style="left: 65%; animation-delay: 9s;">üé≤</div>
        <div class="shape text-6xl" style="left: 75%; animation-delay: 11s;">üèÜ</div>
        <div class="shape text-5xl" style="left: 85%; animation-delay: 13s;">üéâ</div>
        <div class="shape text-4xl" style="left: 95%; animation-delay: 15s;">‚ú®</div>
    </div>
    
    <!-- Host Dashboard Button (Only visible on home page) -->
    <button id="hostButton" onclick="showHostLogin()" class="fixed bottom-4 left-4 z-50 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap">
            Host Dashboard
        </div>
    </button>

    <!-- Host Login Modal -->
    <div id="hostLoginModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-8 max-w-md mx-4 shadow-2xl bounce-in">
            <div class="text-6xl mb-4 text-center">üîê</div>
            <h3 class="text-3xl font-bold text-white mb-6 text-center">Host Login</h3>
            <input type="password" id="hostPassword" placeholder="Masukkan password host..." 
                   class="w-full px-6 py-4 rounded-full text-lg font-semibold text-gray-800 bg-white/90 backdrop-blur-sm border-2 border-white/30 focus:border-cyan-400 focus:outline-none focus:ring-4 focus:ring-cyan-400/30 transition-all duration-300 mb-4">
            <p class="text-gray-300 text-sm mb-6 text-center">Password: <span class="text-yellow-300 font-bold">admin123</span></p>
            <div class="flex space-x-4">
                <button onclick="hideHostLogin()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                    ‚ùå Batal
                </button>
                <button onclick="verifyHostPassword()" class="flex-1 bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                    üîì Masuk
                </button>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="min-h-screen flex items-center justify-center mobile-friendly">
        <div class="max-w-4xl mx-auto text-center w-full">
            <div class="glass-card rounded-3xl p-4 md:p-8 shadow-2xl bounce-in card-hover">
                <!-- Fun Header with Emojis -->
                <div class="mb-6">
                    <div class="text-4xl md:text-6xl mb-2">üéÆüåàüìê‚ú®</div>
                    <h1 class="title-responsive font-bold rainbow-text mb-4">üèÄ ETHNOMATH</h1>
                    <h2 class="text-responsive text-gray-800 font-bold mb-4 floating">Game Kesebangunan Super Seru!</h2>
                    <div class="text-2xl md:text-3xl mb-4">üéØüé™üöÄüéä</div>
                </div>
                
                <!-- Fun Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-6">
                    <div class="glass-card rounded-2xl p-3 card-hover">
                        <div class="text-2xl md:text-3xl">üé≤</div>
                        <div class="text-sm md:text-base text-blue-600 font-bold">5 Soal</div>
                        <div class="text-xs text-gray-700">Seru!</div>
                    </div>
                    <div class="glass-card rounded-2xl p-3 card-hover">
                        <div class="text-2xl md:text-3xl">‚è∞</div>
                        <div class="text-sm md:text-base text-green-600 font-bold">10 Menit</div>
                        <div class="text-xs text-gray-700">Waktu</div>
                    </div>
                    <div class="glass-card rounded-2xl p-3 card-hover">
                        <div class="text-2xl md:text-3xl">üèÜ</div>
                        <div class="text-sm md:text-base text-yellow-600 font-bold">100 Poin</div>
                        <div class="text-xs text-gray-700">Maksimal</div>
                    </div>
                    <div class="glass-card rounded-2xl p-3 card-hover">
                        <div class="text-2xl md:text-3xl">üé®</div>
                        <div class="text-sm md:text-base text-purple-600 font-bold">Animasi</div>
                        <div class="text-xs text-gray-700">Keren!</div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <button onclick="showMaterial()" class="w-full md:w-auto neon-button text-white button-responsive rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        üìö Pelajari Materi Dulu ü§ì
                    </button>
                    <br>
                    <button onclick="showNameInput()" class="w-full md:w-auto bg-gradient-to-r from-pink-400 via-purple-500 to-indigo-500 hover:from-pink-500 hover:via-purple-600 hover:to-indigo-600 text-white button-responsive rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        üöÄ MULAI BERMAIN SEKARANG! üéÆ
                    </button>
                </div>
                
                <!-- Fun Footer -->
                <div class="mt-6 text-sm md:text-base text-gray-700 font-semibold">
                    <div class="mb-2">üåü Belajar Matematika Jadi Menyenangkan! üåü</div>
                    <div class="flex justify-center space-x-2 text-2xl">
                        <span class="animate-bounce">üéâ</span>
                        <span class="animate-bounce" style="animation-delay: 0.1s;">üéä</span>
                        <span class="animate-bounce" style="animation-delay: 0.2s;">üéà</span>
                        <span class="animate-bounce" style="animation-delay: 0.3s;">üéÅ</span>
                        <span class="animate-bounce" style="animation-delay: 0.4s;">üé™</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
                
                <!-- Name Input Modal (Hidden by default) -->
                <div id="nameInputModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="glass-card rounded-3xl p-8 max-w-md mx-4 shadow-2xl bounce-in">
                        <div class="text-6xl mb-4 text-center">üë§</div>
                        <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">Siapa Nama Kamu?</h3>
                        <input type="text" id="playerName" placeholder="Tulis nama kamu di sini..." 
                               class="w-full px-6 py-4 rounded-full text-lg font-semibold text-gray-800 bg-white/90 backdrop-blur-sm border-2 border-white/30 focus:border-cyan-400 focus:outline-none focus:ring-4 focus:ring-cyan-400/30 transition-all duration-300 mb-4"
                               maxlength="20">
                        <p class="text-gray-600 text-sm mb-6 text-center">Nama akan ditampilkan di papan skor! ‚ú®</p>
                        <div class="flex space-x-4">
                            <button onclick="hideNameInput()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                                ‚ùå Batal
                            </button>
                            <button onclick="startGameWithName()" class="flex-1 bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                                üéÆ Mulai!
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Material Page -->
    <div id="materialPage" class="hidden min-h-screen mobile-friendly">
        <div class="max-w-5xl mx-auto">
            <div class="glass-card rounded-3xl p-4 md:p-8 shadow-2xl card-hover">
                <div class="flex flex-col md:flex-row items-center justify-between mb-6 md:mb-8 space-y-4 md:space-y-0">
                    <div class="text-center md:text-left">
                        <div class="text-4xl md:text-6xl mb-2">üìöüåà‚ú®</div>
                        <h1 class="title-responsive font-bold rainbow-text">Materi Kesebangunan</h1>
                        <div class="text-2xl md:text-3xl mt-2">üéØüìêüé®</div>
                    </div>
                    <button onclick="showHome()" class="bg-gradient-to-r from-red-400 via-pink-500 to-purple-500 hover:from-red-500 hover:via-pink-600 hover:to-purple-600 text-white button-responsive rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        ‚Üê Kembali üè†
                    </button>
                </div>
                
                <div class="space-y-4 md:space-y-6">
                    <!-- Definisi Kesebangunan -->
                    <div class="glass-card rounded-2xl p-4 md:p-6 floating card-hover bg-gradient-to-r from-yellow-400/20 to-orange-400/20">
                        <div class="text-center mb-4">
                            <div class="text-4xl md:text-5xl mb-2">üîç‚ú®</div>
                            <div class="text-2xl">üéØüåüüé®</div>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold rainbow-text mb-4 text-center">KESEBANGUNAN</h2>
                        <p class="text-gray-800 leading-relaxed text-lg mb-4">
                            <strong class="text-red-600">Kesebangunan</strong> adalah hubungan dua bangun yang memiliki 
                            <strong class="text-red-600">bentuk sama</strong> tetapi <strong class="text-red-600">ukuran belum tentu sama</strong>.
                        </p>
                        
                        <div class="mt-6">
                            <h3 class="text-xl font-bold text-blue-600 mb-3">Dua bangun dikatakan sebangun jika:</h3>
                            <ul class="text-gray-800 space-y-2 ml-4">
                                <li class="flex items-start">
                                    <span class="text-red-500 mr-2">‚Ä¢</span>
                                    <span>Bentuknya sama (sudut-sudut yang bersesuaian sama besar).</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-red-500 mr-2">‚Ä¢</span>
                                    <span>Perbandingan panjang sisi-sisi yang bersesuaian sama.</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Gambar Ilustrasi -->
                    <div class="glass-card rounded-2xl p-6 floating" style="animation-delay: 0.2s;">
                        <div class="text-center">
                            <img src="https://imgur.com/h2ms2hb.jpg" alt="Ilustrasi Kesebangunan" 
                                 class="max-w-full h-auto rounded-lg mx-auto shadow-lg"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="hidden bg-gradient-to-r from-blue-500 to-purple-600 text-white p-8 rounded-lg">
                                <div class="text-4xl mb-4">üìê</div>
                                <p class="text-lg">Ilustrasi Kesebangunan</p>
                                <p class="text-sm opacity-75 mt-2">Gambar menunjukkan dua bangun sebangun</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rumus -->
                    <div class="glass-card rounded-2xl p-6 floating" style="animation-delay: 0.4s;">
                        <div class="text-4xl mb-4">üìè</div>
                        <h3 class="text-2xl font-bold text-green-600 mb-4">Rumus Perbandingan Sisi:</h3>
                        <div class="bg-gradient-to-r from-yellow-300 to-orange-300 rounded-xl p-6 text-center border-3 border-orange-500">
                            <div class="text-2xl font-bold text-gray-800 mb-2">
                                <span class="text-red-600">sisi 1</span> / <span class="text-red-600">sisi 1'</span> = 
                                <span class="text-red-600">sisi 2</span> / <span class="text-red-600">sisi 2'</span> = ‚ãØ
                            </div>
                        </div>
                    </div>

                    <!-- Simbol -->
                    <div class="glass-card rounded-2xl p-6 floating" style="animation-delay: 0.6s;">
                        <div class="text-4xl mb-4">üî§</div>
                        <h3 class="text-2xl font-bold text-pink-600 mb-4">Simbol Kesebangunan:</h3>
                        <div class="bg-gradient-to-r from-pink-300 to-red-300 rounded-xl p-6 text-center border-3 border-pink-500">
                            <div class="text-3xl font-bold text-gray-800 mb-2">‚àÜABC ~ ‚àÜDEF</div>
                            <p class="text-gray-700">yang artinya segitiga ABC sebangun dengan segitiga DEF.</p>
                        </div>
                    </div>

                    <!-- Contoh Soal -->
                    <div class="glass-card rounded-2xl p-6 floating" style="animation-delay: 0.8s;">
                        <div class="text-4xl mb-4">üí°</div>
                        <h3 class="text-2xl font-bold text-orange-600 mb-4">Contoh Soal Singkat:</h3>
                        
                        <div class="bg-gradient-to-r from-orange-200 to-yellow-200 rounded-xl p-6 mb-4 border-3 border-orange-400">
                            <p class="text-gray-800 mb-4">
                                <strong class="text-orange-600">Soal:</strong><br>
                                ‚àÜPQR sebangun dengan ‚àÜXYZ. Panjang PQ = 4 cm, QR = 6 cm, dan XY = 6 cm. 
                                Tentukan panjang YZ.
                            </p>
                            
                            <div class="border-l-4 border-blue-600 pl-4">
                                <p class="text-blue-600 font-bold mb-2">Penyelesaian:</p>
                                <div class="space-y-2 text-gray-800">
                                    <p><span class="text-red-600">PQ/XY</span> = <span class="text-red-600">QR/YZ</span></p>
                                    <p><span class="text-red-600">4/6</span> = <span class="text-red-600">6/YZ</span></p>
                                    <p>YZ = <span class="text-red-600">(6√ó6)/4</span></p>
                                    <p class="text-green-600 font-bold text-xl">YZ = 9 cm</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="showNameInput()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-12 py-4 rounded-full font-bold text-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Ayo Main Sekarang! üéÆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Page -->
    <div id="gamePage" class="hidden min-h-screen mobile-friendly">
        <div class="max-w-7xl mx-auto">
            <!-- Game Header -->
            <div class="glass-card rounded-2xl p-3 md:p-4 mb-4 md:mb-6 card-hover bg-gradient-to-r from-purple-500/20 to-pink-500/20">
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                    <div class="flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-6">
                        <div class="text-center">
                            <div class="text-2xl md:text-3xl mb-1">üéÆüåà</div>
                            <h2 class="text-xl md:text-2xl font-bold rainbow-text">ETHNOMATH QUIZ</h2>
                        </div>
                        <div class="bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-3 md:px-4 py-2 rounded-full font-bold text-sm md:text-base">
                            üéØ Soal <span id="questionNumber">1</span>/5
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 md:space-x-6">
                        <div class="text-center">
                            <div class="text-2xl">üë§</div>
                            <div class="text-sm md:text-lg font-bold text-cyan-400" id="playerNameDisplay">Pemain</div>
                            <div class="text-xs text-gray-700">NAMA</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl">üèÜ</div>
                            <div class="text-xl md:text-3xl font-bold text-green-500" id="currentScore">0</div>
                            <div class="text-xs text-gray-700">SKOR</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl">‚è∞</div>
                            <div class="text-lg md:text-2xl font-bold text-orange-500" id="timeRemaining">10:00</div>
                            <div class="text-xs text-gray-700">WAKTU</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-4 md:gap-8">
                <!-- Basketball Animation -->
                <div class="glass-card rounded-3xl p-3 md:p-6 card-hover bg-gradient-to-br from-orange-400/20 to-red-400/20">
                    <div class="text-center mb-2">
                        <div class="text-2xl md:text-3xl">üèÄüéØ‚ú®</div>
                    </div>
                    <div class="basketball-court rounded-2xl p-4 md:p-8 relative h-64 md:h-96 overflow-hidden">
                        <!-- Confetti Elements -->
                        <div id="confettiContainer" class="absolute inset-0 pointer-events-none"></div>
                        
                        <!-- Basketball Ring with Pulse Effect -->
                        <div class="absolute top-8 right-12 ring">
                            <div class="pulse-ring absolute inset-0 bg-orange-400 rounded-full opacity-20"></div>
                            <svg width="100" height="80" viewBox="0 0 100 80">
                                <defs>
                                    <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff8c00;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff4500;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <ellipse cx="50" cy="20" rx="40" ry="10" fill="url(#ringGradient)" stroke="#cc5500" stroke-width="3"/>
                                <rect x="47" y="20" width="6" height="35" fill="#8B4513" rx="3"/>
                                <path d="M 15 20 Q 50 35 85 20" stroke="white" stroke-width="3" fill="none"/>
                                <path d="M 20 22 Q 50 37 80 22" stroke="white" stroke-width="2" fill="none"/>
                            </svg>
                        </div>
                        
                        <!-- Basketball Player -->
                        <div id="basketballPlayer" class="absolute bottom-8 left-12 player">
                            <svg width="80" height="100" viewBox="0 0 80 100">
                                <defs>
                                    <linearGradient id="skinGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FDBCB4;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#F7A399;stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="shirtGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#357ABD;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <!-- Body -->
                                <rect x="25" y="40" width="30" height="40" fill="url(#shirtGradient)" rx="8"/>
                                <!-- Head -->
                                <circle cx="40" cy="25" r="15" fill="url(#skinGradient)"/>
                                <!-- Hair -->
                                <path d="M 28 15 Q 40 8 52 15 Q 50 12 40 12 Q 30 12 28 15" fill="#4A4A4A"/>
                                <!-- Eyes -->
                                <circle cx="35" cy="22" r="2" fill="#000"/>
                                <circle cx="45" cy="22" r="2" fill="#000"/>
                                <!-- Smile -->
                                <path d="M 35 28 Q 40 32 45 28" stroke="#000" stroke-width="2" fill="none"/>
                                <!-- Arms -->
                                <rect x="12" y="45" width="12" height="25" fill="url(#skinGradient)" rx="6"/>
                                <rect x="56" y="45" width="12" height="25" fill="url(#skinGradient)" rx="6"/>
                                <!-- Legs -->
                                <rect x="28" y="80" width="10" height="20" fill="#2C3E50" rx="5"/>
                                <rect x="42" y="80" width="10" height="20" fill="#2C3E50" rx="5"/>
                                <!-- Shoes -->
                                <ellipse cx="33" cy="98" rx="8" ry="4" fill="#000"/>
                                <ellipse cx="47" cy="98" rx="8" ry="4" fill="#000"/>
                                <!-- Jersey Number -->
                                <text x="40" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="bold">7</text>
                            </svg>
                        </div>
                        
                        <!-- Basketball -->
                        <div id="basketball" class="absolute bottom-28 left-28 ball">
                            <svg width="32" height="32" viewBox="0 0 32 32">
                                <defs>
                                    <radialGradient id="ballGradient" cx="30%" cy="30%">
                                        <stop offset="0%" style="stop-color:#ff8c00;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff4500;stop-opacity:1" />
                                    </radialGradient>
                                </defs>
                                <circle cx="16" cy="16" r="15" fill="url(#ballGradient)" stroke="#cc5500" stroke-width="2"/>
                                <path d="M 2 16 Q 16 2 30 16" stroke="#cc5500" stroke-width="2" fill="none"/>
                                <path d="M 2 16 Q 16 30 30 16" stroke="#cc5500" stroke-width="2" fill="none"/>
                                <line x1="16" y1="1" x2="16" y2="31" stroke="#cc5500" stroke-width="2"/>
                            </svg>
                        </div>
                        
                        <!-- Score Display -->
                        <div id="scoreDisplay" class="absolute top-4 left-4 text-white font-bold text-4xl opacity-0 transition-all duration-500 score-popup">
                            +20
                        </div>
                        
                        <!-- Sparkle Effects -->
                        <div id="sparkleContainer" class="absolute inset-0 pointer-events-none"></div>
                    </div>
                </div>

                <!-- Question Panel -->
                <div class="glass-card rounded-3xl p-3 md:p-6 card-hover bg-gradient-to-br from-blue-400/20 to-purple-400/20">
                    <div class="text-center mb-4">
                        <div class="text-2xl md:text-3xl">ü§îüí≠‚ú®</div>
                    </div>
                    <div id="questionPanel" class="min-h-64 md:h-96 flex flex-col justify-between">
                        <div>
                            <h3 class="text-xl md:text-3xl font-bold rainbow-text mb-4 md:mb-6 text-center" id="questionTitle">ü§î Soal 1</h3>
                            <div class="glass-card rounded-2xl p-3 md:p-6 mb-4 md:mb-6 bg-gradient-to-r from-indigo-400/20 to-cyan-400/20">
                                <!-- Question Image -->
                                <div id="questionImageContainer" class="mb-4 text-center">
                                    <img id="questionImage" src="" alt="Gambar soal" 
                                         class="max-w-full h-auto rounded-lg mx-auto shadow-lg max-h-48 object-contain"
                                         style="display: none;"
                                         onerror="this.style.display='none'; document.getElementById('questionImageFallback').style.display='block';">
                                    <div id="questionImageFallback" class="hidden bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg">
                                        <div class="text-4xl mb-2">üìê</div>
                                        <p class="text-lg">Ilustrasi Soal Kesebangunan</p>
                                    </div>
                                </div>
                                <!-- Question Text -->
                                <p class="text-gray-800 leading-relaxed text-lg font-semibold" id="questionText">
                                    Dua segitiga ABC dan DEF sebangun. Jika AB = 6 cm, BC = 8 cm, dan DE = 9 cm, 
                                    maka panjang EF adalah...
                                </p>
                            </div>
                        </div>
                        
                        <div class="space-y-3 md:space-y-4">
                            <button id="optionA" onclick="selectAnswer('A')" class="option-button w-full text-gray-800 p-4 md:p-6 rounded-2xl text-left font-semibold text-base md:text-lg card-hover bg-gradient-to-r from-green-200 to-teal-200 border-2 border-green-500">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">üÖ∞Ô∏è</span>
                                    <span>12 cm</span>
                                    <span class="ml-auto text-xl">üéØ</span>
                                </div>
                            </button>
                            <button id="optionB" onclick="selectAnswer('B')" class="option-button w-full text-gray-800 p-4 md:p-6 rounded-2xl text-left font-semibold text-base md:text-lg card-hover bg-gradient-to-r from-purple-200 to-pink-200 border-2 border-purple-500">
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">üÖ±Ô∏è</span>
                                    <span>10 cm</span>
                                    <span class="ml-auto text-xl">üéØ</span>
                                </div>
                            </button>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <div id="answerFeedback" class="text-2xl font-bold mb-4 opacity-0 transition-all duration-500"></div>
                            <button id="nextButton" onclick="nextQuestion()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-3 rounded-full font-bold text-lg transition-all duration-300 opacity-0 transform hover:scale-105">
                                Soal Berikutnya ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Host Dashboard Page -->
    <div id="hostDashboard" class="hidden min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <div class="glass-card rounded-3xl p-8 shadow-2xl">
                <div class="flex items-center justify-between mb-8">
                    <h1 class="text-5xl font-bold text-gray-800 game-title">üìä Host Dashboard</h1>
                    <button onclick="showHome()" class="bg-gradient-to-r from-red-400 to-pink-500 hover:from-red-500 hover:to-pink-600 text-white px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                        ‚Üê Kembali
                    </button>
                </div>
                
                <!-- QR Code Section for Students -->
                <div class="glass-card rounded-3xl p-8 mb-8 text-center floating bg-gradient-to-br from-cyan-400/20 to-blue-400/20">
                    <h3 class="text-4xl font-bold rainbow-text mb-6 flex items-center justify-center">
                        üì± Scan QR Code untuk Bermain
                        <span class="ml-3 text-3xl">üéÆ</span>
                    </h3>
                    
                    <!-- Large QR Code Display -->
                    <div class="flex justify-center">
                        <div class="transform hover:scale-105 transition-all duration-300">
                            <img src="https://imgur.com/jQDIHea.jpg" alt="QR Code Game Ethnomath" 
                                 class="w-96 h-96 object-contain shadow-2xl"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="hidden bg-gradient-to-r from-blue-500 to-purple-600 text-white p-12 rounded-2xl w-96 h-96 flex flex-col items-center justify-center shadow-2xl">
                                <div class="text-6xl mb-4">üì±</div>
                                <p class="text-2xl font-bold text-center">QR Code untuk<br>Akses Game</p>
                                <p class="text-lg mt-2 opacity-75">Ethnomath Quiz</p>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-2xl text-white font-bold mt-6 mb-2">
                        üéØ Siswa scan QR code ini untuk bermain!
                    </p>
                </div>



                <!-- Statistics Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="glass-card rounded-2xl p-6 text-center floating">
                        <div class="text-4xl mb-2">üë•</div>
                        <div class="text-3xl font-bold text-cyan-400" id="totalPlayers">0</div>
                        <div class="text-gray-300">Total Pemain</div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 text-center floating" style="animation-delay: 0.1s;">
                        <div class="text-4xl mb-2">üéÆ</div>
                        <div class="text-3xl font-bold text-green-400" id="totalGames">0</div>
                        <div class="text-gray-300">Total Game</div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 text-center floating" style="animation-delay: 0.2s;">
                        <div class="text-4xl mb-2">‚≠ê</div>
                        <div class="text-3xl font-bold text-yellow-400" id="averageScore">0</div>
                        <div class="text-gray-300">Rata-rata Skor</div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 text-center floating" style="animation-delay: 0.3s;">
                        <div class="text-4xl mb-2">üèÜ</div>
                        <div class="text-3xl font-bold text-purple-400" id="highestScore">0</div>
                        <div class="text-gray-300">Skor Tertinggi</div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="flex justify-center mb-8">
                    <!-- Score Distribution Chart -->
                    <div class="glass-card rounded-2xl p-6 floating bg-gradient-to-br from-purple-500/20 to-pink-500/20 max-w-2xl w-full">
                        <h3 class="text-2xl font-bold rainbow-text mb-6 flex items-center justify-center">
                            üìà Distribusi Skor Pemain
                            <span class="ml-2 text-lg">üéØ</span>
                        </h3>
                        <div class="relative h-80 bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-xl p-4 border-2 border-purple-400/30">
                            <canvas id="scoreChart" class="w-full h-full rounded-lg"></canvas>
                            <div class="absolute top-2 right-2 text-xs text-gray-300 bg-black/50 px-2 py-1 rounded">
                                üìä Live Data
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Stats Cards -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-card rounded-2xl p-6 text-center floating bg-gradient-to-br from-green-400/20 to-emerald-400/20" style="animation-delay: 0.4s;">
                        <div class="text-4xl mb-2">üéØ</div>
                        <div class="text-2xl font-bold text-green-400" id="accuracyRate">0%</div>
                        <div class="text-gray-300">Tingkat Akurasi</div>
                        <div class="text-xs text-gray-400 mt-1">Rata-rata jawaban benar</div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 text-center floating bg-gradient-to-br from-orange-400/20 to-red-400/20" style="animation-delay: 0.5s;">
                        <div class="text-4xl mb-2">‚ö°</div>
                        <div class="text-2xl font-bold text-orange-400" id="activeToday">0</div>
                        <div class="text-gray-300">Aktif Hari Ini</div>
                        <div class="text-xs text-gray-400 mt-1">Pemain yang bermain hari ini</div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 text-center floating bg-gradient-to-br from-pink-400/20 to-purple-400/20" style="animation-delay: 0.6s;">
                        <div class="text-4xl mb-2">üî•</div>
                        <div class="text-2xl font-bold text-pink-400" id="streakRecord">0</div>
                        <div class="text-gray-300">Rekor Beruntun</div>
                        <div class="text-xs text-gray-400 mt-1">Jawaban benar berturut-turut</div>
                    </div>
                </div>
                
                <!-- Player Leaderboard -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        üèÖ Papan Peringkat Pemain
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left py-3 px-4">Peringkat</th>
                                    <th class="text-left py-3 px-4">Nama Pemain</th>
                                    <th class="text-left py-3 px-4">Skor Tertinggi</th>
                                    <th class="text-left py-3 px-4">Total Game</th>
                                    <th class="text-left py-3 px-4">Rata-rata</th>
                                    <th class="text-left py-3 px-4">Terakhir Main</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardTable">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Control Buttons -->
                <div class="flex flex-wrap justify-center gap-4 mt-8">
                    <button id="exportBtn" class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-8 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                        üì• Export Data
                    </button>
                    <button id="clearBtn" class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white px-8 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                        üóëÔ∏è Hapus Papan Peringkat
                    </button>
                    <button id="refreshBtn" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-8 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="hidden min-h-screen flex items-center justify-center mobile-friendly">
        <div class="max-w-2xl mx-auto w-full">
            <div class="glass-card rounded-3xl p-4 md:p-8 shadow-2xl text-center bounce-in card-hover bg-gradient-to-br from-yellow-400/20 via-pink-400/20 to-purple-400/20">
                <!-- Celebration Header -->
                <div class="mb-6">
                    <div class="text-4xl md:text-6xl mb-2">üéâüéäüåü</div>
                    <div id="resultIcon" class="text-6xl md:text-9xl mb-4">üèÜ</div>
                    <div class="text-4xl md:text-6xl mb-2">‚ú®üéàüéÅ</div>
                </div>
                
                <h1 class="text-3xl md:text-5xl font-bold rainbow-text mb-4" id="resultTitle">LUAR BIASA!</h1>
                <p class="text-xl md:text-3xl font-bold text-cyan-300 mb-4" id="resultPlayerName">Pemain</p>
                <p class="text-lg md:text-2xl text-gray-200 mb-6 md:mb-8" id="resultMessage">Kamu telah menyelesaikan quiz!</p>
                
                <div class="glass-card rounded-2xl p-4 md:p-8 mb-6 md:mb-8 bg-gradient-to-r from-green-400/20 to-blue-400/20">
                    <div class="grid grid-cols-2 gap-4 md:gap-8 text-center">
                        <div class="card-hover p-4 rounded-xl bg-gradient-to-br from-green-400/30 to-emerald-400/30">
                            <div class="text-3xl mb-2">üèÜ</div>
                            <div class="text-3xl md:text-5xl font-bold text-green-400 mb-2" id="finalScore">0</div>
                            <div class="text-gray-300 text-sm md:text-lg">Skor Akhir</div>
                            <div class="text-2xl mt-1">‚≠ê</div>
                        </div>
                        <div class="card-hover p-4 rounded-xl bg-gradient-to-br from-blue-400/30 to-cyan-400/30">
                            <div class="text-3xl mb-2">‚úÖ</div>
                            <div class="text-3xl md:text-5xl font-bold text-blue-400 mb-2" id="correctAnswers">0</div>
                            <div class="text-gray-300 text-sm md:text-lg">Jawaban Benar</div>
                            <div class="text-2xl mt-1">üéØ</div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <button onclick="restartGame()" class="w-full bg-gradient-to-r from-green-400 via-teal-500 to-blue-500 hover:from-green-500 hover:via-teal-600 hover:to-blue-600 text-white button-responsive rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        üîÑ Main Lagi Yuk! üéÆ
                    </button>
                    <button onclick="showHome()" class="w-full bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 text-white button-responsive rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        üè† Kembali ke Beranda üåà
                    </button>
                </div>
                
                <!-- Fun Footer -->
                <div class="mt-6 text-center">
                    <div class="text-sm md:text-base text-gray-300 mb-2">
                        üåü Terima kasih sudah bermain! üåü
                    </div>
                    <div class="flex justify-center space-x-2 text-2xl">
                        <span class="animate-bounce">üéâ</span>
                        <span class="animate-bounce" style="animation-delay: 0.1s;">üéä</span>
                        <span class="animate-bounce" style="animation-delay: 0.2s;">üéà</span>
                        <span class="animate-bounce" style="animation-delay: 0.3s;">üéÅ</span>
                        <span class="animate-bounce" style="animation-delay: 0.4s;">üåà</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Music Control Button -->
    <button id="musicToggle" onclick="toggleMusic()" class="fixed bottom-4 right-4 z-50 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group">
        <svg id="musicIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M9 9v6l4-2V7l-4 2z"></path>
        </svg>
        <div class="absolute bottom-full right-1/2 transform translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap">
            <span id="musicTooltip">Matikan Musik</span>
        </div>
    </button>

    <script>
        // Google Drive API Configuration for Cloud Storage
        const GOOGLE_DRIVE_CONFIG = {
            apiKey: 'AIzaSyBH8vQ9X4K5L2M3N6P7R8S9T0U1V2W3X4Y5', // Demo key - replace with real key
            clientId: '123456789-abcdefghijklmnopqrstuvwxyz.apps.googleusercontent.com', // Demo - replace with real
            discoveryDoc: 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',
            scopes: 'https://www.googleapis.com/auth/drive.file',
            targetEmail: 'venisiswiandini00@gmail.com',
            folderName: 'Ethnomath Game Data'
        };

        // Cloud Storage State
        let cloudStorage = {
            isInitialized: false,
            isSignedIn: false,
            gapi: null,
            folderId: null,
            lastSync: null,
            syncInProgress: false
        };

        // Initialize Google Drive API
        async function initCloudStorage() {
            try {
                // Load Google API
                if (!window.gapi) {
                    await loadGoogleAPI();
                }

                await new Promise((resolve) => {
                    gapi.load('client:auth2', resolve);
                });

                await gapi.client.init({
                    apiKey: GOOGLE_DRIVE_CONFIG.apiKey,
                    clientId: GOOGLE_DRIVE_CONFIG.clientId,
                    discoveryDocs: [GOOGLE_DRIVE_CONFIG.discoveryDoc],
                    scope: GOOGLE_DRIVE_CONFIG.scopes
                });

                cloudStorage.gapi = gapi;
                cloudStorage.isInitialized = true;
                
                // Check if user is already signed in
                const authInstance = gapi.auth2.getAuthInstance();
                cloudStorage.isSignedIn = authInstance.isSignedIn.get();
                
                if (cloudStorage.isSignedIn) {
                    await setupCloudFolder();
                    console.log('‚úÖ Cloud storage initialized and connected');
                } else {
                    // Auto sign in to cloud storage
                    console.log('üîÑ Auto-connecting to cloud storage...');
                    await signInToCloud();
                }

                updateCloudStatus();
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Cloud storage initialization failed:', error);
                // Continue with local storage as fallback
                cloudStorage.isInitialized = false;
            }
        }

        function loadGoogleAPI() {
            return new Promise((resolve, reject) => {
                if (window.gapi) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://apis.google.com/js/api.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function signInToCloud() {
            if (!cloudStorage.isInitialized) {
                console.log('üîß Cloud storage belum siap. Mencoba inisialisasi ulang...');
                await initCloudStorage();
                return;
            }

            try {
                const authInstance = gapi.auth2.getAuthInstance();
                await authInstance.signIn();
                
                cloudStorage.isSignedIn = true;
                await setupCloudFolder();
                
                // Sync existing local data to cloud
                await syncToCloud();
                
                console.log('‚úÖ Berhasil terhubung ke cloud storage untuk venisiswiandini00@gmail.com');
                updateCloudStatus();
                
            } catch (error) {
                console.warn('Sign in failed, continuing with local storage:', error);
                // Silently continue with local storage
            }
        }

        async function setupCloudFolder() {
            try {
                // Search for existing folder
                const response = await gapi.client.drive.files.list({
                    q: `name='${GOOGLE_DRIVE_CONFIG.folderName}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,
                    spaces: 'drive'
                });

                if (response.result.files.length > 0) {
                    cloudStorage.folderId = response.result.files[0].id;
                    console.log('üìÅ Found existing cloud folder:', cloudStorage.folderId);
                } else {
                    // Create new folder
                    const folderResponse = await gapi.client.drive.files.create({
                        resource: {
                            name: GOOGLE_DRIVE_CONFIG.folderName,
                            mimeType: 'application/vnd.google-apps.folder'
                        }
                    });
                    
                    cloudStorage.folderId = folderResponse.result.id;
                    console.log('üìÅ Created new cloud folder:', cloudStorage.folderId);
                }

                // Share folder with target email
                await shareWithTargetEmail();
                
            } catch (error) {
                console.error('Failed to setup cloud folder:', error);
                throw error;
            }
        }

        async function shareWithTargetEmail() {
            try {
                await gapi.client.drive.permissions.create({
                    fileId: cloudStorage.folderId,
                    resource: {
                        role: 'writer',
                        type: 'user',
                        emailAddress: GOOGLE_DRIVE_CONFIG.targetEmail
                    }
                });
                console.log(`üìß Folder shared with ${GOOGLE_DRIVE_CONFIG.targetEmail}`);
            } catch (error) {
                console.warn('Failed to share folder:', error);
                // Continue anyway - folder is still accessible to signed-in user
            }
        }

        async function syncToCloud() {
            if (!cloudStorage.isSignedIn || cloudStorage.syncInProgress) {
                return;
            }

            try {
                cloudStorage.syncInProgress = true;
                updateCloudStatus();

                const gameData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
                    players: {},
                    games: [],
                    dailyStats: {}
                };

                const syncData = {
                    gameData: gameData,
                    lastSync: new Date().toISOString(),
                    version: '1.0',
                    source: 'Ethnomath Game'
                };

                const fileName = `ethnomath_data_${new Date().toISOString().split('T')[0]}.json`;
                
                // Check if file exists for today
                const existingFiles = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and parents in '${cloudStorage.folderId}' and trashed=false`,
                    spaces: 'drive'
                });

                const fileContent = JSON.stringify(syncData, null, 2);
                const blob = new Blob([fileContent], { type: 'application/json' });

                if (existingFiles.result.files.length > 0) {
                    // Update existing file
                    const fileId = existingFiles.result.files[0].id;
                    
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify({
                        name: fileName
                    })], { type: 'application/json' }));
                    form.append('file', blob);

                    await fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token}`
                        },
                        body: form
                    });
                } else {
                    // Create new file
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify({
                        name: fileName,
                        parents: [cloudStorage.folderId]
                    })], { type: 'application/json' }));
                    form.append('file', blob);

                    await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token}`
                        },
                        body: form
                    });
                }

                cloudStorage.lastSync = new Date();
                console.log('‚òÅÔ∏è Data synced to cloud successfully');
                
            } catch (error) {
                console.error('Cloud sync failed:', error);
            } finally {
                cloudStorage.syncInProgress = false;
                updateCloudStatus();
            }
        }

        async function loadFromCloud() {
            if (!cloudStorage.isSignedIn) {
                return null;
            }

            try {
                const today = new Date().toISOString().split('T')[0];
                const fileName = `ethnomath_data_${today}.json`;
                
                const files = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and parents in '${cloudStorage.folderId}' and trashed=false`,
                    spaces: 'drive'
                });

                if (files.result.files.length > 0) {
                    const fileId = files.result.files[0].id;
                    const response = await gapi.client.drive.files.get({
                        fileId: fileId,
                        alt: 'media'
                    });

                    const cloudData = JSON.parse(response.body);
                    return cloudData.gameData;
                }
                
                return null;
            } catch (error) {
                console.error('Failed to load from cloud:', error);
                return null;
            }
        }

        function updateCloudStatus() {
            // Simplified cloud status update - no UI elements to update
            console.log(`üìä Cloud Status: ${cloudStorage.isSignedIn ? 'Connected' : 'Local Only'}`);
        }

        // Enhanced Background Music Control with Malay Traditional Instrumental Music
        let backgroundMusic = null;
        let gameMusic = null;
        let victoryMusic = null;
        let musicStarted = false;
        let musicPlaying = false;
        let currentMusicType = 'background';
        
        function initBackgroundMusic() {
            try {
                createMalayInstrumentalMusic();
            } catch (e) {
                console.log('Audio not supported:', e);
            }
        }
        
        function createMalayInstrumentalMusic() {
            // Convert Google Drive link to direct download link
            const googleDriveId = '1Xm_jQ5Q-_ePeuzjDlps19wR8MBTq7iWn';
            const directLink = `https://drive.google.com/uc?export=download&id=${googleDriveId}`;
            
            // Create background music audio element
            backgroundMusic = new Audio();
            backgroundMusic.src = directLink;
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.5; // Increased volume for more energy
            backgroundMusic.preload = 'auto';
            
            // Add error handling for the audio
            backgroundMusic.onerror = function() {
                console.log('Failed to load Malay joget music from Google Drive, using fallback');
                // Fallback to energetic joget-style music
                createFallbackJogetMalayMusic();
            };
            
            backgroundMusic.oncanplaythrough = function() {
                console.log('Malay joget music loaded successfully');
            };
            
            // Create game music (same music but more energetic)
            gameMusic = new Audio();
            gameMusic.src = directLink;
            gameMusic.loop = true;
            gameMusic.volume = 0.6; // Higher volume for game excitement
            gameMusic.playbackRate = 1.2; // Faster tempo for joget energy
            gameMusic.preload = 'auto';
            
            gameMusic.onerror = function() {
                console.log('Failed to load game music, using background music');
                gameMusic = backgroundMusic; // Use same as background if fails
            };
            
            // Create victory music (same music but celebratory)
            victoryMusic = new Audio();
            victoryMusic.src = directLink;
            victoryMusic.loop = false; // Play once for victory
            victoryMusic.volume = 0.7; // Loudest for celebration
            victoryMusic.playbackRate = 1.15; // Slightly faster for triumph
            victoryMusic.preload = 'auto';
            
            victoryMusic.onerror = function() {
                console.log('Failed to load victory music, using background music');
                victoryMusic = backgroundMusic;
            };
            
            // Add ended event for victory music to return to background
            victoryMusic.onended = function() {
                setTimeout(() => {
                    if (backgroundMusic && musicPlaying) {
                        backgroundMusic.play().catch(e => console.log('Failed to resume background music:', e));
                        currentMusicType = 'background';
                    }
                }, 1000);
            };
            
            // Override play/pause methods
            const originalBgPlay = backgroundMusic.play;
            const originalBgPause = backgroundMusic.pause;
            
            backgroundMusic.play = function() {
                return originalBgPlay.call(this).then(() => {
                    musicStarted = true;
                    musicPlaying = true;
                    currentMusicType = 'background';
                    updateMusicButton();
                    console.log('Malay instrumental background music started');
                }).catch(e => {
                    console.log('Failed to play background music:', e);
                    // Try fallback music
                    createFallbackMalayMusic();
                });
            };
            
            backgroundMusic.pause = function() {
                originalBgPause.call(this);
                musicPlaying = false;
                updateMusicButton();
            };
            
            // Game music methods
            const originalGamePlay = gameMusic.play;
            const originalGamePause = gameMusic.pause;
            
            gameMusic.play = function() {
                if (backgroundMusic && !backgroundMusic.paused) {
                    backgroundMusic.pause();
                }
                return originalGamePlay.call(this).then(() => {
                    musicPlaying = true;
                    currentMusicType = 'game';
                    updateMusicButton();
                    console.log('Malay instrumental game music started');
                }).catch(e => {
                    console.log('Failed to play game music:', e);
                    // Fallback to background music
                    if (backgroundMusic) {
                        backgroundMusic.play();
                    }
                });
            };
            
            gameMusic.pause = function() {
                originalGamePause.call(this);
                musicPlaying = false;
                updateMusicButton();
            };
            
            // Victory music methods
            const originalVictoryPlay = victoryMusic.play;
            
            victoryMusic.play = function() {
                if (backgroundMusic && !backgroundMusic.paused) {
                    backgroundMusic.pause();
                }
                if (gameMusic && !gameMusic.paused) {
                    gameMusic.pause();
                }
                return originalVictoryPlay.call(this).then(() => {
                    musicPlaying = true;
                    currentMusicType = 'victory';
                    updateMusicButton();
                    console.log('Malay instrumental victory music started');
                }).catch(e => {
                    console.log('Failed to play victory music:', e);
                });
            };
            
            victoryMusic.pause = function() {
                this.pause();
            };
        }
        
        function createFallbackJogetMalayMusic() {
            // Create energetic joget Malay music with rebana, saxophone, and choir
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                let isPlaying = false;
                let currentLoop = null;
                let rebanaLoop = null;
                let choirLoop = null;
                
                // Energetic joget melody with saxophone-like sound
                const jogetMelody = [
                    // Main melody line (saxophone-style)
                    { freq: 329.63, time: 0.0, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // E4
                    { freq: 392.00, time: 0.3, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // G4
                    { freq: 440.00, time: 0.6, duration: 0.4, volume: 0.3, type: 'sawtooth' }, // A4
                    { freq: 523.25, time: 1.0, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // C5
                    { freq: 440.00, time: 1.3, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // A4
                    { freq: 392.00, time: 1.6, duration: 0.4, volume: 0.3, type: 'sawtooth' }, // G4
                    { freq: 329.63, time: 2.0, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // E4
                    { freq: 293.66, time: 2.3, duration: 0.3, volume: 0.25, type: 'sawtooth' }, // D4
                    { freq: 329.63, time: 2.6, duration: 0.4, volume: 0.3, type: 'sawtooth' }, // E4
                    { freq: 392.00, time: 3.0, duration: 0.5, volume: 0.3, type: 'sawtooth' }, // G4
                ];
                
                // Rebana rhythm pattern (percussion-like)
                const rebanaPattern = [
                    { freq: 80, time: 0.0, duration: 0.1, volume: 0.4, type: 'triangle' },
                    { freq: 120, time: 0.25, duration: 0.05, volume: 0.3, type: 'square' },
                    { freq: 80, time: 0.5, duration: 0.1, volume: 0.4, type: 'triangle' },
                    { freq: 100, time: 0.625, duration: 0.05, volume: 0.25, type: 'square' },
                    { freq: 120, time: 0.75, duration: 0.05, volume: 0.3, type: 'square' },
                    { freq: 80, time: 1.0, duration: 0.1, volume: 0.4, type: 'triangle' },
                    { freq: 120, time: 1.25, duration: 0.05, volume: 0.3, type: 'square' },
                    { freq: 80, time: 1.5, duration: 0.1, volume: 0.4, type: 'triangle' },
                    { freq: 100, time: 1.75, duration: 0.05, volume: 0.25, type: 'square' },
                ];
                
                // Choir harmony (background vocals)
                const choirHarmony = [
                    { freq: 261.63, time: 0.0, duration: 1.0, volume: 0.15, type: 'sine' }, // C4
                    { freq: 329.63, time: 0.0, duration: 1.0, volume: 0.12, type: 'sine' }, // E4
                    { freq: 392.00, time: 1.0, duration: 1.0, volume: 0.15, type: 'sine' }, // G4
                    { freq: 440.00, time: 1.0, duration: 1.0, volume: 0.12, type: 'sine' }, // A4
                    { freq: 329.63, time: 2.0, duration: 1.0, volume: 0.15, type: 'sine' }, // E4
                    { freq: 392.00, time: 2.0, duration: 1.0, volume: 0.12, type: 'sine' }, // G4
                    { freq: 293.66, time: 3.0, duration: 1.0, volume: 0.15, type: 'sine' }, // D4
                    { freq: 349.23, time: 3.0, duration: 1.0, volume: 0.12, type: 'sine' }, // F4
                ];
                
                function playJogetInstrument(notes, instrumentName) {
                    if (!isPlaying) return;
                    
                    notes.forEach(note => {
                        setTimeout(() => {
                            if (!isPlaying) return;
                            
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            const filterNode = audioContext.createBiquadFilter();
                            const distortionNode = audioContext.createWaveShaper();
                            
                            oscillator.connect(filterNode);
                            
                            // Add distortion for saxophone-like sound
                            if (note.type === 'sawtooth') {
                                filterNode.connect(distortionNode);
                                distortionNode.connect(gainNode);
                                
                                // Create distortion curve for saxophone warmth
                                const samples = 44100;
                                const curve = new Float32Array(samples);
                                const deg = Math.PI / 180;
                                for (let i = 0; i < samples; i++) {
                                    const x = (i * 2) / samples - 1;
                                    curve[i] = ((3 + 20) * x * 20 * deg) / (Math.PI + 20 * Math.abs(x));
                                }
                                distortionNode.curve = curve;
                                distortionNode.oversample = '4x';
                            } else {
                                filterNode.connect(gainNode);
                            }
                            
                            gainNode.connect(audioContext.destination);
                            
                            oscillator.frequency.value = note.freq;
                            oscillator.type = note.type || 'sine';
                            
                            // Different filtering for different instruments
                            if (instrumentName === 'rebana') {
                                filterNode.type = 'highpass';
                                filterNode.frequency.value = note.freq * 0.8;
                                filterNode.Q.value = 5;
                            } else if (instrumentName === 'saxophone') {
                                filterNode.type = 'bandpass';
                                filterNode.frequency.value = note.freq * 1.2;
                                filterNode.Q.value = 3;
                            } else { // choir
                                filterNode.type = 'lowpass';
                                filterNode.frequency.value = note.freq * 2;
                                filterNode.Q.value = 1;
                            }
                            
                            gainNode.gain.setValueAtTime(note.volume, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.duration);
                            
                            oscillator.start(audioContext.currentTime);
                            oscillator.stop(audioContext.currentTime + note.duration);
                        }, note.time * 1000);
                    });
                }
                
                function playJogetEnsemble() {
                    if (!isPlaying) return;
                    
                    // Play all instruments together
                    playJogetInstrument(jogetMelody, 'saxophone');
                    playJogetInstrument(choirHarmony, 'choir');
                    
                    // Start rebana rhythm
                    rebanaLoop = setInterval(() => {
                        if (!isPlaying) return;
                        playJogetInstrument(rebanaPattern, 'rebana');
                    }, 2000); // Rebana every 2 seconds
                    
                    // Loop the main melody every 4 seconds for energetic feel
                    currentLoop = setTimeout(() => {
                        if (isPlaying) playJogetEnsemble();
                    }, 4000);
                }
                
                // Override background music with energetic joget fallback
                backgroundMusic = {
                    play: function() {
                        if (!isPlaying && audioContext) {
                            if (audioContext.state === 'suspended') {
                                audioContext.resume();
                            }
                            isPlaying = true;
                            playJogetEnsemble();
                            musicStarted = true;
                            musicPlaying = true;
                            updateMusicButton();
                            console.log('Fallback Joget Malay music started - Rebana, Saxophone & Choir!');
                        }
                        return Promise.resolve();
                    },
                    pause: function() {
                        isPlaying = false;
                        if (currentLoop) {
                            clearTimeout(currentLoop);
                            currentLoop = null;
                        }
                        if (rebanaLoop) {
                            clearInterval(rebanaLoop);
                            rebanaLoop = null;
                        }
                        if (choirLoop) {
                            clearInterval(choirLoop);
                            choirLoop = null;
                        }
                        musicPlaying = false;
                        updateMusicButton();
                    },
                    volume: 0.5, // Higher volume for energetic feel
                    loop: true
                };
                
                // Set game and victory music to same energetic fallback
                gameMusic = backgroundMusic;
                victoryMusic = backgroundMusic;
                
            } catch (e) {
                console.log('Fallback music creation failed:', e);
            }
        }
        
        function startBackgroundMusic() {
            if (musicStarted) return;
            
            if (backgroundMusic && backgroundMusic.play) {
                backgroundMusic.play();
            }
        }
        
        function switchToGameMusic() {
            if (gameMusic && gameMusic.play) {
                gameMusic.play();
            }
        }
        
        function switchToVictoryMusic() {
            if (victoryMusic && victoryMusic.play) {
                victoryMusic.play();
            }
        }
        
        function toggleMusic() {
            if (!musicStarted) {
                startBackgroundMusic();
                return;
            }
            
            if (musicPlaying) {
                // Pause current music
                if (backgroundMusic && backgroundMusic.pause) {
                    backgroundMusic.pause();
                }
                if (gameMusic && gameMusic.pause) {
                    gameMusic.pause();
                }
                if (victoryMusic && victoryMusic.pause) {
                    victoryMusic.pause();
                }
                musicPlaying = false;
            } else {
                // Resume appropriate music based on current context
                if (currentMusicType === 'game' && gameMusic && gameMusic.play) {
                    gameMusic.play();
                } else if (currentMusicType === 'victory' && victoryMusic && victoryMusic.play) {
                    victoryMusic.play();
                } else if (backgroundMusic && backgroundMusic.play) {
                    backgroundMusic.play();
                }
                musicPlaying = true;
            }
            
            updateMusicButton();
            playClickSound();
        }
        
        function updateMusicButton() {
            const musicIcon = document.getElementById('musicIcon');
            const musicTooltip = document.getElementById('musicTooltip');
            
            if (musicPlaying) {
                // Music is playing - show pause icon
                musicIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M9 9v6l4-2V7l-4 2z"></path>';
                musicTooltip.textContent = 'Matikan Musik';
            } else {
                // Music is paused - show play icon
                musicIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15.414a2 2 0 001.414.586h10a2 2 0 001.414-.586l4-4a2 2 0 000-2.828l-4-4A2 2 0 0017 4H7a2 2 0 00-1.414.586l-4 4a2 2 0 000 2.828l4 4z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12l4-4 4 4"></path>';
                musicTooltip.textContent = 'Nyalakan Musik';
            }
        }
        
        // Start music on first user interaction
        document.addEventListener('click', function() {
            if (!musicStarted) {
                startBackgroundMusic();
            }
        });
        
        // Question Pool - Ethnomath questions about Malay traditional architecture
        const questionPool = [
            {
                question: "Pada kain corak insang di atas, apakah segitiga yang diberikan garis merah dan garis hitam merupakan segitiga yang sebangun?",
                image: "https://imgur.com/IBtGqrB.jpg",
                optionA: "Ya",
                optionB: "Tidak",
                correct: "A",
                explanation: "Ya, kedua segitiga memiliki bentuk yang sama dengan sudut-sudut yang bersesuaian sama besar, sehingga mereka sebangun."
            },
            {
                question: "Gambar di atas merupakan rumah adat Melayu Pontianak. Rumah adat tersebut memiliki atap yang membentuk segitiga. Terdapat segitiga yang diberikan garis merah dan garis kuning. Apakah dua segitiga tersebut merupakan segitiga yang sebangun?",
                image: "https://imgur.com/VRaSKCa.jpg",
                optionA: "Ya",
                optionB: "Tidak",
                correct: "A",
                explanation: "Ya, kedua segitiga pada atap rumah adat Melayu memiliki bentuk yang sama dan sudut-sudut yang bersesuaian sama besar."
            },
            {
                question: "Atap rumah adat Melayu di atas berbentuk segitiga sama kaki. Di bawah atap utama, terdapat segitiga hiasan yang bentuknya sebangun dengan segitiga atap besar. Diketahui: Lebar alas atap besar = 8 m, tinggi atap besar = 4,5 m, Lebar alas segitiga hiasan = 3,2 m. Berapa tinggi segitiga hiasan tersebut?",
                image: "https://imgur.com/yvEt1l9.jpg",
                optionA: "1,8 m",
                optionB: "1,9 m",
                correct: "A",
                explanation: "Karena sebangun, perbandingan sisi-sisi sama. 8/3,2 = 4,5/tinggi hiasan, maka tinggi hiasan = 4,5 √ó 3,2/8 = 1,8 m."
            },
            {
                question: "Pintu rumah adat Melayu di atas terdiri dari pintu besar dan pola panel persegi panjang di dalamnya. Panel-panel tersebut sebangun dengan bentuk pintu secara keseluruhan. Diketahui: Tinggi pintu utama = 210 cm, lebar pintu utama = 90 cm, Panel di dalam pintu memiliki lebar 30 cm. Berapa tinggi panel tersebut?",
                image: "https://imgur.com/Mn8WKlU.jpg",
                optionA: "74 cm",
                optionB: "70 cm",
                correct: "B",
                explanation: "Karena sebangun, perbandingan sisi-sisi sama. 90/30 = 210/tinggi panel, maka tinggi panel = 210 √ó 30/90 = 70 cm."
            },
            {
                question: "Pagar rumah adat Melayu di atas memiliki pola belah ketupat yang berwarna hitam dan hijau. Belah ketupat yang berwarna hitam sebangun dengan belah ketupat yang berwarna hijau. Diketahui: Panjang diagonal horizontal belah ketupat hitam = 20 cm, Panjang diagonal vertikal belah ketupat hitam = 24 cm, Panjang diagonal horizontal belah ketupat hijau = 15 cm. Berapa panjang diagonal vertikal belah ketupat hijau?",
                image: "https://imgur.com/7ZVdWRu.jpg",
                optionA: "19 cm",
                optionB: "18 cm",
                correct: "B",
                explanation: "Karena sebangun, perbandingan diagonal sama. 20/15 = 24/diagonal vertikal hijau, maka diagonal vertikal hijau = 24 √ó 15/20 = 18 cm."
            }
        ];

        // Game State
        let gameState = {
            currentQuestion: 0,
            score: 0,
            correctAnswers: 0,
            timeRemaining: 600,
            gameTimer: null,
            autoNextTimer: null,
            questions: []
        };

        // Enhanced Sound Effects
        const soundAudioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(frequency, duration, type = 'sine', volume = 0.3) {
            const oscillator = soundAudioContext.createOscillator();
            const gainNode = soundAudioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(soundAudioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(volume, soundAudioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, soundAudioContext.currentTime + duration);
            
            oscillator.start(soundAudioContext.currentTime);
            oscillator.stop(soundAudioContext.currentTime + duration);
        }

        function playCorrectSound() {
            // Energetic joget-style victory fanfare with rebana accent
            playSound(523, 0.2, 'sawtooth', 0.4); // C5 - saxophone-like
            playSound(80, 0.1, 'triangle', 0.3); // Rebana hit
            setTimeout(() => {
                playSound(659, 0.2, 'sawtooth', 0.4); // E5
                playSound(120, 0.05, 'square', 0.25); // Rebana accent
            }, 100);
            setTimeout(() => {
                playSound(784, 0.3, 'sawtooth', 0.4); // G5
                playSound(80, 0.1, 'triangle', 0.3); // Rebana hit
            }, 200);
            setTimeout(() => {
                playSound(1047, 0.4, 'sawtooth', 0.4); // C6 - triumphant
                playSound(100, 0.1, 'square', 0.3); // Final rebana
                // Add choir harmony
                playSound(523, 0.4, 'sine', 0.2); // Choir C5
                playSound(659, 0.4, 'sine', 0.15); // Choir E5
            }, 300);
        }

        function playIncorrectSound() {
            // Sad trombone effect
            playSound(300, 0.3, 'sawtooth', 0.3);
            setTimeout(() => playSound(250, 0.3, 'sawtooth', 0.3), 150);
            setTimeout(() => playSound(200, 0.5, 'sawtooth', 0.3), 300);
        }

        function playClickSound() {
            // Rebana-style click sound
            playSound(120, 0.08, 'triangle', 0.25);
            setTimeout(() => playSound(80, 0.05, 'square', 0.15), 30);
        }

        function playWhooshSound() {
            // Saxophone-style swoosh with joget energy
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    playSound(300 + i * 60, 0.06, 'sawtooth', 0.15); // Saxophone-like swoosh
                    if (i % 3 === 0) {
                        playSound(80, 0.03, 'triangle', 0.1); // Rebana accent
                    }
                }, i * 25);
            }
        }

        // Navigation Functions
        function showHome() {
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('hostButton').style.display = 'block'; // Show host button only on home
            
            // Switch back to background music
            if (backgroundMusic && musicPlaying) {
                if (gameMusic && gameMusic.pause) gameMusic.pause();
                if (victoryMusic && victoryMusic.pause) victoryMusic.pause();
                backgroundMusic.play();
                currentMusicType = 'background';
            }
            
            playClickSound();
        }

        function showMaterial() {
            hideAllPages();
            document.getElementById('materialPage').classList.remove('hidden');
            document.getElementById('hostButton').style.display = 'none'; // Hide host button
            playClickSound();
        }

        function hideAllPages() {
            const pages = ['homePage', 'materialPage', 'gamePage', 'resultsPage', 'hostDashboard'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        // Host Login Functions
        function showHostLogin() {
            document.getElementById('hostLoginModal').classList.remove('hidden');
            document.getElementById('hostPassword').focus();
            playClickSound();
        }

        function hideHostLogin() {
            document.getElementById('hostLoginModal').classList.add('hidden');
            document.getElementById('hostPassword').value = '';
            playClickSound();
        }

        function verifyHostPassword() {
            const password = document.getElementById('hostPassword').value;
            const correctPassword = 'admin123';
            
            if (password === correctPassword) {
                hideHostLogin();
                showHostDashboard();
                playCorrectSound();
            } else {
                alert('‚ùå Password salah! Coba lagi.');
                document.getElementById('hostPassword').value = '';
                document.getElementById('hostPassword').focus();
                playIncorrectSound();
            }
        }

        // Host Dashboard Functions
        function showHostDashboard() {
            hideAllPages();
            document.getElementById('hostDashboard').classList.remove('hidden');
            document.getElementById('hostButton').style.display = 'none'; // Hide host button
            loadDashboardData();
            playClickSound();
        }

        // Enhanced Game Data Storage with Cloud Integration
        let gameData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
            players: {},
            games: [],
            dailyStats: {}
        };

        async function saveGameData() {
            // Save to local storage first
            localStorage.setItem('ethnomath_game_data', JSON.stringify(gameData));
            
            // Auto-sync to cloud if connected
            if (cloudStorage.isSignedIn && !cloudStorage.syncInProgress) {
                try {
                    await syncToCloud();
                } catch (error) {
                    console.warn('Auto-sync to cloud failed:', error);
                }
            }
        }

        async function recordGameResult(playerName, score, correctAnswers) {
            const today = new Date().toISOString().split('T')[0];
            const gameResult = {
                playerName,
                score,
                correctAnswers,
                date: today,
                timestamp: new Date().toISOString()
            };

            // Update player data
            if (!gameData.players[playerName]) {
                gameData.players[playerName] = {
                    name: playerName,
                    scores: [],
                    totalGames: 0,
                    highestScore: 0,
                    lastPlayed: today
                };
            }

            const player = gameData.players[playerName];
            player.scores.push(score);
            player.totalGames++;
            player.highestScore = Math.max(player.highestScore, score);
            player.lastPlayed = today;

            // Add to games history
            gameData.games.push(gameResult);

            // Update daily stats
            if (!gameData.dailyStats[today]) {
                gameData.dailyStats[today] = {
                    totalGames: 0,
                    totalScore: 0,
                    players: new Set()
                };
            }

            gameData.dailyStats[today].totalGames++;
            gameData.dailyStats[today].totalScore += score;
            gameData.dailyStats[today].players.add(playerName);

            await saveGameData();
        }

        function loadDashboardData() {
            // Calculate statistics
            const players = Object.values(gameData.players);
            const totalPlayers = players.length;
            const totalGames = gameData.games.length;
            const allScores = gameData.games.map(g => g.score);
            const averageScore = allScores.length > 0 ? Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length) : 0;
            const highestScore = allScores.length > 0 ? Math.max(...allScores) : 0;

            // Update statistics cards
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('averageScore').textContent = averageScore;
            document.getElementById('highestScore').textContent = highestScore;

            // Update leaderboard
            updateLeaderboard();
            
            // Update charts
            updateCharts();
        }

        function updateLeaderboard() {
            const players = Object.values(gameData.players)
                .sort((a, b) => b.highestScore - a.highestScore)
                .slice(0, 10);

            const tbody = document.getElementById('leaderboardTable');
            tbody.innerHTML = '';

            players.forEach((player, index) => {
                const avgScore = Math.round(player.scores.reduce((a, b) => a + b, 0) / player.scores.length);
                const row = document.createElement('tr');
                row.className = 'border-b border-white/20 hover:bg-white/10 transition-colors';
                
                const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                
                row.innerHTML = `
                    <td class="py-3 px-4 font-bold text-yellow-200">${rankEmoji}</td>
                    <td class="py-3 px-4 font-semibold text-white">${player.name}</td>
                    <td class="py-3 px-4 text-green-200 font-bold">${player.highestScore}</td>
                    <td class="py-3 px-4 text-blue-200">${player.totalGames}</td>
                    <td class="py-3 px-4 text-purple-200">${avgScore}</td>
                    <td class="py-3 px-4 text-gray-200">${player.lastPlayed}</td>
                `;
                tbody.appendChild(row);
            });

            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-400">Belum ada data pemain</td></tr>';
            }
        }

        function updateCharts() {
            // Score Distribution Chart
            const scoreRanges = { '0-20': 0, '21-40': 0, '41-60': 0, '61-80': 0, '81-100': 0 };
            gameData.games.forEach(game => {
                if (game.score <= 20) scoreRanges['0-20']++;
                else if (game.score <= 40) scoreRanges['21-40']++;
                else if (game.score <= 60) scoreRanges['41-60']++;
                else if (game.score <= 80) scoreRanges['61-80']++;
                else scoreRanges['81-100']++;
            });

            drawBarChart('scoreChart', Object.keys(scoreRanges), Object.values(scoreRanges), 'Distribusi Skor Pemain');
            
            // Update additional stats
            updateAdditionalStats();
        }
        
        function drawLineChart(canvasId, labels, data, title) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Set canvas size with device pixel ratio for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            const width = rect.width;
            const height = rect.height;
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding - 40;
            
            // Clear canvas with dark background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            // Draw title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 18px Poppins';
            ctx.textAlign = 'center';
            ctx.fillText(title, width / 2, 30);
            
            const maxValue = Math.max(...data, 100);
            const minValue = Math.min(...data, 0);
            const valueRange = maxValue - minValue || 1;
            
            // Draw grid lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + 40 + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Y-axis labels
                const value = Math.round(maxValue - (valueRange / 5) * i);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '12px Poppins';
                ctx.textAlign = 'right';
                ctx.fillText(value, padding - 10, y + 4);
            }
            
            // Draw area under curve
            if (data.some(d => d > 0)) {
                const gradient = ctx.createLinearGradient(0, padding + 40, 0, padding + 40 + chartHeight);
                gradient.addColorStop(0, 'rgba(74, 144, 226, 0.3)');
                gradient.addColorStop(1, 'rgba(74, 144, 226, 0.05)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.moveTo(padding, padding + 40 + chartHeight);
                
                data.forEach((value, index) => {
                    const x = padding + (index / (labels.length - 1)) * chartWidth;
                    const y = padding + 40 + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    if (index === 0) ctx.lineTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.lineTo(padding + chartWidth, padding + 40 + chartHeight);
                ctx.closePath();
                ctx.fill();
            }
            
            // Draw line
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + (index / (labels.length - 1)) * chartWidth;
                const y = padding + 40 + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            // Draw points
            data.forEach((value, index) => {
                const x = padding + (index / (labels.length - 1)) * chartWidth;
                const y = padding + 40 + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                
                // Point shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.arc(x + 1, y + 1, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Main point
                const pointGradient = ctx.createRadialGradient(x, y, 0, x, y, 6);
                pointGradient.addColorStop(0, '#ffffff');
                pointGradient.addColorStop(1, '#4A90E2');
                ctx.fillStyle = pointGradient;
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Value label
                if (value > 0) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.beginPath();
                    ctx.roundRect(x - 15, y - 25, 30, 16, 8);
                    ctx.fill();
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Poppins';
                    ctx.textAlign = 'center';
                    ctx.fillText(value, x, y - 12);
                }
                
                // X-axis labels
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 11px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText(labels[index], x, height - 10);
            });
            
            // Add decorative elements
            drawChartDecorations(ctx, width, height);
        }
        
        function updateAdditionalStats() {
            const games = gameData.games;
            const today = new Date().toISOString().split('T')[0];
            
            // Calculate accuracy rate
            const totalQuestions = games.length * 5; // 5 questions per game
            const totalCorrect = games.reduce((sum, game) => sum + (game.correctAnswers || 0), 0);
            const accuracyRate = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            document.getElementById('accuracyRate').textContent = accuracyRate + '%';
            
            // Active players today
            const activeToday = games.filter(game => game.date === today).length;
            document.getElementById('activeToday').textContent = activeToday;
            
            // Calculate streak record (consecutive correct answers)
            let maxStreak = 0;
            let currentStreak = 0;
            games.forEach(game => {
                if (game.correctAnswers === 5) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            });
            document.getElementById('streakRecord').textContent = maxStreak;
        }

        function drawBarChart(canvasId, labels, data, title) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Set canvas size with device pixel ratio for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            const width = rect.width;
            const height = rect.height;
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding - 40; // Extra space for title
            
            // Clear canvas with dark background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            // Draw title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 18px Poppins';
            ctx.textAlign = 'center';
            ctx.fillText(title, width / 2, 30);
            
            // Find max value
            const maxValue = Math.max(...data, 1);
            
            // Draw grid lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + 40 + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Draw y-axis labels
                const value = Math.round(maxValue - (maxValue / 5) * i);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '12px Poppins';
                ctx.textAlign = 'right';
                ctx.fillText(value, padding - 10, y + 4);
            }
            
            // Colorful gradients for each bar
            const gradientColors = [
                ['#FF6B6B', '#FF8E53'], // Red to Orange
                ['#4ECDC4', '#44A08D'], // Teal to Green
                ['#45B7D1', '#96C93D'], // Blue to Lime
                ['#F093FB', '#F5576C'], // Purple to Pink
                ['#FBD3E9', '#BB377D']  // Light Pink to Dark Pink
            ];
            
            // Draw bars with animation effect
            const barWidth = chartWidth / labels.length * 0.7;
            const barSpacing = chartWidth / labels.length * 0.3;
            
            data.forEach((value, index) => {
                const barHeight = (value / maxValue) * chartHeight;
                const x = padding + index * (barWidth + barSpacing) + barSpacing / 2;
                const y = padding + 40 + chartHeight - barHeight;
                
                // Create rainbow gradient for each bar
                const gradient = ctx.createLinearGradient(0, y, 0, y + barHeight);
                const colors = gradientColors[index % gradientColors.length];
                gradient.addColorStop(0, colors[0]);
                gradient.addColorStop(1, colors[1]);
                
                // Draw bar shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(x + 3, y + 3, barWidth, barHeight);
                
                // Draw main bar with rounded corners
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, [8, 8, 0, 0]);
                ctx.fill();
                
                // Add shine effect
                const shineGradient = ctx.createLinearGradient(x, y, x + barWidth / 3, y);
                shineGradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                shineGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = shineGradient;
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth / 3, barHeight, [8, 0, 0, 0]);
                ctx.fill();
                
                // Draw value on top with background
                if (value > 0) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.beginPath();
                    ctx.roundRect(x + barWidth/2 - 20, y - 25, 40, 20, 10);
                    ctx.fill();
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px Poppins';
                    ctx.textAlign = 'center';
                    ctx.fillText(value, x + barWidth / 2, y - 10);
                }
                
                // Draw label with background
                const labelY = height - 25;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.beginPath();
                ctx.roundRect(x - 5, labelY - 15, barWidth + 10, 20, 10);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText(labels[index], x + barWidth / 2, labelY);
            });
            
            // Add decorative elements
            drawChartDecorations(ctx, width, height);
        }
        
        function drawChartDecorations(ctx, width, height) {
            // Draw corner decorations
            const corners = [
                {x: 20, y: 20}, {x: width - 20, y: 20},
                {x: 20, y: height - 20}, {x: width - 20, y: height - 20}
            ];
            
            corners.forEach((corner, index) => {
                ctx.fillStyle = `hsl(${index * 90}, 70%, 60%)`;
                ctx.beginPath();
                ctx.arc(corner.x, corner.y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Add sparkle effect
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(corner.x - 1, corner.y - 1, 1, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw border glow
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.roundRect(5, 5, width - 10, height - 10, 15);
            ctx.stroke();
        }



        async function exportData() {
            try {
                // Show loading state
                const exportBtn = document.getElementById('exportBtn');
                const originalText = exportBtn.textContent;
                exportBtn.textContent = 'üì• Mengexport...';
                exportBtn.disabled = true;
                
                // Try to get latest data from cloud first
                let freshData;
                if (cloudStorage.isSignedIn) {
                    try {
                        const cloudData = await loadFromCloud();
                        if (cloudData) {
                            freshData = cloudData;
                            console.log('üì• Using cloud data for export');
                        } else {
                            freshData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
                                players: {},
                                games: [],
                                dailyStats: {}
                            };
                            console.log('üì± Using local data for export');
                        }
                    } catch (error) {
                        console.warn('Failed to load cloud data, using local:', error);
                        freshData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
                            players: {},
                            games: [],
                            dailyStats: {}
                        };
                    }
                } else {
                    freshData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
                        players: {},
                        games: [],
                        dailyStats: {}
                    };
                }
                
                // Create formatted export data with comprehensive summary
                const exportData = {
                    exportInfo: {
                        exportDate: new Date().toISOString(),
                        exportTime: new Date().toLocaleString('id-ID'),
                        version: '1.0',
                        source: cloudStorage.isSignedIn ? 'Cloud Storage' : 'Local Storage',
                        targetEmail: 'venisiswiandini00@gmail.com'
                    },
                    summary: {
                        totalPlayers: Object.keys(freshData.players).length,
                        totalGames: freshData.games.length,
                        totalScores: freshData.games.reduce((sum, game) => sum + game.score, 0),
                        averageScore: freshData.games.length > 0 ? Math.round(freshData.games.reduce((sum, game) => sum + game.score, 0) / freshData.games.length) : 0,
                        highestScore: freshData.games.length > 0 ? Math.max(...freshData.games.map(g => g.score)) : 0,
                        dateRange: freshData.games.length > 0 ? {
                            earliest: freshData.games.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))[0]?.date || 'N/A',
                            latest: freshData.games.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0]?.date || 'N/A'
                        } : { earliest: 'N/A', latest: 'N/A' }
                    },
                    gameData: freshData
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                // Create and trigger download
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                const fileName = `ethnomath_data_${new Date().toISOString().split('T')[0]}.json`;
                
                link.href = url;
                link.download = fileName;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up URL
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                // Also sync to cloud if connected
                if (cloudStorage.isSignedIn) {
                    try {
                        await syncToCloud();
                        console.log('‚òÅÔ∏è Data also synced to cloud during export');
                    } catch (error) {
                        console.warn('Cloud sync during export failed:', error);
                    }
                }
                
                // Reset button
                setTimeout(() => {
                    exportBtn.textContent = originalText;
                    exportBtn.disabled = false;
                }, 1000);
                
                // Success message
                const stats = exportData.summary;
                const sourceInfo = cloudStorage.isSignedIn ? '\n‚òÅÔ∏è Data dari: Cloud Storage' : '\nüíæ Data dari: Local Storage';
                alert(`‚úÖ Data berhasil diexport!${sourceInfo}\n\nüìÅ File: ${fileName}\nüìä Data yang diexport:\n‚Ä¢ ${stats.totalPlayers} pemain\n‚Ä¢ ${stats.totalGames} riwayat game\n‚Ä¢ Skor tertinggi: ${stats.highestScore}\n‚Ä¢ Rata-rata skor: ${stats.averageScore}\n\nüìß Target email: venisiswiandini00@gmail.com`);
                playCorrectSound();
                
            } catch (error) {
                console.error('Export error:', error);
                
                // Reset button on error
                const exportBtn = document.getElementById('exportBtn');
                exportBtn.textContent = 'üì• Export Data';
                exportBtn.disabled = false;
                
                alert('‚ùå Gagal export data: ' + error.message);
                playIncorrectSound();
            }
        }

        function clearAllData() {
            // Get current data for confirmation
            let currentData;
            try {
                currentData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || { players: {}, games: [], dailyStats: {} };
            } catch (e) {
                currentData = { players: {}, games: [], dailyStats: {} };
            }
            
            const playerCount = Object.keys(currentData.players || {}).length;
            const gameCount = (currentData.games || []).length;
            
            if (playerCount === 0 && gameCount === 0) {
                alert('‚ÑπÔ∏è Papan peringkat sudah kosong!\n\nTidak ada data yang perlu dihapus.');
                playClickSound();
                return;
            }
            
            const confirmMessage = `üèÜ HAPUS PAPAN PERINGKAT\n\nAnda akan menghapus semua data papan peringkat:\n\nüìä Data yang akan dihapus:\n‚Ä¢ ${playerCount} pemain terdaftar\n‚Ä¢ ${gameCount} riwayat permainan\n‚Ä¢ Semua skor dan statistik\n‚Ä¢ Grafik dan analisis data\n\n‚ö†Ô∏è PERINGATAN: Tindakan ini tidak dapat dibatalkan!\n\nKetik "HAPUS" (huruf besar) untuk melanjutkan:`;
            
            const userInput = prompt(confirmMessage);
            
            if (userInput === 'HAPUS') {
                try {
                    // Show loading state
                    const resetBtn = document.getElementById('clearBtn');
                    if (!resetBtn) {
                        console.error('Reset button not found');
                        return;
                    }
                    
                    const originalText = resetBtn.textContent;
                    resetBtn.textContent = 'üóëÔ∏è Menghapus...';
                    resetBtn.disabled = true;
                    
                    // Clear data with multiple methods for reliability
                    setTimeout(() => {
                        let clearSuccess = false;
                        let clearMethod = '';
                        
                        try {
                            // Method 1: Remove specific key
                            localStorage.removeItem('ethnomath_game_data');
                            clearMethod = 'Penghapusan langsung';
                            clearSuccess = true;
                        } catch (e) {
                            console.warn('Method 1 failed:', e);
                        }
                        
                        try {
                            // Method 2: Set to empty object
                            localStorage.setItem('ethnomath_game_data', JSON.stringify({ players: {}, games: [], dailyStats: {} }));
                            if (!clearSuccess) {
                                clearMethod = 'Reset ke data kosong';
                                clearSuccess = true;
                            }
                        } catch (e) {
                            console.warn('Method 2 failed:', e);
                        }
                        
                        // Reset global gameData object
                        window.gameData = { 
                            players: {}, 
                            games: [], 
                            dailyStats: {} 
                        };
                        
                        // Save fresh empty data structure
                        try {
                            localStorage.setItem('ethnomath_game_data', JSON.stringify(window.gameData));
                        } catch (e) {
                            console.warn('Failed to save empty data:', e);
                        }
                        
                        // Refresh dashboard immediately
                        try {
                            loadDashboardData();
                        } catch (e) {
                            console.warn('Failed to load dashboard:', e);
                        }
                        
                        // Reset button
                        resetBtn.textContent = originalText;
                        resetBtn.disabled = false;
                        
                        // Verify clearing worked
                        let verificationData;
                        try {
                            verificationData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || { players: {}, games: [], dailyStats: {} };
                        } catch (e) {
                            verificationData = { players: {}, games: [], dailyStats: {} };
                        }
                        
                        const remainingPlayers = Object.keys(verificationData.players || {}).length;
                        const remainingGames = (verificationData.games || []).length;
                        
                        if (remainingPlayers === 0 && remainingGames === 0) {
                            // Success confirmation
                            alert(`‚úÖ PAPAN PERINGKAT BERHASIL DIHAPUS!\n\nüóëÔ∏è Data yang telah dihapus:\n‚Ä¢ ${playerCount} pemain\n‚Ä¢ ${gameCount} riwayat permainan\n‚Ä¢ Semua skor dan statistik\n‚Ä¢ Dashboard telah direset\n\nüéÆ Sistem siap untuk pemain baru!\nMetode: ${clearMethod}`);
                            playCorrectSound();
                        } else {
                            // Partial success
                            alert(`‚ö†Ô∏è PENGHAPUSAN SELESAI!\n\n‚úÖ Berhasil dihapus:\n‚Ä¢ ${playerCount} pemain\n‚Ä¢ ${gameCount} riwayat permainan\n\nüìä Sisa data: ${remainingPlayers} pemain, ${remainingGames} game\n\nJika masih ada data tersisa, coba refresh halaman.`);
                            playCorrectSound();
                            
                            // Offer page reload
                            setTimeout(() => {
                                if (confirm('üîÑ Refresh halaman untuk memastikan penghapusan sempurna?')) {
                                    try {
                                        location.reload();
                                    } catch (e) {
                                        alert('Gagal refresh otomatis. Silakan refresh manual (F5).');
                                    }
                                }
                            }, 1000);
                        }
                        
                    }, 800);
                    
                } catch (error) {
                    console.error('Clear leaderboard error:', error);
                    
                    // Reset button on error
                    const resetBtn = document.getElementById('clearBtn');
                    if (resetBtn) {
                        resetBtn.textContent = 'üóëÔ∏è Hapus Papan Peringkat';
                        resetBtn.disabled = false;
                    }
                    
                    alert(`‚ùå Gagal menghapus papan peringkat!\n\nError: ${error.message}\n\nüîß Solusi:\n1. Refresh halaman (F5)\n2. Coba lagi\n3. Restart browser jika masih bermasalah`);
                    playIncorrectSound();
                }
            } else if (userInput !== null && userInput !== '') {
                alert('‚ùå Penghapusan dibatalkan!\n\n‚ö†Ô∏è Anda harus mengetik "HAPUS" (huruf besar semua) dengan tepat.\n\nüí° Tips: Copy-paste kata "HAPUS" untuk memastikan penulisan benar.');
                playIncorrectSound();
            } else {
                // User cancelled
                alert('‚úÖ Penghapusan dibatalkan.\n\nPapan peringkat tetap aman! üèÜ');
                playClickSound();
            }
        }

        function refreshDashboard() {
            try {
                // Show loading state
                const refreshBtn = document.getElementById('refreshBtn');
                const originalText = refreshBtn.textContent;
                refreshBtn.textContent = 'üîÑ Memuat...';
                refreshBtn.disabled = true;
                
                // Reload data from localStorage
                gameData = JSON.parse(localStorage.getItem('ethnomath_game_data')) || {
                    players: {},
                    games: [],
                    dailyStats: {}
                };
                
                // Update dashboard with fresh data
                loadDashboardData();
                
                // Reset button
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.disabled = false;
                }, 500);
                
                // Show success message with stats
                const stats = {
                    players: Object.keys(gameData.players).length,
                    games: gameData.games.length,
                    lastUpdate: new Date().toLocaleTimeString('id-ID')
                };
                
                alert(`‚úÖ Dashboard berhasil direfresh!\n\nüìä Data terkini:\n‚Ä¢ ${stats.players} pemain\n‚Ä¢ ${stats.games} riwayat game\n‚Ä¢ Update: ${stats.lastUpdate}`);
                playCorrectSound();
                
            } catch (error) {
                console.error('Refresh error:', error);
                
                // Reset button on error
                const refreshBtn = document.getElementById('refreshBtn');
                refreshBtn.textContent = 'üîÑ Refresh';
                refreshBtn.disabled = false;
                
                alert('‚ùå Gagal refresh dashboard: ' + error.message);
                playIncorrectSound();
            }
        }

        // Name Input Functions
        function showNameInput() {
            document.getElementById('nameInputModal').classList.remove('hidden');
            document.getElementById('playerName').focus();
            playClickSound();
        }
        
        function hideNameInput() {
            document.getElementById('nameInputModal').classList.add('hidden');
            playClickSound();
        }
        
        function startGameWithName() {
            const playerName = document.getElementById('playerName').value.trim();
            
            if (!playerName) {
                alert('üéÆ Masukkan nama kamu dulu ya!');
                document.getElementById('playerName').focus();
                return;
            }
            
            hideNameInput();
            startGame(playerName);
        }
        
        // Shuffle questions function
        function shuffleQuestions() {
            // Create a copy of the question pool and shuffle it
            const shuffled = [...questionPool];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            // Use all 5 questions in random order
            gameState.questions = shuffled;
        }

        // Game Functions
        function startGame(playerName = null) {
            if (!playerName) {
                showNameInput();
                return;
            }
            
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.timeRemaining = 600;
            gameState.playerName = playerName;
            gameState.autoNextTimer = null;

            // Shuffle questions for variety
            shuffleQuestions();

            hideAllPages();
            document.getElementById('gamePage').classList.remove('hidden');
            document.getElementById('hostButton').style.display = 'none'; // Hide host button
            
            // Update player name display in game
            document.getElementById('playerNameDisplay').textContent = playerName;
            
            // Switch to more intense game music
            switchToGameMusic();
            
            startGameTimer();
            loadQuestion();
            playClickSound();
        }

        function startGameTimer() {
            gameState.gameTimer = setInterval(() => {
                gameState.timeRemaining--;
                updateTimeDisplay();
                
                if (gameState.timeRemaining <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateTimeDisplay() {
            const minutes = Math.floor(gameState.timeRemaining / 60);
            const seconds = gameState.timeRemaining % 60;
            document.getElementById('timeRemaining').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function loadQuestion() {
            const question = gameState.questions[gameState.currentQuestion];
            
            document.getElementById('questionNumber').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionTitle').textContent = `ü§î Soal ${gameState.currentQuestion + 1}`;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('optionA').innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üÖ∞Ô∏è</span>
                    <span>${question.optionA}</span>
                    <span class="ml-auto text-xl">üéØ</span>
                </div>
            `;
            document.getElementById('optionB').innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üÖ±Ô∏è</span>
                    <span>${question.optionB}</span>
                    <span class="ml-auto text-xl">üéØ</span>
                </div>
            `;
            
            // Load question image if available
            const questionImage = document.getElementById('questionImage');
            const questionImageFallback = document.getElementById('questionImageFallback');
            
            if (question.image) {
                questionImage.src = question.image;
                questionImage.style.display = 'block';
                questionImageFallback.style.display = 'none';
            } else {
                questionImage.style.display = 'none';
                questionImageFallback.style.display = 'block';
            }
            
            // Reset button states
            const buttons = ['optionA', 'optionB'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (id === 'optionA') {
                    btn.className = 'option-button w-full text-white p-4 md:p-6 rounded-2xl text-left font-semibold text-base md:text-lg card-hover bg-gradient-to-r from-green-400/20 to-teal-400/20 border-2 border-green-400/30';
                } else {
                    btn.className = 'option-button w-full text-white p-4 md:p-6 rounded-2xl text-left font-semibold text-base md:text-lg card-hover bg-gradient-to-r from-purple-400/20 to-pink-400/20 border-2 border-purple-400/30';
                }
                btn.onclick = () => selectAnswer(id === 'optionA' ? 'A' : 'B');
            });
            
            // Hide feedback and next button
            document.getElementById('answerFeedback').classList.add('opacity-0');
            document.getElementById('nextButton').classList.add('opacity-0');
            
            // Reset basketball animation
            resetBasketballAnimation();
        }

        function selectAnswer(answer) {
            const question = gameState.questions[gameState.currentQuestion];
            const isCorrect = answer === question.correct;
            
            // Disable buttons
            document.getElementById('optionA').onclick = null;
            document.getElementById('optionB').onclick = null;
            
            // Show correct answer
            const correctButton = document.getElementById(question.correct === 'A' ? 'optionA' : 'optionB');
            const selectedButton = document.getElementById(answer === 'A' ? 'optionA' : 'optionB');
            
            correctButton.classList.add('correct-answer');
            
            if (!isCorrect) {
                selectedButton.classList.add('wrong-answer');
            }
            
            // Play animation and sound
            if (isCorrect) {
                playCorrectSound();
                animateBasketballSuccess();
                gameState.score += 20;
                gameState.correctAnswers++;
                document.getElementById('answerFeedback').innerHTML = 'üéâ BENAR SEKALI! +20 poin';
                document.getElementById('answerFeedback').className = 'text-2xl font-bold mb-4 text-green-400 transition-all duration-500';
            } else {
                playIncorrectSound();
                animateBasketballMiss();
                document.getElementById('answerFeedback').innerHTML = `‚ùå Oops! Jawaban yang benar: ${question.correct}`;
                document.getElementById('answerFeedback').className = 'text-2xl font-bold mb-4 text-red-400 transition-all duration-500';
            }
            
            // Update score display
            document.getElementById('currentScore').textContent = gameState.score;
            
            // Show feedback
            setTimeout(() => {
                document.getElementById('answerFeedback').classList.remove('opacity-0');
            }, 800);
            
            // Auto-advance to next question after 2.5 seconds
            gameState.autoNextTimer = setTimeout(() => {
                nextQuestion();
            }, 2500);
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion >= gameState.questions.length) {
                endGame();
            } else {
                loadQuestion();
            }
            
            playClickSound();
        }

        function endGame() {
            clearInterval(gameState.gameTimer);
            
            // Clear auto-next timer if exists
            if (gameState.autoNextTimer) {
                clearTimeout(gameState.autoNextTimer);
                gameState.autoNextTimer = null;
            }
            
            // Record game result
            recordGameResult(gameState.playerName, gameState.score, gameState.correctAnswers);
            
            hideAllPages();
            document.getElementById('resultsPage').classList.remove('hidden');
            document.getElementById('hostButton').style.display = 'none'; // Hide host button
            
            // Update results display
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('correctAnswers').textContent = gameState.correctAnswers;
            document.getElementById('resultPlayerName').textContent = gameState.playerName || 'Pemain';
            
            if (gameState.correctAnswers === gameState.questions.length) {
                document.getElementById('resultIcon').textContent = 'üèÜ';
                document.getElementById('resultTitle').textContent = 'SEMPURNA!';
                document.getElementById('resultMessage').textContent = `${gameState.playerName} adalah master kesebangunan! üåü`;
                createFireworks();
                switchToVictoryMusic(); // Play victory music for perfect score
            } else if (gameState.correctAnswers >= 3) {
                document.getElementById('resultIcon').textContent = 'üéâ';
                document.getElementById('resultTitle').textContent = 'HEBAT!';
                document.getElementById('resultMessage').textContent = `Pemahaman ${gameState.playerName} tentang kesebangunan sudah bagus!`;
                switchToVictoryMusic(); // Play victory music for good score
            } else {
                document.getElementById('resultIcon').textContent = 'üìö';
                document.getElementById('resultTitle').textContent = 'TERUS SEMANGAT!';
                document.getElementById('resultMessage').textContent = `${gameState.playerName}, belajar lagi dan coba sekali lagi ya!`;
                // Return to background music for lower scores
                setTimeout(() => {
                    if (backgroundMusic && backgroundMusic.play && musicPlaying) {
                        if (gameMusic && gameMusic.pause) gameMusic.pause();
                        backgroundMusic.play();
                        currentMusicType = 'background';
                    }
                }, 1000);
            }
        }

        function restartGame() {
            startGame(gameState.playerName);
        }

        // Enhanced Animation Functions
        function resetBasketballAnimation() {
            const ball = document.getElementById('basketball');
            const player = document.getElementById('basketballPlayer');
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            ball.style.transform = 'translate(0, 0)';
            ball.className = 'absolute bottom-28 left-28 ball';
            player.className = 'absolute bottom-8 left-12 player';
            scoreDisplay.classList.add('opacity-0');
            
            // Clear effects
            document.getElementById('confettiContainer').innerHTML = '';
            document.getElementById('sparkleContainer').innerHTML = '';
        }

        function animateBasketballSuccess() {
            const ball = document.getElementById('basketball');
            const player = document.getElementById('basketballPlayer');
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            playWhooshSound();
            
            // Animate ball to basket with arc
            ball.style.transition = 'all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            ball.style.transform = 'translate(280px, -220px) scale(0.8)';
            player.classList.add('celebrate');
            
            setTimeout(() => {
                ball.classList.add('ball-bounce');
                scoreDisplay.textContent = '+20 üéØ';
                scoreDisplay.classList.remove('opacity-0');
                scoreDisplay.classList.add('text-green-400', 'score-popup');
                createSparkles();
                createConfetti();
            }, 800);
            
            setTimeout(() => {
                ball.classList.remove('ball-bounce');
                scoreDisplay.classList.add('opacity-0');
                player.classList.remove('celebrate');
            }, 3000);
        }

        function animateBasketballMiss() {
            const ball = document.getElementById('basketball');
            const player = document.getElementById('basketballPlayer');
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            playWhooshSound();
            
            // Animate ball missing the basket
            ball.style.transition = 'all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            ball.style.transform = 'translate(350px, -150px) rotate(180deg)';
            player.classList.add('miss');
            
            setTimeout(() => {
                ball.classList.add('miss');
                scoreDisplay.textContent = 'Miss! üòÖ';
                scoreDisplay.classList.remove('opacity-0');
                scoreDisplay.classList.add('text-red-400');
            }, 600);
            
            setTimeout(() => {
                ball.classList.remove('miss');
                scoreDisplay.classList.add('opacity-0');
                player.classList.remove('miss');
            }, 2500);
        }

        function createSparkles() {
            const container = document.getElementById('sparkleContainer');
            const sparkles = ['‚ú®', '‚≠ê', 'üåü', 'üí´'];
            
            for (let i = 0; i < 8; i++) {
                const sparkle = document.createElement('div');
                sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
                sparkle.className = 'absolute text-2xl sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 3000);
            }
        }

        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 15; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function createFireworks() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createConfetti();
                    createSparkles();
                    playCorrectSound();
                }, i * 500);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize cloud storage
            setTimeout(() => {
                initCloudStorage();
            }, 500);
            
            // Initialize background music
            setTimeout(() => {
                initBackgroundMusic();
            }, 1000);
            
            // Add some initial sparkles to home page
            setTimeout(createSparkles, 1000);
            
            // Add Enter key support for name input
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startGameWithName();
                }
            });

            // Add Enter key support for host password
            document.getElementById('hostPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyHostPassword();
                }
            });
            
            // Add event listeners for dashboard buttons with multiple connection methods
            setTimeout(() => {
                connectDashboardButtons();
            }, 100);
            
            // Also try connecting when dashboard is shown
            const originalShowHostDashboard = showHostDashboard;
            showHostDashboard = function() {
                originalShowHostDashboard();
                setTimeout(connectDashboardButtons, 200);
            };
        });
        
        function connectDashboardButtons() {
            try {
                const exportBtn = document.getElementById('exportBtn');
                const clearBtn = document.getElementById('clearBtn');
                const refreshBtn = document.getElementById('refreshBtn');
                
                if (exportBtn) {
                    exportBtn.onclick = exportData;
                    exportBtn.addEventListener('click', exportData);
                    console.log('‚úÖ Export button connected');
                } else {
                    console.warn('‚ùå Export button not found');
                }
                
                if (clearBtn) {
                    clearBtn.onclick = clearAllData;
                    clearBtn.addEventListener('click', clearAllData);
                    console.log('‚úÖ Clear button connected');
                } else {
                    console.warn('‚ùå Clear button not found');
                }
                
                if (refreshBtn) {
                    refreshBtn.onclick = refreshDashboard;
                    refreshBtn.addEventListener('click', refreshDashboard);
                    console.log('‚úÖ Refresh button connected');
                } else {
                    console.warn('‚ùå Refresh button not found');
                }
            } catch (error) {
                console.error('‚ùå Error connecting dashboard buttons:', error);
            }
        }
            
            // Show host button only on home page initially
            showHome();
            
            // Auto-start music after a short delay
            setTimeout(() => {
                if (!musicStarted) {
                    startBackgroundMusic();
                }
            }, 2000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9743ae7a55575fdf',t:'MTc1NjA0NzIzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
