<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethnomath - Game Kesebangunan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Basketball Animation Styles */
        .basketball-container {
            position: relative;
            width: 100%;
            height: 350px;
            margin: 20px 0;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
        }
        
        .basketball-court {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #87CEEB 0%, 
                #B0E0E6 40%, 
                #98FB98 70%, 
                #228B22 85%, 
                #006400 100%);
            perspective: 1000px;
        }
        
        .court-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(45deg, #8B4513 25%, #A0522D 25%, #A0522D 50%, #8B4513 50%, #8B4513 75%, #A0522D 75%);
            background-size: 20px 20px;
            opacity: 0.8;
        }
        
        .court-lines {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            border-top: 3px solid #fff;
        }
        
        .court-lines::before {
            content: '';
            position: absolute;
            bottom: 50%;
            left: 20%;
            width: 60%;
            height: 2px;
            background: #fff;
            border-radius: 1px;
        }
        
        .basketball-hoop {
            position: absolute;
            right: 60px;
            top: 60px;
            width: 100px;
            height: 80px;
            transform: perspective(500px) rotateY(-15deg);
        }
        
        .hoop-pole {
            position: absolute;
            right: 30px;
            top: 40px;
            width: 6px;
            height: 60px;
            background: linear-gradient(to right, #666, #999, #666);
            border-radius: 3px;
        }
        
        .hoop-backboard {
            width: 70px;
            height: 50px;
            background: linear-gradient(135deg, #f8f8f8, #e0e0e0, #f8f8f8);
            border: 4px solid #333;
            border-radius: 8px;
            position: absolute;
            right: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .backboard-square {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 20px;
            border: 2px solid #ff0000;
            border-radius: 2px;
        }
        
        .hoop-rim {
            position: absolute;
            bottom: -12px;
            right: 8px;
            width: 55px;
            height: 12px;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .rim-front {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(to bottom, #ff8800, #cc5500);
            border-radius: 50px 50px 0 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .rim-back {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to bottom, #cc5500, #994400);
            border-radius: 0 0 50px 50px;
        }
        
        .hoop-net {
            position: absolute;
            bottom: -35px;
            right: 13px;
            width: 45px;
            height: 30px;
        }
        
        .net-strand {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, #fff, #f0f0f0, #fff);
            border-radius: 1px;
            animation: netSway 3s ease-in-out infinite;
        }
        
        @keyframes netSway {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(2deg); }
        }
        
        .player {
            position: absolute;
            left: 80px;
            bottom: 40px;
            width: 70px;
            height: 100px;
            transition: all 0.5s ease;
            transform-origin: bottom center;
        }
        
        .player-shadow {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 8px;
            background: radial-gradient(ellipse, rgba(0,0,0,0.3), transparent);
            border-radius: 50%;
        }
        
        .player-legs {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 35px;
        }
        
        .player-leg {
            position: absolute;
            bottom: 0;
            width: 12px;
            height: 35px;
            background: linear-gradient(to right, #8B4513, #A0522D);
            border-radius: 6px;
        }
        
        .player-leg.left {
            left: 8px;
        }
        
        .player-leg.right {
            right: 8px;
        }
        
        .player-body {
            width: 35px;
            height: 45px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border-radius: 18px 18px 8px 8px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .jersey-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .player-head {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #f4c2a1, #d4a574);
            border-radius: 50%;
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .player-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 15px;
        }
        
        .eye {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #333;
            border-radius: 50%;
            top: 2px;
        }
        
        .eye.left {
            left: 4px;
        }
        
        .eye.right {
            right: 4px;
        }
        
        .mouth {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 3px;
            border: 1px solid #333;
            border-top: none;
            border-radius: 0 0 6px 6px;
        }
        
        .player-hair {
            position: absolute;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 15px;
            background: #2d1810;
            border-radius: 50% 50% 0 0;
        }
        
        .player-arms {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
        }
        
        .player-arm {
            width: 18px;
            height: 35px;
            background: linear-gradient(to right, #f4c2a1, #d4a574);
            border-radius: 12px;
            position: absolute;
            transition: all 0.3s ease;
            transform-origin: top center;
        }
        
        .player-arm.left {
            left: 0;
        }
        
        .player-arm.right {
            right: 0;
        }
        
        .hand {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #f4c2a1, #d4a574);
            border-radius: 50%;
        }
        
        .basketball {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #ff8800, #cc5500);
            border-radius: 50%;
            left: 90px;
            bottom: 100px;
            transition: all 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .ball-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .ball-line {
            position: absolute;
            background: #333;
            border-radius: 1px;
        }
        
        .ball-line.horizontal {
            top: 50%;
            left: 10%;
            width: 80%;
            height: 2px;
            transform: translateY(-50%);
        }
        
        .ball-line.vertical {
            left: 50%;
            top: 10%;
            width: 2px;
            height: 80%;
            transform: translateX(-50%);
        }
        
        .ball-line.curve1 {
            top: 20%;
            left: 20%;
            width: 60%;
            height: 2px;
            border-radius: 50%;
            transform: rotate(45deg);
        }
        
        .ball-line.curve2 {
            top: 20%;
            left: 20%;
            width: 60%;
            height: 2px;
            border-radius: 50%;
            transform: rotate(-45deg);
        }
        
        .ball-shadow {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 8px;
            background: radial-gradient(ellipse, rgba(0,0,0,0.4), transparent);
            border-radius: 50%;
            transition: all 1.8s ease;
        }
        
        .score-effect {
            position: absolute;
            top: 50px;
            right: 100px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }
        
        .score-text {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }
        
        .score-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .star {
            font-size: 16px;
            animation: starTwinkle 0.6s ease-in-out infinite alternate;
        }
        
        .star:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .star:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes starTwinkle {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.2) rotate(180deg); }
        }
        
        /* Animation Classes */
        .shooting {
            transform: rotate(-20deg);
        }
        
        .shooting .player-arm.right {
            transform: rotate(-45deg);
        }
        
        .shooting .player-arm.left {
            transform: rotate(-30deg);
        }
        
        .ball-success {
            right: 78px !important;
            bottom: 125px !important;
            transform: rotate(720deg) scale(0.7);
        }
        
        .ball-miss {
            right: 20px !important;
            bottom: 50px !important;
            transform: rotate(360deg);
        }
        
        .celebration {
            animation: celebrate 1s ease-in-out;
        }
        
        .disappointment {
            animation: disappoint 1s ease-in-out;
        }
        
        @keyframes celebrate {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-10px) rotate(5deg); }
            75% { transform: translateY(-5px) rotate(-5deg); }
        }
        
        @keyframes disappoint {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px) rotate(2deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Opening Screen -->
    <div id="openingScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <div class="mb-6">
                <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <span class="text-white text-2xl font-bold">üìê</span>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Ethnomath</h1>
                <p class="text-gray-600 mb-4">Game Kuis Kesebangunan</p>
                <div class="bg-gray-100 rounded-lg p-4 mb-6">
                    <p class="text-sm text-gray-700 font-medium">Dibuat oleh:</p>
                    <p class="text-lg font-bold text-purple-600">Veni Siswiandini</p>
                </div>
            </div>
            <div class="space-y-3">
                <button onclick="showMaterial()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                    üìö Lihat Materi
                </button>
                <button onclick="showPlayerJoin()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                    üéÆ Mulai Bermain
                </button>
                <button onclick="showHostLogin()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                    üë®‚Äçüíº Panel Host
                </button>
            </div>
        </div>
    </div>

    <!-- Material Screen -->
    <div id="materialScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-3xl p-8 card-shadow">
                <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                    ‚Üê Kembali
                </button>
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">üìê Materi Kesebangunan</h2>
                
                <div class="grid md:grid-cols-1 gap-6 mb-6">
                    <div class="bg-blue-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-blue-800">üìê Definisi Kesebangunan</h3>
                        <div class="bg-white rounded-lg p-4 mb-4">
                            <p class="text-gray-700 mb-3"><strong>Kesebangunan</strong> adalah hubungan dua bangun yang memiliki bentuk sama tetapi ukuran belum tentu sama.</p>
                            <p class="font-medium text-blue-700 mb-2">Dua bangun dikatakan sebangun jika:</p>
                            <ul class="list-disc list-inside text-gray-600 space-y-1 ml-4">
                                <li><strong>Bentuknya sama</strong> (sudut-sudut yang bersesuaian sama besar)</li>
                                <li><strong>Perbandingan panjang sisi-sisi yang bersesuaian sama</strong></li>
                            </ul>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-4 mb-4">
                            <p class="font-medium text-blue-800 mb-2">üî¢ Rumus Perbandingan Sisi:</p>
                            <div class="text-center bg-white rounded p-3 font-mono text-lg">
                                <span class="text-blue-600">sisi 1</span>/<span class="text-green-600">sisi 1'</span> = <span class="text-blue-600">sisi 2</span>/<span class="text-green-600">sisi 2'</span> = ...
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4">
                            <p class="font-medium text-blue-700 mb-2">üìù Simbol Kesebangunan:</p>
                            <div class="text-center bg-gray-50 rounded p-3">
                                <span class="text-xl font-mono">‚àÜABC ~ ‚àÜDEF</span>
                                <p class="text-sm text-gray-600 mt-1">artinya segitiga ABC sebangun dengan segitiga DEF</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-green-800">üí° Contoh Soal Singkat</h3>
                        <div class="bg-white rounded-lg p-4 space-y-3">
                            <div class="bg-green-100 rounded p-3">
                                <p class="text-sm font-medium text-green-800">Soal:</p>
                                <p class="text-gray-700">‚àÜPQR sebangun dengan ‚àÜXYZ. Panjang PQ = 4 cm, QR = 6 cm, dan XY = 6 cm. Tentukan panjang YZ.</p>
                            </div>
                            
                            <div class="bg-blue-100 rounded p-3">
                                <p class="text-sm font-medium text-blue-800">Penyelesaian:</p>
                                <div class="font-mono text-sm space-y-1">
                                    <p>PQ/XY = QR/YZ</p>
                                    <p>4/6 = 6/YZ</p>
                                    <p>YZ = (6 √ó 6)/4</p>
                                    <p class="font-bold text-blue-600">YZ = 9 cm</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-green-800">Contoh Kesebangunan</h3>
                        <div class="bg-white rounded-lg p-4 text-center">
                            <div class="flex justify-center items-center space-x-4 mb-4">
                                <div class="w-12 h-12 bg-blue-400 transform rotate-45"></div>
                                <span class="text-2xl">~</span>
                                <div class="w-8 h-8 bg-blue-400 transform rotate-45"></div>
                            </div>
                            <p class="text-sm text-gray-600">Kedua persegi ini sebangun karena memiliki bentuk sama dengan perbandingan sisi 3:2</p>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-purple-800">Rumus Perbandingan</h3>
                        <div class="bg-white rounded-lg p-4">
                            <p class="font-medium text-purple-700 mb-2">Jika segitiga ABC ~ segitiga DEF:</p>
                            <p class="text-center text-lg font-mono bg-gray-100 p-2 rounded">AB/DE = BC/EF = AC/DF = k</p>
                            <p class="text-sm text-gray-600 mt-2">k = faktor skala kesebangunan</p>
                        </div>
                    </div>
                    
                    <div class="bg-orange-50 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-orange-800">Tips Mengerjakan Soal</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-2">
                            <li>Identifikasi sisi-sisi yang bersesuaian</li>
                            <li>Hitung perbandingan sisi</li>
                            <li>Periksa apakah perbandingannya sama</li>
                            <li>Gunakan sifat sudut yang sama</li>
                        </ul>
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="showPlayerJoin()" class="bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-xl font-medium transition-colors pulse-animation">
                        Siap Bermain! üéÆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Join Screen -->
    <div id="playerJoinScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                ‚Üê Kembali
            </button>
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Bergabung ke Game</h2>
            <div class="mb-6">
                <input type="text" id="playerName" placeholder="Masukkan nama Anda" 
                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-center">
            </div>
            <div class="mb-6 bg-gray-100 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-2">Pemain Online:</p>
                <p class="text-2xl font-bold text-blue-600" id="playerCount">0/40</p>
            </div>
            <button onclick="joinGame()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                üöÄ Bergabung
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <!-- Game Header -->
            <div class="bg-white rounded-xl p-4 mb-6 card-shadow">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="font-bold text-gray-800">Soal <span id="currentQuestion">1</span>/5</h3>
                        <p class="text-sm text-gray-600">Pemain: <span id="gamePlayerName"></span></p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600" id="timer">10:00</div>
                        <p class="text-sm text-gray-600">Sisa Waktu</p>
                    </div>
                </div>
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500 ease-out" style="width: 20%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500">
                    <span>Progress</span>
                    <span id="progressText">1 dari 5 soal</span>
                </div>
            </div>

            <!-- Question Card -->
            <div class="bg-white rounded-xl p-8 card-shadow">
                <!-- Question Header with Icon -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 mb-6 text-white">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <span class="text-3xl" id="questionIcon">üìê</span>
                        </div>
                    </div>
                    <h2 class="text-xl font-bold text-center mb-4" id="questionText"></h2>
                </div>

                <!-- Question Image/Visual -->
                <div id="questionImageContainer" class="mb-6 text-center bg-gray-50 rounded-xl p-6">
                    <div id="questionImage" class="text-6xl mb-4"></div>
                    <div id="questionDiagram" class="hidden"></div>
                </div>
                
                <div class="space-y-4" id="answerOptions">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Basketball Animation Area - Moved below answer options -->
                <div id="basketballAnimation" class="basketball-container hidden mt-8">
                    <div class="basketball-court">
                        <div class="court-floor"></div>
                        <div class="court-lines"></div>
                        <div class="basketball-hoop">
                            <div class="hoop-pole"></div>
                            <div class="hoop-backboard">
                                <div class="backboard-square"></div>
                            </div>
                            <div class="hoop-rim">
                                <div class="rim-front"></div>
                                <div class="rim-back"></div>
                            </div>
                            <div class="hoop-net">
                                <div class="net-strand" style="left: 5px;"></div>
                                <div class="net-strand" style="left: 15px;"></div>
                                <div class="net-strand" style="left: 25px;"></div>
                                <div class="net-strand" style="left: 35px;"></div>
                            </div>
                        </div>
                        <div class="player" id="basketballPlayer">
                            <div class="player-shadow"></div>
                            <div class="player-legs">
                                <div class="player-leg left"></div>
                                <div class="player-leg right"></div>
                            </div>
                            <div class="player-body">
                                <div class="jersey-number">7</div>
                            </div>
                            <div class="player-head">
                                <div class="player-face">
                                    <div class="eye left"></div>
                                    <div class="eye right"></div>
                                    <div class="mouth"></div>
                                </div>
                                <div class="player-hair"></div>
                            </div>
                            <div class="player-arms">
                                <div class="player-arm left">
                                    <div class="hand"></div>
                                </div>
                                <div class="player-arm right">
                                    <div class="hand"></div>
                                </div>
                            </div>
                        </div>
                        <div class="basketball" id="basketball">
                            <div class="ball-lines">
                                <div class="ball-line horizontal"></div>
                                <div class="ball-line vertical"></div>
                                <div class="ball-line curve1"></div>
                                <div class="ball-line curve2"></div>
                            </div>
                            <div class="ball-shadow"></div>
                        </div>
                        <div class="score-effect" id="scoreEffect">
                            <div class="score-text">+20</div>
                            <div class="score-stars">
                                <div class="star">‚≠ê</div>
                                <div class="star">‚≠ê</div>
                                <div class="star">‚≠ê</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Auto-advance message (shown after answering) -->
                <div id="autoAdvanceMessage" class="mt-8 text-center hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <div class="flex items-center justify-center space-x-2 text-blue-700">
                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-700"></div>
                            <span class="font-medium">Memuat soal berikutnya...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-3xl p-8 card-shadow">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">üèÜ Leaderboard</h2>
                
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-6 text-center text-white mb-6">
                        <h3 class="text-xl font-bold mb-2">Selamat!</h3>
                        <p>Game telah selesai. Berikut adalah hasil akhir:</p>
                    </div>
                </div>

                <div id="leaderboardList" class="space-y-3 mb-8">
                    <!-- Leaderboard will be populated here -->
                </div>

                <div class="text-center space-y-4">
                    <button onclick="resetGame()" class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-8 rounded-xl font-medium transition-colors">
                        üîÑ Main Lagi
                    </button>
                    <button onclick="showOpening()" class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-8 rounded-xl font-medium transition-colors">
                        üè† Kembali ke Menu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Host Login Screen -->
    <div id="hostLoginScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 text-center card-shadow max-w-md w-full">
            <button onclick="showOpening()" class="mb-6 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                ‚Üê Kembali
            </button>
            <h2 class="text-2xl font-bold mb-6 text-gray-800">üîê Login Host</h2>
            <div class="mb-6">
                <input type="password" id="hostPassword" placeholder="Masukkan password host" 
                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-center">
            </div>
            <button onclick="loginHost()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-xl font-medium transition-colors">
                üö™ Masuk
            </button>
            <p class="text-xs text-gray-500 mt-4">Password: admin123</p>
        </div>
    </div>

    <!-- Host Panel Screen -->
    <div id="hostPanelScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-xl p-6 mb-6 card-shadow">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">üë®‚Äçüíº Panel Host</h2>
                    <div class="flex space-x-4">
                        <button onclick="startGameAsHost()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium">
                            ‚ñ∂Ô∏è Mulai Game
                        </button>
                        <button onclick="showOpening()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                            üö™ Keluar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Host Menu Tabs -->
            <div class="bg-white rounded-xl p-6 mb-6 card-shadow">
                <div class="flex space-x-4 border-b border-gray-200">
                    <button onclick="showHostTab('stats')" id="statsTab" class="px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600">
                        üìä Statistik Live
                    </button>
                    <button onclick="showHostTab('questions')" id="questionsTab" class="px-4 py-2 font-medium text-gray-600 hover:text-blue-600">
                        üìù Kelola Soal
                    </button>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="hostStatsTab" class="grid lg:grid-cols-2 gap-6">
                <!-- Live Stats -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üìä Statistik Live</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600" id="hostPlayerCount">0</p>
                            <p class="text-sm text-gray-600">Pemain Online</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-green-600" id="hostGameTime">10:00</p>
                            <p class="text-sm text-gray-600">Sisa Waktu</p>
                        </div>
                    </div>
                    <div style="height: 300px;">
                        <canvas id="liveScoreChart"></canvas>
                    </div>
                </div>

                <!-- Player List -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üë• Daftar Pemain</h3>
                    <div id="hostPlayerList" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Player list will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Questions Management Tab -->
            <div id="hostQuestionsTab" class="hidden">
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Question List -->
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">üìã Daftar Soal</h3>
                        <div id="questionsList" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- Questions list will be populated here -->
                        </div>
                        <button onclick="addNewQuestion()" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium">
                            ‚ûï Tambah Soal Baru
                        </button>
                    </div>

                    <!-- Question Editor -->
                    <div class="lg:col-span-2 bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">‚úèÔ∏è Edit Soal</h3>
                        <div id="questionEditor" class="space-y-4">
                            <p class="text-gray-500 text-center py-8">Pilih soal dari daftar untuk mengedit</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentScreen: 'opening',
            players: [],
            currentPlayer: null,
            currentQuestionIndex: 0,
            gameStartTime: null,
            gameTimer: null,
            hostChart: null
        };

        // Questions Data
        const questions = [
            {
                question: "Dua segitiga dikatakan sebangun jika...",
                icon: "üìê",
                image: "üìê",
                diagram: `
                    <div class="flex justify-center items-center space-x-8">
                        <div class="text-center">
                            <div style="width: 0; height: 0; border-left: 40px solid transparent; border-right: 40px solid transparent; border-bottom: 60px solid #3b82f6; margin: 0 auto;"></div>
                            <p class="mt-2 text-sm font-medium">Segitiga ABC</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div style="width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 45px solid #10b981; margin: 0 auto;"></div>
                            <p class="mt-2 text-sm font-medium">Segitiga DEF</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Memiliki luas yang sama",
                    b: "Sudut-sudut bersesuaian sama besar dan perbandingan sisi bersesuaian sama"
                },
                correct: "b"
            },
            {
                question: "Perhatikan gambar berikut! Jika kedua segitiga sebangun, tentukan nilai x:",
                icon: "üìè",
                image: "https://drive.google.com/uc?export=view&id=1twkoCo04vePhKNFXn33SKaHj_-8D5iaf",
                diagram: `
                    <div class="bg-white p-4 rounded-lg border-2 border-gray-200">
                        <img src="https://drive.google.com/uc?export=view&id=1twkoCo04vePhKNFXn33SKaHj_-8D5iaf" 
                             alt="Diagram segitiga sebangun" 
                             class="max-w-full h-auto mx-auto rounded-lg shadow-md"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display: none;" class="text-center p-8 bg-gray-100 rounded-lg">
                            <div class="text-6xl mb-4">üìê</div>
                            <p class="text-gray-600">Diagram segitiga sebangun dengan sisi-sisi yang diketahui</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "x = 6 cm",
                    b: "x = 8 cm"
                },
                correct: "a"
            },
            {
                question: "Persegi dengan sisi 6 cm sebangun dengan persegi yang memiliki sisi...",
                icon: "‚¨ú",
                image: "‚¨ú",
                diagram: `
                    <div class="flex justify-center items-center space-x-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-400 border-2 border-blue-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">6 cm √ó 6 cm</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div class="w-12 h-12 bg-green-400 border-2 border-green-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">? cm √ó ? cm</p>
                        </div>
                        <div class="text-4xl text-blue-500">~</div>
                        <div class="text-center">
                            <div class="w-20 h-20 bg-purple-400 border-2 border-purple-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">? cm √ó ? cm</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Hanya 12 cm",
                    b: "Semua ukuran sisi (3 cm, 9 cm, 12 cm, dll)"
                },
                correct: "b"
            },
            {
                question: "Faktor skala kesebangunan antara dua bangun yang sebangun adalah 1:4. Jika luas bangun pertama 9 cm¬≤, maka luas bangun kedua adalah...",
                icon: "üìä",
                image: "üìä",
                diagram: `
                    <div class="flex justify-center items-center space-x-8">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-red-400 border-2 border-red-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">Bangun 1</p>
                            <p class="text-xs text-gray-600">Luas = 9 cm¬≤</p>
                            <p class="text-xs text-blue-600">Skala = 1</p>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl text-blue-500">:</div>
                            <p class="text-sm font-medium">1 : 4</p>
                        </div>
                        <div class="text-center">
                            <div class="w-24 h-24 bg-red-400 border-2 border-red-600 mx-auto"></div>
                            <p class="mt-2 text-sm font-medium">Bangun 2</p>
                            <p class="text-xs text-gray-600">Luas = ? cm¬≤</p>
                            <p class="text-xs text-blue-600">Skala = 4</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "36 cm¬≤",
                    b: "144 cm¬≤"
                },
                correct: "b"
            },
            {
                question: "Manakah pasangan bangun yang PASTI sebangun?",
                icon: "üîç",
                image: "üîç",
                diagram: `
                    <div class="grid grid-cols-2 gap-6">
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div style="width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 30px solid #ef4444;"></div>
                                <div style="width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #ef4444;"></div>
                            </div>
                            <p class="text-sm font-medium">Dua Segitiga Siku-siku</p>
                            <p class="text-xs text-red-600">Belum tentu sebangun</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div class="w-8 h-8 bg-green-500 rounded-full"></div>
                                <div class="w-6 h-6 bg-green-500 rounded-full"></div>
                            </div>
                            <p class="text-sm font-medium">Dua Lingkaran</p>
                            <p class="text-xs text-green-600">Pasti sebangun</p>
                        </div>
                    </div>
                `,
                options: {
                    a: "Dua segitiga siku-siku",
                    b: "Dua lingkaran dengan jari-jari berbeda"
                },
                correct: "b"
            }
        ];

        // Screen Navigation Functions
        function showOpening() {
            hideAllScreens();
            document.getElementById('openingScreen').classList.remove('hidden');
            gameState.currentScreen = 'opening';
        }

        function showMaterial() {
            hideAllScreens();
            document.getElementById('materialScreen').classList.remove('hidden');
            gameState.currentScreen = 'material';
        }

        function showPlayerJoin() {
            hideAllScreens();
            document.getElementById('playerJoinScreen').classList.remove('hidden');
            gameState.currentScreen = 'playerJoin';
            updatePlayerCount();
        }

        function showHostLogin() {
            hideAllScreens();
            document.getElementById('hostLoginScreen').classList.remove('hidden');
            gameState.currentScreen = 'hostLogin';
        }

        function hideAllScreens() {
            const screens = ['openingScreen', 'materialScreen', 'playerJoinScreen', 'gameScreen', 'leaderboardScreen', 'hostLoginScreen', 'hostPanelScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Player Management
        function updatePlayerCount() {
            const count = gameState.players.length;
            document.getElementById('playerCount').textContent = `${count}/40`;
            if (document.getElementById('hostPlayerCount')) {
                document.getElementById('hostPlayerCount').textContent = count;
            }
            updateHostPlayerList();
        }

        function joinGame() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Silakan masukkan nama Anda!');
                return;
            }

            if (gameState.players.length >= 40) {
                alert('Maaf, game sudah penuh (maksimal 40 pemain)');
                return;
            }

            if (gameState.players.find(p => p.name === name)) {
                alert('Nama sudah digunakan, silakan pilih nama lain!');
                return;
            }

            const player = {
                id: Date.now(),
                name: name,
                score: 0,
                answers: [],
                joinTime: new Date()
            };

            gameState.players.push(player);
            gameState.currentPlayer = player;
            
            startGame();
        }

        // Game Logic
        function startGame() {
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            gameState.currentScreen = 'game';
            
            document.getElementById('gamePlayerName').textContent = gameState.currentPlayer.name;
            gameState.currentQuestionIndex = 0;
            gameState.gameStartTime = Date.now();
            
            startGameTimer();
            showQuestion();
            updatePlayerCount();
        }

        function startGameTimer() {
            const duration = 10 * 60 * 1000; // 10 minutes
            
            gameState.gameTimer = setInterval(() => {
                const elapsed = Date.now() - gameState.gameStartTime;
                const remaining = Math.max(0, duration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer').textContent = timeString;
                
                if (document.getElementById('hostGameTime')) {
                    document.getElementById('hostGameTime').textContent = timeString;
                }
                
                if (remaining === 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateProgressBar() {
            const current = gameState.currentQuestionIndex + 1;
            const total = questions.length;
            const percentage = (current / total) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${current} dari ${total} soal`;
        }

        function showQuestion() {
            const question = questions[gameState.currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionIcon').textContent = question.icon || question.image;
            
            // Update progress bar
            updateProgressBar();
            
            // Handle question image/diagram
            const imageContainer = document.getElementById('questionImageContainer');
            const questionImage = document.getElementById('questionImage');
            const questionDiagram = document.getElementById('questionDiagram');
            
            if (question.diagram) {
                questionImage.style.display = 'none';
                questionDiagram.style.display = 'block';
                questionDiagram.innerHTML = question.diagram;
            } else if (question.image && (question.image.startsWith('http') || question.image.startsWith('data:'))) {
                // Display uploaded image or URL image
                questionImage.style.display = 'none';
                questionDiagram.style.display = 'block';
                questionDiagram.innerHTML = `
                    <div class="bg-white p-4 rounded-lg border-2 border-gray-200">
                        <div class="relative">
                            <img src="${question.image}" 
                                 alt="Gambar soal" 
                                 class="max-w-full h-auto mx-auto rounded-lg shadow-md max-h-64 object-contain"
                                 onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                                 style="opacity: 0; transition: opacity 0.3s ease;">
                            <div class="text-center p-8 bg-gray-100 rounded-lg">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">Memuat gambar...</p>
                                <div class="hidden">
                                    <div class="text-6xl mb-4">${question.icon || 'üìê'}</div>
                                    <p class="text-gray-600">Gambar tidak dapat dimuat</p>
                                    <p class="text-sm text-gray-500 mt-2">Menggunakan icon sebagai pengganti</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add timeout fallback for slow loading images
                setTimeout(() => {
                    const img = questionDiagram.querySelector('img');
                    const fallback = questionDiagram.querySelector('.hidden');
                    const loading = questionDiagram.querySelector('.animate-spin').parentElement;
                    
                    if (img && img.style.opacity === '0') {
                        img.style.display = 'none';
                        loading.style.display = 'none';
                        fallback.classList.remove('hidden');
                        fallback.style.display = 'block';
                    }
                }, 8000); // 8 second timeout
                
            } else {
                // Display emoji/icon
                questionImage.style.display = 'block';
                questionDiagram.style.display = 'none';
                questionImage.textContent = question.image || question.icon || 'üìê';
            }
            
            // Hide basketball animation
            document.getElementById('basketballAnimation').classList.add('hidden');
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            Object.entries(question.options).forEach(([key, value]) => {
                const button = document.createElement('button');
                button.className = 'w-full p-6 text-left border-2 border-gray-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-300 transform hover:scale-105 hover:shadow-lg';
                button.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-lg shadow-lg">
                            ${key.toUpperCase()}
                        </div>
                        <div class="flex-1 text-gray-800 font-medium text-lg">${value}</div>
                        <div class="text-2xl opacity-50">üîµ</div>
                    </div>
                `;
                button.onclick = () => selectAnswer(key, button);
                button.disabled = false;
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('nextButton').disabled = true;
        }

        function selectAnswer(answer, buttonElement) {
            // Disable all buttons to prevent multiple selections
            document.querySelectorAll('#answerOptions button').forEach(btn => {
                btn.disabled = true;
            });
            
            // Mark selected answer
            const question = questions[gameState.currentQuestionIndex];
            const isCorrect = answer === question.correct;
            
            // Remove previous selections and show immediate feedback
            document.querySelectorAll('#answerOptions button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                btn.classList.add('border-gray-300', 'opacity-60');
            });
            
            // Highlight selected answer
            if (isCorrect) {
                buttonElement.classList.remove('opacity-60');
                buttonElement.classList.add('border-green-500', 'bg-green-50', 'shadow-lg', 'transform', 'scale-105');
                buttonElement.innerHTML = buttonElement.innerHTML.replace('üîµ', '‚úÖ');
            } else {
                buttonElement.classList.remove('opacity-60');
                buttonElement.classList.add('border-red-500', 'bg-red-50', 'shadow-lg');
                buttonElement.innerHTML = buttonElement.innerHTML.replace('üîµ', '‚ùå');
                
                // Show correct answer
                document.querySelectorAll('#answerOptions button').forEach(btn => {
                    const optionKey = btn.textContent.trim().charAt(0).toLowerCase();
                    if (optionKey === question.correct) {
                        btn.classList.remove('opacity-60');
                        btn.classList.add('border-green-500', 'bg-green-50', 'shadow-lg', 'transform', 'scale-105');
                        btn.innerHTML = btn.innerHTML.replace('üîµ', '‚úÖ');
                    }
                });
            }
            
            // Update score and save answer
            if (isCorrect) {
                gameState.currentPlayer.score += 20;
            }
            
            gameState.currentPlayer.answers.push({
                questionIndex: gameState.currentQuestionIndex,
                answer: answer,
                correct: isCorrect
            });
            
            // Show basketball animation
            playBasketballAnimation(isCorrect, () => {
                // Show auto-advance message
                document.getElementById('autoAdvanceMessage').classList.remove('hidden');
                
                // Auto-advance to next question after 2 seconds
                setTimeout(() => {
                    document.getElementById('autoAdvanceMessage').classList.add('hidden');
                    nextQuestion();
                }, 2000);
                
                updateHostChart();
            });
        }

        function playBasketballAnimation(isCorrect, callback) {
            const animationContainer = document.getElementById('basketballAnimation');
            const player = document.getElementById('basketballPlayer');
            const basketball = document.getElementById('basketball');
            const scoreEffect = document.getElementById('scoreEffect');
            
            // Show animation container
            animationContainer.classList.remove('hidden');
            
            // Reset positions and states
            player.classList.remove('shooting', 'celebration', 'disappointment');
            basketball.classList.remove('ball-success', 'ball-miss');
            scoreEffect.style.opacity = '0';
            scoreEffect.style.transform = 'translateY(20px)';
            
            // Reset ball position
            basketball.style.left = '90px';
            basketball.style.bottom = '100px';
            basketball.style.transform = 'rotate(0deg)';
            
            // Start shooting animation
            setTimeout(() => {
                player.classList.add('shooting');
                
                // Animate ball trajectory
                setTimeout(() => {
                    if (isCorrect) {
                        // Successful shot - ball goes perfectly into hoop center
                        basketball.style.right = '78px';
                        basketball.style.bottom = '125px';
                        basketball.style.transform = 'rotate(720deg) scale(0.7)';
                        basketball.style.left = 'auto';
                        
                        // Show score effect
                        setTimeout(() => {
                            scoreEffect.style.opacity = '1';
                            scoreEffect.style.transform = 'translateY(0)';
                        }, 800);
                        
                        // Player celebration
                        setTimeout(() => {
                            player.classList.remove('shooting');
                            player.classList.add('celebration');
                        }, 1000);
                        
                    } else {
                        // Missed shot - ball bounces off rim
                        basketball.style.right = '30px';
                        basketball.style.bottom = '60px';
                        basketball.style.transform = 'rotate(360deg)';
                        basketball.style.left = 'auto';
                        
                        // Player disappointment
                        setTimeout(() => {
                            player.classList.remove('shooting');
                            player.classList.add('disappointment');
                        }, 1000);
                    }
                }, 400);
                
                // Hide animation and call callback
                setTimeout(() => {
                    animationContainer.classList.add('hidden');
                    callback();
                }, 3000);
                
            }, 600);
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex >= questions.length) {
                endGame();
            } else {
                showQuestion();
            }
        }

        function endGame() {
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
            }
            
            hideAllScreens();
            document.getElementById('leaderboardScreen').classList.remove('hidden');
            gameState.currentScreen = 'leaderboard';
            
            showLeaderboard();
        }

        function showLeaderboard() {
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            const leaderboardList = document.getElementById('leaderboardList');
            
            leaderboardList.innerHTML = '';
            
            sortedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-4 rounded-xl ${
                    index === 0 ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white' :
                    index === 1 ? 'bg-gradient-to-r from-gray-400 to-gray-500 text-white' :
                    index === 2 ? 'bg-gradient-to-r from-orange-400 to-orange-600 text-white' :
                    'bg-gray-100'
                }`;
                
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <span class="text-2xl">${medal}</span>
                        <div>
                            <p class="font-bold">${player.name}</p>
                            <p class="text-sm opacity-75">${player.answers.filter(a => a.correct).length}/5 benar</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold">${player.score}</p>
                        <p class="text-sm opacity-75">poin</p>
                    </div>
                `;
                
                leaderboardList.appendChild(div);
            });
        }

        function resetGame() {
            gameState.currentQuestionIndex = 0;
            gameState.currentPlayer.score = 0;
            gameState.currentPlayer.answers = [];
            startGame();
        }

        // Host Functions
        function loginHost() {
            const password = document.getElementById('hostPassword').value;
            if (password === 'admin123') {
                hideAllScreens();
                document.getElementById('hostPanelScreen').classList.remove('hidden');
                gameState.currentScreen = 'hostPanel';
                initHostPanel();
            } else {
                alert('Password salah!');
            }
        }

        function initHostPanel() {
            updatePlayerCount();
            initHostChart();
            showHostTab('stats');
            populateQuestionsList();
        }

        function showHostTab(tabName) {
            // Update tab buttons
            const statsTab = document.getElementById('statsTab');
            const questionsTab = document.getElementById('questionsTab');
            
            statsTab.className = 'px-4 py-2 font-medium text-gray-600 hover:text-blue-600';
            questionsTab.className = 'px-4 py-2 font-medium text-gray-600 hover:text-blue-600';
            
            // Hide all tab contents
            const statsTabContent = document.getElementById('hostStatsTab');
            const questionsTabContent = document.getElementById('hostQuestionsTab');
            
            statsTabContent.classList.add('hidden');
            questionsTabContent.classList.add('hidden');
            
            if (tabName === 'stats') {
                statsTab.className = 'px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600';
                statsTabContent.classList.remove('hidden');
                updateHostChart();
            } else if (tabName === 'questions') {
                questionsTab.className = 'px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600';
                questionsTabContent.classList.remove('hidden');
                populateQuestionsList();
            }
        }

        function populateQuestionsList() {
            const questionsList = document.getElementById('questionsList');
            questionsList.innerHTML = '';
            
            questions.forEach((question, index) => {
                const div = document.createElement('div');
                div.className = 'p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors';
                div.onclick = () => editQuestion(index);
                
                const shortQuestion = question.question.length > 50 ? 
                    question.question.substring(0, 50) + '...' : 
                    question.question;
                
                div.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-sm">${index + 1}. ${shortQuestion}</p>
                            <p class="text-xs text-gray-500">${question.icon} ‚Ä¢ 2 pilihan</p>
                        </div>
                        <button onclick="deleteQuestion(${index}); event.stopPropagation();" 
                                class="text-red-500 hover:text-red-700 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                
                questionsList.appendChild(div);
            });
        }

        function editQuestion(index) {
            const question = questions[index];
            const editor = document.getElementById('questionEditor');
            
            editor.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Icon Soal</label>
                        <input type="text" id="editIcon" value="${question.icon}" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                               placeholder="Contoh: üìê, üìè, ‚¨ú">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pertanyaan</label>
                        <textarea id="editQuestion" rows="3" 
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                  placeholder="Masukkan pertanyaan...">${question.question}</textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Gambar Pendukung</label>
                        <div class="space-y-3">
                            <input type="file" id="editImageFile" accept="image/*" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                   onchange="handleImageUpload(this, 'editImagePreview')">
                            <input type="url" id="editImageUrl" value="${question.image && question.image.startsWith('http') ? question.image : ''}" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                   placeholder="Contoh: https://i.imgur.com/gambar.jpg"
                                   oninput="debouncePreview(this.value, 'editImagePreview')"
                                   onpaste="setTimeout(() => debouncePreview(this.value, 'editImagePreview'), 100)">
                            <div class="mt-2 text-xs text-gray-500">
                                <p><strong>Tips URL gambar yang berfungsi:</strong></p>
                                <p>‚Ä¢ Direct link ke file gambar (berakhiran .jpg, .png, .gif)</p>
                                <p>‚Ä¢ Contoh: https://i.imgur.com/abc123.jpg</p>
                                <p>‚Ä¢ Hindari link Google Drive atau Dropbox</p>
                            </div>
                            <div id="editImagePreview" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                ${question.image.startsWith('http') ? 
                                    `<img src="${question.image}" alt="Preview" class="max-w-full h-32 mx-auto object-contain rounded">` :
                                    `<div class="text-4xl mb-2">${question.image}</div><p class="text-gray-500">Preview gambar akan muncul di sini</p>`
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilihan A</label>
                        <input type="text" id="editOptionA" value="${question.options.a}" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                               placeholder="Masukkan pilihan A...">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilihan B</label>
                        <input type="text" id="editOptionB" value="${question.options.b}" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                               placeholder="Masukkan pilihan B...">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jawaban Benar</label>
                        <select id="editCorrect" class="w-full p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="a" ${question.correct === 'a' ? 'selected' : ''}>A</option>
                            <option value="b" ${question.correct === 'b' ? 'selected' : ''}>B</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button onclick="saveQuestion(${index})" 
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium">
                            üíæ Simpan Perubahan
                        </button>
                        <button onclick="cancelEdit()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium">
                            ‚ùå Batal
                        </button>
                    </div>
                </div>
            `;
        }

        function addNewQuestion() {
            const newQuestion = {
                question: "Pertanyaan baru...",
                icon: "‚ùì",
                image: "‚ùì",
                diagram: "",
                options: {
                    a: "Pilihan A",
                    b: "Pilihan B"
                },
                correct: "a"
            };
            
            questions.push(newQuestion);
            populateQuestionsList();
            editQuestion(questions.length - 1);
        }

        function deleteQuestion(index) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                questions.splice(index, 1);
                populateQuestionsList();
                document.getElementById('questionEditor').innerHTML = '<p class="text-gray-500 text-center py-8">Pilih soal dari daftar untuk mengedit</p>';
            }
        }

        function handleImageUpload(input, previewId) {
            const file = input.files[0];
            const preview = document.getElementById(previewId);
            
            if (file) {
                // Validate file type
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    alert('Format file tidak didukung. Gunakan JPG, PNG, GIF, atau WebP.');
                    input.value = '';
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar. Maksimal 5MB.');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" class="max-w-full h-32 mx-auto object-contain rounded shadow-md">
                        <p class="text-sm text-green-600 mt-2">‚úÖ ${file.name} (${(file.size/1024).toFixed(1)} KB)</p>
                    `;
                    
                    // Clear URL input when file is uploaded
                    const urlInput = document.getElementById('editImageUrl');
                    if (urlInput) urlInput.value = '';
                };
                reader.onerror = function() {
                    alert('Gagal membaca file. Silakan coba lagi.');
                    input.value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        // Debounce function to prevent too many preview requests
        let previewTimeout;
        function debouncePreview(url, previewId) {
            clearTimeout(previewTimeout);
            previewTimeout = setTimeout(() => {
                previewImageUrl(url, previewId);
            }, 500); // Wait 500ms after user stops typing
        }

        function previewImageUrl(url, previewId) {
            const preview = document.getElementById(previewId);
            
            if (!url.trim()) {
                preview.innerHTML = `
                    <div class="text-4xl mb-2">üñºÔ∏è</div>
                    <p class="text-gray-500">Preview gambar akan muncul di sini</p>
                `;
                return;
            }
            
            // Validate URL format
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                preview.innerHTML = `
                    <div class="text-4xl mb-2">‚ö†Ô∏è</div>
                    <p class="text-orange-500 text-sm">URL harus dimulai dengan http:// atau https://</p>
                `;
                return;
            }
            
            // Show loading state
            preview.innerHTML = `
                <div class="text-4xl mb-2">‚è≥</div>
                <p class="text-gray-500">Memuat gambar...</p>
            `;
            
            // Create image element to test URL
            const img = new Image();
            
            // Set timeout for loading
            const timeout = setTimeout(() => {
                preview.innerHTML = `
                    <div class="text-4xl mb-2">‚è∞</div>
                    <p class="text-orange-500 text-sm">Gambar membutuhkan waktu lama untuk dimuat.<br>
                    Periksa koneksi internet atau coba URL lain.</p>
                `;
            }, 10000); // 10 second timeout
            
            img.onload = function() {
                clearTimeout(timeout);
                preview.innerHTML = `
                    <img src="${url}" alt="Preview" class="max-w-full h-32 mx-auto object-contain rounded shadow-md">
                    <p class="text-sm text-blue-600 mt-2">‚úÖ Gambar berhasil dimuat dari URL</p>
                `;
                
                // Clear file input when URL is used
                const fileInput = document.getElementById('editImageFile');
                if (fileInput) fileInput.value = '';
            };
            
            img.onerror = function() {
                clearTimeout(timeout);
                preview.innerHTML = `
                    <div class="text-4xl mb-2">‚ùå</div>
                    <p class="text-red-500 text-sm">URL gambar tidak dapat diakses. Kemungkinan penyebab:<br>
                    ‚Ä¢ URL tidak valid atau rusak<br>
                    ‚Ä¢ Server gambar memblokir akses eksternal<br>
                    ‚Ä¢ Koneksi internet bermasalah<br><br>
                    <strong>Tips:</strong> Gunakan layanan hosting gambar seperti:<br>
                    ‚Ä¢ imgur.com<br>
                    ‚Ä¢ postimg.cc<br>
                    ‚Ä¢ atau upload file langsung</p>
                `;
            };
            
            // Don't use crossorigin to avoid CORS issues
            img.src = url;
        }

        function saveQuestion(index) {
            const icon = document.getElementById('editIcon').value.trim();
            const questionText = document.getElementById('editQuestion').value.trim();
            const optionA = document.getElementById('editOptionA').value.trim();
            const optionB = document.getElementById('editOptionB').value.trim();
            const correct = document.getElementById('editCorrect').value;
            
            // Get image source
            let imageSource = document.getElementById('editImageUrl').value.trim();
            const imageFile = document.getElementById('editImageFile').files[0];
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageSource = e.target.result;
                    updateQuestionData();
                };
                reader.readAsDataURL(imageFile);
            } else {
                updateQuestionData();
            }
            
            function updateQuestionData() {
                if (!questionText || !optionA || !optionB) {
                    alert('Harap isi semua field yang diperlukan!');
                    return;
                }
                
                // Preserve existing diagram if no new image is provided
                const existingQuestion = questions[index];
                
                // Determine final image source
                let finalImageSource = imageSource || icon || "‚ùì";
                
                // If it's a URL, validate it
                if (imageSource && imageSource.startsWith('http')) {
                    // Test the URL before saving
                    const testImg = new Image();
                    const timeout = setTimeout(() => {
                        if (confirm('URL gambar membutuhkan waktu lama untuk dimuat. Apakah Anda tetap ingin menyimpan dengan URL ini?')) {
                            saveQuestionData(finalImageSource);
                        }
                    }, 5000);
                    
                    testImg.onload = function() {
                        clearTimeout(timeout);
                        // URL is valid, proceed with save
                        saveQuestionData(finalImageSource);
                    };
                    testImg.onerror = function() {
                        clearTimeout(timeout);
                        if (confirm('URL gambar tidak dapat diakses. Apakah Anda tetap ingin menyimpan soal dengan URL ini? (Gambar mungkin tidak tampil saat kuis)')) {
                            saveQuestionData(finalImageSource);
                        } else {
                            finalImageSource = icon || "‚ùì";
                            saveQuestionData(finalImageSource);
                        }
                    };
                    // Don't use crossOrigin to avoid CORS issues
                    testImg.src = imageSource;
                } else {
                    // Not a URL or is base64, save directly
                    saveQuestionData(finalImageSource);
                }
                
                function saveQuestionData(finalImage) {
                    questions[index] = {
                        question: questionText,
                        icon: icon || "‚ùì",
                        image: finalImage,
                        diagram: existingQuestion ? existingQuestion.diagram : "",
                        options: {
                            a: optionA,
                            b: optionB
                        },
                        correct: correct
                    };
                    
                    populateQuestionsList();
                    alert('Soal berhasil disimpan!');
                    
                    // Clear the editor
                    document.getElementById('questionEditor').innerHTML = '<p class="text-gray-500 text-center py-8">Pilih soal dari daftar untuk mengedit</p>';
                }
            }
        }

        function cancelEdit() {
            document.getElementById('questionEditor').innerHTML = '<p class="text-gray-500 text-center py-8">Pilih soal dari daftar untuk mengedit</p>';
        }

        function startGameAsHost() {
            if (gameState.players.length === 0) {
                alert('Belum ada pemain yang bergabung!');
                return;
            }
            
            // Start game for all players
            gameState.gameStartTime = Date.now();
            startGameTimer();
            updateHostChart();
        }

        function updateHostPlayerList() {
            const hostPlayerList = document.getElementById('hostPlayerList');
            if (!hostPlayerList) return;
            
            hostPlayerList.innerHTML = '';
            
            if (gameState.players.length === 0) {
                hostPlayerList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üë•</div>
                        <p>Belum ada pemain yang bergabung</p>
                    </div>
                `;
                return;
            }
            
            // Sort players by score (highest first)
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            
            sortedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const correctAnswers = player.answers.filter(a => a.correct).length;
                const totalAnswers = player.answers.length;
                
                div.className = `flex items-center justify-between p-3 rounded-lg transition-all hover:shadow-md ${
                    index === 0 ? 'bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200' :
                    index === 1 ? 'bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200' :
                    index === 2 ? 'bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200' :
                    'bg-gray-50'
                }`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">${rankIcon}</div>
                        <div>
                            <p class="font-medium text-gray-800">${player.name}</p>
                            <p class="text-sm text-gray-600">Bergabung: ${player.joinTime.toLocaleTimeString()}</p>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" 
                                         style="width: ${(totalAnswers / 5) * 100}%"></div>
                                </div>
                                <span class="text-xs text-gray-500">${totalAnswers}/5</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xl font-bold text-blue-600">${player.score}</p>
                        <p class="text-sm text-gray-600">poin</p>
                        <p class="text-xs text-green-600">${correctAnswers} benar</p>
                    </div>
                `;
                hostPlayerList.appendChild(div);
            });
        }

        function initHostChart() {
            const ctx = document.getElementById('liveScoreChart');
            if (!ctx) return;
            
            if (gameState.hostChart) {
                gameState.hostChart.destroy();
            }
            
            gameState.hostChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['üî¥ Rendah (0-20)', 'üü° Cukup (21-40)', 'üîµ Baik (41-60)', 'üü¢ Sangat Baik (61-80)', 'üü£ Sempurna (81-100)'],
                    datasets: [{
                        label: 'Jumlah Pemain',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.9)',
                            'rgba(245, 158, 11, 0.9)',
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(16, 185, 129, 0.9)',
                            'rgba(139, 92, 246, 0.9)'
                        ],
                        borderColor: [
                            'rgba(239, 68, 68, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(139, 92, 246, 1)'
                        ],
                        borderWidth: 3,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'üìä Distribusi Skor Pemain',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: '#374151'
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${context.parsed} pemain (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1000
                    }
                }
            });
        }

        function updateHostChart() {
            if (!gameState.hostChart) return;
            
            const scoreRanges = [0, 0, 0, 0, 0];
            
            gameState.players.forEach(player => {
                const score = player.score;
                if (score <= 20) scoreRanges[0]++;
                else if (score <= 40) scoreRanges[1]++;
                else if (score <= 60) scoreRanges[2]++;
                else if (score <= 80) scoreRanges[3]++;
                else scoreRanges[4]++;
            });
            
            gameState.hostChart.data.datasets[0].data = scoreRanges;
            gameState.hostChart.update();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showOpening();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973401e885e8f8fe',t:'MTc1NTg4Mjg3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
